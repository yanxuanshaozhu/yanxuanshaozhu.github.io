<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yanxuanshaozhu.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="這篇文章是觀看Bilibili上面黑馬程序員SSM相關視頻時，總結的筆記 Spring">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Review">
<meta property="og:url" content="https://yanxuanshaozhu.github.io/2022/07/24/Spring-Review/index.html">
<meta property="og:site_name" content="My Blog">
<meta property="og:description" content="這篇文章是觀看Bilibili上面黑馬程序員SSM相關視頻時，總結的筆記 Spring">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://yanxuanshaozhu.github.io/images/Spring/SpringFrameworkRuntime.png">
<meta property="article:published_time" content="2022-07-24T23:44:33.000Z">
<meta property="article:modified_time" content="2023-06-08T20:19:35.000Z">
<meta property="article:author" content="Yanxuanshaozhu">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="SpringMVC">
<meta property="article:tag" content="SpringBoot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yanxuanshaozhu.github.io/images/Spring/SpringFrameworkRuntime.png">

<link rel="canonical" href="https://yanxuanshaozhu.github.io/2022/07/24/Spring-Review/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Spring Review | My Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">My Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-portfolio">

    <a href="/portfolio/" rel="section"><i class="fas fa-wallet fa-fw"></i>Portfolio</a>

  </li>
        <li class="menu-item menu-item-memories">

    <a href="/memories/" rel="section"><i class="fas fa-camera fa-fw"></i>Memories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://yanxuanshaozhu.github.io/2022/07/24/Spring-Review/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Yanxuanshaozhu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring Review
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-07-24 19:44:33" itemprop="dateCreated datePublished" datetime="2022-07-24T19:44:33-04:00">2022-07-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-06-08 16:19:35" itemprop="dateModified" datetime="2023-06-08T16:19:35-04:00">2023-06-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Computer-Science/" itemprop="url" rel="index"><span itemprop="name">Computer Science</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>208k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>3:09</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>這篇文章是觀看Bilibili上面黑馬程序員SSM相關視頻時，總結的筆記</p>
<h1 id="spring">Spring</h1>
<span id="more"></span>
<h2 id="spring-概述">Spring 概述</h2>
<ol type="1">
<li>Spring是分層的Java
SE/EE應用的full-stack輕量級開源框架，以IOC(Inverse of
control控制反轉)和AOP(Aspect oriented
programming面向切片編程)為内核，提供了展現層Spring MVC和持久層Spring
JDBC以及業務層事務管理等多種技術，是使用最多的Java EE企業應用框架</li>
<li>Spring的優勢
<ul>
<li>方便解耦，簡化開發</li>
<li>AOP編程的支持</li>
<li>聲明式事務的支持</li>
<li>方便程序的測試</li>
<li>方便集成各種優秀框架</li>
<li>降低JavaEE API的使用難度</li>
</ul></li>
<li>Spring的體系結構 <img src="/images/Spring/SpringFrameworkRuntime.png">
<ul>
<li>Core Container提供了IOC的支持，其他功能必需核心容器的支持</li>
<li>AOP, Aspects, Instrumentation, Messaging和AOP有關</li>
<li>Data/Access層提供了持久層的支持</li>
<li>Web層提供了MVC的支持</li>
<li>Testing層提供了測試的支持</li>
</ul></li>
</ol>
<h2 id="ioc的概念和應用">IOC的概念和應用</h2>
<ol type="1">
<li>耦合和解耦
<ul>
<li>耦合：程序之間存在依賴關係，可能是類之間的依賴，也可能是方法之間的依賴</li>
<li>解耦：降低程序之間的依賴關係，應該做到編譯期不依賴，運行時才依賴</li>
<li>解耦的思路：
<ul>
<li>使用反射創建對象，而不使用<code>new</code>來創建對象</li>
<li>對於反射傳入的字符串，不應該寫成固定的字符串，而是應該通過讀取配置文件來獲得</li>
</ul></li>
<li>表現層，業務層和持久層之間都應該解耦</li>
</ul></li>
<li>Bean
<ul>
<li>Bean: 在計算機語言中，指的是可重用組件</li>
<li>JavaBean: 用Java語言實現的可重用組件</li>
<li>Bean
factory：創建Bean對象的工廠，負責創建service和dao對象。從配置文件讀取配置的内容，再通過反射創建對象
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanFactory</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> Properties props;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Object&gt; beans;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// 讀取配置文件, 并且通過反射獲得單例對象（效率更高），類加載的時候執行一次即可</span></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         props = <span class="keyword">new</span> Properties();</span><br><span class="line">         <span class="comment">// 這個bean.properties在resources目錄下面</span></span><br><span class="line">         InputStream in = BeanFactory.class.getClassLoader().getResourceAsStream(<span class="string">&quot;bean.properties&quot;</span>);</span><br><span class="line">         props.load(in);</span><br><span class="line">         beans = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">         Enumeration keys = props.keys();</span><br><span class="line">         <span class="keyword">while</span> (keys.hasMoreElements()) &#123;</span><br><span class="line">            String key = keys.nextElement().toString();</span><br><span class="line">            String beanPath = props.getProperty(key);</span><br><span class="line">            Object value = Class.forName(beanPath).newInstance();</span><br><span class="line">            beans.put(key, value);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> ExceptionInitializerError(<span class="string">&quot;初始化失敗&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 讀取字符串，獲得對象</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getBean</span><span class="params">(String beanName)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> beans.get(beanName);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>IOC
<ul>
<li>控制反轉把創建對象的權力從應用交給框架，是框架的重要特徵，包括依賴注入和以來查找。原先是由應用直接創建對象，耦合度高，現在是應用通過工廠的方法來獲得對象，應用把控制權交給了工廠，耦合度較低。</li>
<li>作用：解耦</li>
</ul></li>
</ol>
<h2 id="spring的ioc解決程序耦合">Spring的IOC解決程序耦合</h2>
<ol type="1">
<li>使用XML配置IOC替代Bean factory的手動配置
<ul>
<li>在resources目錄下面新建一個bean.xml文件，寫入以下内容
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;獲取對象時的字符串1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;反射時的全限定類名1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;獲取對象時的字符串2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;反射時的全限定類名2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>在應用中獲取IOC的核心容器，并根據id或許對象 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 獲取核心容器</span></span><br><span class="line">   ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">   <span class="comment">// 根據id獲取對象，兩種方式都可以</span></span><br><span class="line">   MyClass1 var1 = (MyClass) ctx.getBean(<span class="string">&quot;獲取對象時的字符串1&quot;</span>);</span><br><span class="line">   MyClass2 var2 = ctx.getBean(<span class="string">&quot;獲取對象時的字符串2&quot;</span>, MyClass2.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>ApplicationContext</code>是一個接口，他間接結成了Spring核心容器的頂層接口<code>BeanFactory</code>
<ul>
<li>實現類
<ul>
<li><code>ClassPathXmlApplicationContext</code>:
加載了類路徑下的配置文件，其他位置的配置文件加載不了</li>
<li><code>FileSystemXmlApplicationContext</code>:
可以加載任意路徑下的配置文件，需要相應路徑有訪問權限</li>
<li><code>AnnotationConfigApplicationContext</code>:
用於讀取注解創建容器</li>
</ul></li>
<li><code>ApplicationContext</code>只要讀取了配置文件，就創建了對應的Bean對象，并且將Bean對象封裝到容器裏面，適用於單例對象</li>
<li><code>BeanFactory</code>讀取完配置文件之後，采取了延遲加載的方式，也就是只有在通過<code>getBean()</code>方法獲取對象的時候才會真正的創建對象，適用於多例對象
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Resource resource = <span class="keyword">new</span> ClassPathResource(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">BeanFactory ctx = <span class="keyword">new</span> XmlBeanFactory(resource);</span><br><span class="line">MyClass1 var1 = (MyClass1) ctx.getBean(<span class="string">&quot;獲取對象時的字符串1&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>ApplicationContext的各個類都有<code>close()</code>方法，用來銷毀容器，但是ApplicationContext自己沒有，所有不能用多態寫法</li>
</ul></li>
</ul></li>
</ul></li>
<li>Spring對Bean的管理細節
<ul>
<li>創建Bean的三種方式
<ul>
<li>通過默認構造函數創建:
在xml中使用<code>&lt;bean&gt;</code>標簽，有<code>id</code>和<code>class</code>屬性，那麽會使用類的默認構造函數創建對象</li>
<li>使用類中的方法創建對象，並存入Spring容器:
<code>&lt;bean id="獲取對象的字符串" factory-bean="工廠類類名" factory-method="工廠類方法名"&gt;&lt;/bean&gt;</code></li>
<li>使用類中的靜態方法創建對象，並存入Spring容器：<code>&lt;bean id="獲取對象的字符串" class="反射的全限定類名" factory-method="獲取對象的方法"&gt;&lt;/bean&gt;</code></li>
</ul></li>
<li>Bean對象的作用範圍
<ul>
<li>使用<code>&lt;bean&gt;</code>標簽的<code>scope</code>屬性來指定Bean的作用範圍</li>
<li>取值:
<code>singleton</code>單例，<code>prototype</code>多例，<code>request</code>web應用的請求範圍，<code>session</code>web應用的會話範圍，<code>global-session</code>集群環境的會話範圍，非集群的時候和session範圍一樣</li>
</ul></li>
<li>Bean對象的生命周期
<ul>
<li><code>&lt;bean init-method="m1" destroy-method="m2"&gt;</code>中的init-method和destroy-method屬性制定了Bean類中對應的方法用來初始化和銷毀Bean對象</li>
<li>單例對象：容器創建則Bean對象創建，容器銷毀則Bean對象銷毀</li>
<li>多利對象:
使用Bean對象的時候創建Bean對象，容器銷毀并不會銷毀Bean對象，Bean對象滿足GC條件的時候會GC</li>
</ul></li>
</ul></li>
<li>Spring依賴注入
<ul>
<li>Spring
容器在创建被调用者的实例时，会自动将调用者需要的对象实例注入给调用者，这样，调用者通过
Spring 容器获得被调用者实例，这称为依赖注入</li>
<li>依賴注入的數據類型
<ul>
<li>基本類型和String</li>
<li>其他Bean類型（配置文件中或注解配置過的Bean）</li>
<li>複雜類型/集合類型: 結構一樣，標簽可以互換,
list/array/set可以互換，map/props可以互換 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass1</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> String[] strs;</span><br><span class="line">   <span class="keyword">private</span> List&lt;String&gt; list;</span><br><span class="line">   <span class="keyword">private</span> Set&lt;String&gt; set;</span><br><span class="line">   <span class="keyword">private</span> Map&lt;String, String&gt; map;</span><br><span class="line">   <span class="keyword">private</span> Properties props;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStrs</span><span class="params">(String[] strs)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.strs = strs;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setList</span><span class="params">(List&lt;String&gt; list)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.list = list;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSet</span><span class="params">(Set&lt;String&gt; set)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.set = set;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMap</span><span class="params">(Map&lt;String, String&gt; map)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.map = map;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProps</span><span class="params">(Properties props)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.props = props;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;提取id&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;strs&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>str1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>str2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>str1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>str2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;set&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>str1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>str2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 這兩種寫法都可以 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;k1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;v1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;k2&quot;</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">               v2</span><br><span class="line">            <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;props&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;k1&quot;</span>&gt;</span></span><br><span class="line">            v1</span><br><span class="line">         <span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;k2&quot;</span>&gt;</span></span><br><span class="line">            v2</span><br><span class="line">         <span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>依賴注入的方式
<ul>
<li>通過構造函數提供: 使用<code>&lt;constructor-arg&gt;</code>標簽
(有<code>type</code>, <code>index</code>, <code>name</code>,
<code>value</code>,
<code>ref</code>屬性)，缺點是必須在·<constructor-arg>`中提供構造函數中所有參數，否則Bean對象無法創建
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass1</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> String v1;</span><br><span class="line">   <span class="keyword">private</span> Integer v2;</span><br><span class="line">   <span class="keyword">private</span> Date v3</span><br><span class="line">   <span class="function"><span class="keyword">public</span>  <span class="title">MyClass1</span><span class="params">(String v1, Integer v2, Date v3)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.v1 = v1;</span><br><span class="line">      <span class="keyword">this</span>.v2 = v2;</span><br><span class="line">      <span class="keyword">this</span>.v3 = v3;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;class&quot;</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;v1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 這裏的3是字符串，MyClass1中式Integer，Spring會幫我們完成類型轉換 --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- value提供基本類型和String類型的值 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;v2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- ref提供Bean類型的值 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;v2&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;now&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;now&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></constructor-arg></li>
<li>使用set方法提供: 使用<code>&lt;property&gt;</code>標簽
(有<code>name</code>, <code>value</code>,
<code>ref</code>屬性)，創建對象的時候可以直接使用默認構造函數，如果某個參數是required，但是set方法并不能保證該參數的set方法一定被提供
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass1</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> String v1;</span><br><span class="line">   <span class="keyword">private</span> Integer v2;</span><br><span class="line">   <span class="keyword">private</span> Date v3</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setV1</span><span class="params">(String v1)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.v1 = v1;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setV2</span><span class="params">(Integer v2)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.v2 = v2;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setV3</span><span class="params">(Date v3)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.v3 = v3;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;提取id&quot;</span>&gt;</span> </span><br><span class="line">   <span class="comment">&lt;!-- value提供基本類型和String的值 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;v1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;v2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- ref提供Bean類型的值 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;v2&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;now&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;now&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>使用注解提供</li>
</ul></li>
</ul></li>
</ol>
<h2 id="spring基於注解的ioc">Spring基於注解的IOC</h2>
<ol type="1">
<li>注解：注解和XML的功能類似，但是更加精簡
<ul>
<li>用於創建對象的注解, 類似XML中的<code>&lt;bean&gt;</code>標簽
<ul>
<li><code>@Component</code>注解，用於把當前類存入Spring容器中，有<code>value</code>屬性，value屬性就是bean標簽的id，value屬性可以不寫。需要在核心配置文件xml中通過組件掃描加載bean<code>&lt;context:component-scan base-package="包名"&gt;</code>,
Spring會掃描包名下面的所有文件找對應的注解</li>
<li><code>@Component</code>的三個衍生注解:
<code>@Controller</code>用於表現層bean定義,
<code>@Service</code>用於業務層bean定義,
<code>@Repository</code>用於數據層bean定義</li>
</ul></li>
<li>用於注入數據的注解, 類似XML中的<code>&lt;property&gt;</code>標簽
<ul>
<li><code>@Autowired</code>:
自動按照類型注入，只要容器中有唯一的一個Bean對象和需要注入的變量類型匹配，就可以諸如成功。可以用在變量或者方法上面。如果有同一類型的多個Bean對象匹配，比較注入變量名和Bean的id，如果有相同的就注入，否則報錯。</li>
<li><code>@Qualifier(id)</code>:
按照類型注入的基礎上再按照名稱注入，在給類型成員注入的時候不能單獨使用，在給方法注入的時候可以單獨使用</li>
<li><code>@Resource(name=id)</code>:
直接按照Bean的id注入，可以獨立使用，屬性name用於指定Bean的id</li>
<li><code>@Value(value=value)</code>:
用於注入基本類型和String類型的數據，有value屬性，可以使用String中的SpEL表達式，即<code>$&#123;表達式&#125;</code></li>
</ul></li>
<li>用於改變作用範圍的注解,
類似XML中的<code>&lt;bean&gt;</code>標簽的<code>scope</code></li>
<li><code>@Scope(value=value)</code>:
用於指定Bean的作用方位，value屬性常常為singleton, prototype等</li>
<li>和生命周期有關的注解,
類似XML中的<code>&lt;bean&gt;</code>標簽的<code>init-method</code>和<code>destroy-method</code>屬性
<ul>
<li><code>@PreDestroy</code>: 用於指定銷毀方法</li>
<li><code>@PostConstruct</code>: 用於指定初始化方法</li>
</ul></li>
</ul></li>
<li>一個基於XML的IOC例子
<ul>
<li><code>resources</code>目錄中<code>bean.xml</code>配置
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 文件格式看Spring Framework官網 --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--   配置業務層對象--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.service.impl.AccountServiceImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        注入dao--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;accountDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置Dao對象--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.dao.impl.AccountDao&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        注入QueryRunner--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;runner&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;runner&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    配置QueryRunner--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;runner&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbutils.QueryRunner&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        注入數據源--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;ds&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    配置數據源--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/xmlioc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><code>java</code>目錄中文件結構
<ul>
<li><code>dao</code>目錄: 有 <code>IAccountDao</code>接口和
<code>impl</code>目錄中<code>AccountDao</code>實現組件，這個實現組件中使用了<code>QueryRunner</code>屬性</li>
<li><code>domain</code>目錄: 有 <code>Account</code>實體類</li>
<li><code>service</code>: 有 <code>IAccountService</code>接口和
<code>impl</code>目錄中<code>AccountService</code>實現組件</li>
</ul></li>
<li><code>test</code>目錄中文件結構: 使用Junit來進行測試</li>
</ul></li>
<li>一個基於注解的IOC的例子
<ul>
<li><code>resources</code>目錄中<code>bean.xml</code>配置
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 文件格式看Spring Framework官網 --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--    告訴Spring在創建容器的時候要掃描的包--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.yanxuanshaozhu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--    配置QueryRunner--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;runner&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbutils.QueryRunner&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--        注入數據源--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;ds&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--    配置數據源--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/xmlioc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><code>java</code>目錄中文件結構
<ul>
<li><code>dao</code>目錄: 有 <code>IAccountDao</code>接口和
<code>impl</code>目錄中<code>AccountDao</code>實現組件，這個實現組件中使用了<code>QueryRunner</code>屬性,
需要配置<code>@Repository</code>注解，對<code>QueryRunner</code>屬性需要配置<code>@Autowired</code>注解</li>
<li><code>domain</code>目錄: 有 <code>Account</code>實體類</li>
<li><code>service</code>: 有 <code>IAccountService</code>接口和
<code>impl</code>目錄中<code>AccountService</code>實現組件，需要配置<code>@Service</code>注解，對<code>AccountDao</code>屬性需要配置<code>@Autowired</code>注解</li>
</ul></li>
<li><code>test</code>目錄中文件結構: 使用Junit來進行測試</li>
</ul></li>
<li>Spring中的新注解和解釋
<ul>
<li><code>@Configuration</code>:
使用一個Java配置類來完成<code>bean.xml</code>的功能,
如果<code>AnnotationConfigApplicationContext</code>中間傳入了這個Java類(這個方法接受多個類參數)，則對應的類上面的<code>@Configuration</code>注解可以不寫</li>
<li><code>@ComponentScan</code>:
寫在配置類裏面，使用注解指定需要掃描的包，其中<code>basePackage</code>屬性或者<code>value</code>屬性指定了需要掃描的包的名字</li>
<li><code>@Bean</code>:
寫在配置類的對應方法前，用於把當前方法的返回值作爲Bean對象存入Spring的IOC容器中，<code>name</code>屬性用於指定Bean的id，不寫的話，id默認值是當前方法的名稱
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不加Bean注解的話，只是創建了AccountDao對象，但是沒有存入Spring的IOC容器中</span></span><br><span class="line"><span class="meta">@Bean(name=&quot;accountDao&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AccountDao <span class="title">accountDao</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> AccountDao();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.dao.AccountDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>把XML去掉之後，在測試的時候還需要修正<code>ApplicationContext</code>的具體實現類，從<code>ClassPathXmlApplicationContext(bean.xml)</code>改成<code>AnnotationConfigApplicationContext(SpringConfiguration.class)</code></li>
<li>為了更好的多綫程使用，<code>QueryRunner</code>應該不應該是單例對象，爲此在對應的<code>@Bean</code>注解下面加上<code>@Scope("prototype")</code>注解</li>
<li><code>@Import(類名.class)</code>注解:
用於導入其他配置類，可以用一個類當作配置類入口，讓它導入其他配置類，這樣其他配置類可以省略<code>@Configuration</code>注解</li>
<li><code>@PropertySource</code>和<code>@Value($&#123;variable&#125;)</code>
<ul>
<li><code>@PropertySource(classpath:路徑到文件名)</code>:
寫在配置的Java類上，用於指定properties文件的位置</li>
<li><code>@Value($&#123;variable&#125;)</code>: 讀取properties文件中的key，
拿到value注入到屬性變量中 <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- File jdbc.properties --&gt;</span><br><span class="line">   driverClass=com.mysql.jdbc.Driver</span><br><span class="line">   url=jdbc:mysql://localhost:3306/xmlioc</span><br><span class="line">   user=root</span><br><span class="line">   password=123456</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file SpringConfiguration.java</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.yanxuanshaozhu&quot;)</span></span><br><span class="line"><span class="meta">@Import(JDBCConfiguration.class)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean(name = &quot;runner&quot;)</span></span><br><span class="line">   <span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> QueryRunner <span class="title">createQueryRunner</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> QueryRunner(dataSource);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file JDBCConfiguration.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Value(&quot;$&#123;driverClass&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String driverClass;</span><br><span class="line">   <span class="meta">@Value(&quot;$&#123;url&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String url;</span><br><span class="line">   <span class="meta">@Value(&quot;$&#123;user&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String user;</span><br><span class="line">   <span class="meta">@Value(&quot;$&#123;password&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean(name = &quot;dataSource&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> DataSource <span class="title">createDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">            ComboPooledDataSource ds = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">            ds.setDriverClass(driverClass);</span><br><span class="line">            ds.setJdbcUrl(url);</span><br><span class="line">            ds.setUser(user);</span><br><span class="line">            ds.setPassword(password);</span><br><span class="line">            <span class="keyword">return</span> ds;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li>Spring整合JUnit
<ul>
<li>一個Test案例 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceTest</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> ApplicationContext ctx;</span><br><span class="line">   <span class="keyword">private</span> IAccountService as;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 對於測試工程師來説，他應該只寫test方法，不應該需要懂Spring然後寫出來這個init方法</span></span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(SpringConfiguration.class);</span><br><span class="line">      as = ctx.getBean(<span class="string">&quot;accountService&quot;</span>, IAccountService.class);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      List&lt;Account&gt; allAccount = as.findAllAccount();</span><br><span class="line">      <span class="keyword">for</span> (Account ac : allAccount) &#123;</span><br><span class="line">            System.out.println(ac);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>JUnit不知道測試的時候使用了Spring框架，也就不會創建Spring的IOC核心容器，那麽即使使用了<code>Autowired</code>注解也不會自動注入</li>
<li>Spring整合JUnit
<ul>
<li>導入整合Spring框架的JUnit的maven坐標，注意spring-test需要junit版本至少4.12
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>使用JUnit的一個注解替換JUnit的<code>main</code>方法為Spring提供的<code>main</code>方法:
<code>@RunWith(SpringJUnit4ClassRunner.class)</code></li>
<li>告知Spring運行器Spring的IOC創建是基於XML還是注解的，并且説明配置的位置:
用XML創建
<code>ContextConfiguration(locations = "classpath:bean.xml")</code>或者用注解創建<code>@ContextConfiguration(classes = &#123;SpringConfiguration.class&#125;)</code>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IAccountService as;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      List&lt;Account&gt; allAccount = as.findAllAccount();</span><br><span class="line">      <span class="keyword">for</span> (Account ac : allAccount) &#123;</span><br><span class="line">            System.out.println(ac);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>注意Spring 5.x.x版本需要JUnit 4.12及以上版本才能使用</li>
</ul></li>
</ul></li>
</ol>
<h2 id="事務和動態代理">事務和動態代理</h2>
<ol type="1">
<li>事務控制
<ul>
<li>同一組操作應該使用一個Connection，從而防止部分成功部分失敗導致的數據庫錯誤，這個可以使用ThreadLocal綁定Connection來完成</li>
<li>事務控制應該都在業務層完成,下面是兩個工具類的例子 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*鏈接的工具類，獲取連接并且和綫程綁定*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> ThreadLocal&lt;Connection&gt; th = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> DataSource ds;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDs</span><span class="params">(DataSource ds)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.ds = ds;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*獲取當前綫程上的連接*/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//        先從ThreadLocal上獲取</span></span><br><span class="line">      Connection conn = th.get();</span><br><span class="line"><span class="comment">//        判斷當前綫程是否有連接</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (conn == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="comment">//                從數據源獲取連接，并且存入ThreadLocal中</span></span><br><span class="line">               conn = ds.getConnection();</span><br><span class="line">               th.set(conn);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            返回當前綫程上的連接</span></span><br><span class="line">            <span class="keyword">return</span> conn;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> conn;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*綫程和連接解綁*/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      th.remove();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*和事務管理有關的工具類，包含開啓事務，提交事務，回滾事務，關閉事務*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> ConnectionUtils connectionUtils;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConnectionUtils</span><span class="params">(ConnectionUtils connectionUtils)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.connectionUtils = connectionUtils;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*開啓事務*/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beginTransaction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">            connectionUtils.getConnection().setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*提交事務*/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commitTransaction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">            connectionUtils.getConnection().commit();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*回滾事務*/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rollbackTransaction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">            connectionUtils.getConnection().rollback();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*關閉事務*/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeTransaction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">            connectionUtils.getConnection().close();</span><br><span class="line">            connectionUtils.removeConnection();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>動態代理
<ul>
<li>特點：字節碼隨用隨創建，隨用隨加載，不修改源碼的基礎上對方法進行增强</li>
<li>分類：基於接口的動態代理，基於子類的動態代理</li>
<li>基於接口的動態代理
<ul>
<li>被代理類最少實現一個接口，否則不能使用</li>
<li><code>Proxy</code>類</li>
<li>使用<code>newProxyInstance(ClassLoader loader, Class[] cls, InvocationHandler handler)</code>方法創建對象
<ul>
<li><code>loader</code>: 被代理對象的類加載器,
就是<code>delegatedClass.getClass().getClassLoader()</code></li>
<li><code>cls</code>: 讓代理對象和被代理對象有相同的方法，
就是<code>delegatedClass.getClass().getInterfaces()</code></li>
<li><code>handler</code>:
用於提供增强的代碼，就是寫一個接口的匿名内部類，并且實現<code>invoke()</code>方法
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IProducer</span> </span>&#123;</span><br><span class="line">   <span class="comment">/*銷售*/</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">sellProduct</span><span class="params">(<span class="keyword">float</span> amount)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*售後*/</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">customerService</span><span class="params">(<span class="keyword">float</span> amount)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">IProducer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sellProduct</span><span class="params">(<span class="keyword">float</span> amount)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;賣貨了，賺錢了 &quot;</span> + amount);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customerService</span><span class="params">(<span class="keyword">float</span> amount)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;售後了，虧錢了&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Producer producer = <span class="keyword">new</span> Producer();</span><br><span class="line">      producer.sellProduct(<span class="number">1000f</span>);</span><br><span class="line">      <span class="comment">// 注意這裏只能轉換成接口IProducer,不能轉換成實現類Producer</span></span><br><span class="line">      IProducer producer1 = (IProducer) Proxy.newProxyInstance(</span><br><span class="line">               producer.getClass().getClassLoader(),</span><br><span class="line">               producer.getClass().getInterfaces(),</span><br><span class="line">               <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">                  <span class="meta">@Override</span></span><br><span class="line">                  <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                        <span class="comment">// 賣貨的時候經銷商抽成20%</span></span><br><span class="line">                        Float earnings = (Float) args[<span class="number">0</span>];</span><br><span class="line">                        <span class="keyword">if</span> (<span class="string">&quot;sellProduct&quot;</span>.equals(method.getName())) &#123;</span><br><span class="line"></span><br><span class="line">                           <span class="keyword">return</span> method.invoke(producer, earnings * <span class="number">0.8f</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> method.invoke(producer, args);</span><br><span class="line">                  &#125;</span><br><span class="line">               &#125;);</span><br><span class="line">      producer1.sellProduct(<span class="number">2000</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li>基於子類的動態代理
<ul>
<li>被代理類不能是final類</li>
<li><code>Enhancer</code>類</li>
<li>使用<code>create(Class cls, MethodInterceptor interceptor)</code>方法創建對象
<ul>
<li><code>cls</code>: 被代理類的字節碼</li>
<li><code>interceptor</code>:
就是寫一個接口的匿名内部類，并且實現<code>intercept()</code>方法
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sellProduct</span><span class="params">(<span class="keyword">float</span> amount)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;賣貨了，賺錢了 &quot;</span> + amount);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customerService</span><span class="params">(<span class="keyword">float</span> amount)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;售後了，虧錢了&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 因爲cblib和Java 17 不兼容，下面代碼沒有經過測試從而保證正確性:D</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Producer producer = <span class="keyword">new</span> Producer();</span><br><span class="line">      producer.sellProduct(<span class="number">1000f</span>);</span><br><span class="line">      Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">      enhancer.setSuperclass(producer.getClass());</span><br><span class="line">      enhancer.setCallback(<span class="keyword">new</span> MethodInterceptor() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object proxy, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">               Float money = (Float) args[<span class="number">0</span>];</span><br><span class="line">               <span class="keyword">if</span> (<span class="string">&quot;sellProduct&quot;</span>.equals(method)) &#123;</span><br><span class="line">                  <span class="keyword">return</span> method.invoke(producer, money * <span class="number">0.8f</span>);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">return</span> method.invoke(producer, args);</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      Producer producer1 = (Producer) enhancer.create();</span><br><span class="line">      producer1.sellProduct(<span class="number">1000f</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
</ul></li>
</ol>
<h2 id="spring的aop">Spring的AOP</h2>
<ol type="1">
<li>AOP
<ul>
<li>AOP(Aspect Oriented Programming):
面嚮切麵編程，通過預編譯和運行期動態代理實現程序功能的統一維護的一種技術</li>
<li>AOP的作用和優勢
<ul>
<li>作用：在程序運行期間，不修改源碼對已有方法進行增强</li>
<li>優勢：減少重複代碼，提高開發效率，維護方便</li>
</ul></li>
<li>AOP的實現: 通過動態代理實現</li>
</ul></li>
<li>Spring中的AOP
<ul>
<li>Spring中的AOP是通過配置XML或者注解實現的</li>
<li>AOP相關術語
<ul>
<li>Joinpoint連接點:
被攔截到的點，在Spring中這些點指的是方法，因爲Spring只支持方法類型的連接點。業務層的所有方法都是連接點</li>
<li>Pointout切入點:
指的是要對哪些Joinpoint進行攔截的定義，業務層中被增强的方法才是切入點，也就是説切入點一定是連接點</li>
<li>Advice通知/增强:
攔截到Joinpoint之後要做的事情就是通知，通知的方式有很多，根據對invoke方法的相對位置分成了:前置通知、后置通知、异常通知、环绕通知等</li>
<li>Introduction引介:
引介是一種特殊的通知，可以在運行期為類動態的增加一些方法或者屬性</li>
<li>Target目標對象: 代理的目標對象</li>
<li>Weaving織入:
把增强應用到目標對象來創建新的代理對象的過程，Spring采用動態代理織入，而AspectJ采用編譯期織入和類裝載期織入</li>
<li>Proxy: 一個類被AOP織入增强之後，就產生了一個結果代理類</li>
<li>Aspect切麵:
切入點和通知的結合，就是把自己手動寫的切入點和通知的結合通過配置來完成</li>
</ul></li>
</ul></li>
<li>Spring基於XML的AOP配置
<ul>
<li>項目<code>pom.xml</code>加入如下依賴，用來解析額切入點表達式
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>項目<code>bean.xml</code>配置Spring的IOC和AOP
<ul>
<li><code>&lt;aop:config&gt;&lt;/aop:config&gt;</code>表示Spring的AOP配置，所有AOP相關的配置都應該在這個配置内部</li>
<li><code>&lt;aop:aspect id=? ref=?&gt;&lt;/aop:aspect&gt;</code>表示配置切麵，切麵有獨立的id屬性和指向對應Bean的id的ref屬性</li>
<li><code>&lt;aop:before method=? pointcut=? pointcut-ref=?/&gt;</code>表示前置通知,
<code>&lt;aop:after-returning method=? pointcut=? pointcut-ref=?/&gt;</code>表示後置通知，<code>&lt;aop:after-throwing method=? pointcut=? pointcut-ref=?/&gt;</code>表示異常通知，<code>&lt;aop:after method=? pointcut=? pointcut-ref=?/&gt;</code>表示最終通知，後置通知和異常通知只有一個會執行</li>
<li><code>&lt;aop:pointcut id=? expression=?</code>用來指定切入點表達式，多個通知可以各自使用<code>pointcut</code>指定自己的切入點表達式，也可以通過<code>pointcut-ref</code>指定一個共同的切入點表達式標簽的id，從而節約代碼。這個標簽可以寫在<code>&lt;aop:aspect&gt;</code>内部，那麽對這一個切麵生效，也可以寫在所有切麵的外部最前方(這個位置是固定的)，那麽他對所有切麵生效</li>
<li>切入點表達式: 用來指定業務層可以被增强的方法
<ul>
<li><code>execution([訪問修飾符] 返回值 包名.類名.方法名(參數列表))</code>,
比如execution(public void
com.yanxuanshaozhu.service.impl.AccountServiceImpl.saveAccount())</li>
<li>全通配切入點表達式
<code>execution(* *..*.*(..))</code>，可以對業務層所有方法進行匹配</li>
<li>訪問修飾符可以省略，返回值可以用<em>通配，包名需要用.表示層級,或者用..表示當前類及其子類，類名和方法名可以用</em>通配，參數列表..表示一個或者多個參數</li>
<li>一般切入點表達式只包含業務層所有方法，所以是 *
com.yanxuanshaozhu.service.impl.*.*(..) <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--配置Spring的IOC，把Service配置進來--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.service.impl.AccountServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Spring AOP配置 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;logger&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.utils.logger&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;logAdvice&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;logger&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 這個意思是對於業務層所有匹配的方法，在他們執行前先執行printLog方法進行增强 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;printLog&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">pointcut</span>=<span class="string">&quot;execution( * com.yanxuanshaozhu.service.impl.*.(..))&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
</ul></li>
<li>環繞通知:
可以收寫代碼，依靠Spring框架提供的<code>ProceedingJoinPoint</code>接口的<code>proceed()</code>方法，在環繞通知内部實現前置通知，後置通知，異常通知和最終通知
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">aroundPrintLog</span><span class="params">(ProceedingJoinPoint pjp)</span> </span>&#123;</span><br><span class="line">   Object result = <span class="keyword">null</span>;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 獲得切入點方法執行需要的參數</span></span><br><span class="line">      Object[] args = pjp.getArgs();</span><br><span class="line">      System.out.println(<span class="string">&quot;前置通知&quot;</span>)</span><br><span class="line">      <span class="comment">// 顯式執行切入點方法</span></span><br><span class="line">      result = pjp.proceed(args);</span><br><span class="line">      System.out.println(<span class="string">&quot;後置通知&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">   &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">      <span class="comment">// 這裏不能用Exception，只能用Throwable</span></span><br><span class="line">      System.out.println(<span class="string">&quot;異常通知&quot;</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">   &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;最終通知&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Spring基於注解的AOP配置
<ul>
<li>項目<code>pom.xml</code>加入如下依賴，用來解析額切入點表達式
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><code>bean.xml</code> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--    配置Spring船艦容器時要掃描的包--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.yanxuanshaozhu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--    配置Spring開啓注解AOP的支持，這個必須有--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>切麵類設置
<ul>
<li><code>@Aspect</code>注解説明這個類是一個切麵</li>
<li><code>@Pointcut(切入點表達式)</code>指定了可以被增强的切入點方法，這個方法名要被增强方法的注釋調用</li>
<li><code>@Before(方法調用)</code>，<code>@After(方法調用)</code>，<code>@AfterReturning(方法調用)</code>，<code>@AfterThrowing(方法調用)</code>，<code>@Around(方法調用)</code>，這些注解説明這個方法是一個切麵的增强方法
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 用於記錄日志的工具類，它裏面提供了公共的代碼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component(&quot;logger&quot;)</span></span><br><span class="line"><span class="meta">@Aspect</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">logger</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Pointcut(&quot;execution( * com.yanxuanshaozhu.service.impl.*.*(..))&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">expr</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用於打印日志，并且在切入點方法(業務層方法)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="meta">@Before(&quot;expr()&quot;)</span> <span class="comment">// 必須是方法調用而不是方法名</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;1.0 Logger中的beforeLog方法開始執行了&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用於打印日志，并且在切入點方法(業務層方法)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="meta">@AfterReturning(&quot;expr()&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturnLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;2.0 Logger中的afterReturnLog方法開始執行了&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用於打印日志，并且在切入點方法(業務層方法)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="meta">@AfterThrowing(&quot;expr()&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;3.0 Logger中的afterThrowLog方法開始執行了&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用於打印日志，并且在切入點方法(業務層方法)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="meta">@After(&quot;expr()&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;4.0 Logger中的afterLog方法開始執行了&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
</ol>
<h2 id="spring中的jdbctemplate">Spring中的JdbcTemplate</h2>
<ol type="1">
<li>概述
<ul>
<li>Spring框架提供了很多操作的模板類，關係型數據庫的<code>JdbcTemplate</code>,
<code>HibernateTemplate</code>,
NoSQL的<code>RedisTemplate</code>,消息隊列的<code>JmsTemplate</code></li>
<li>JdbcTemplate需要<code>mysql-connector-java</code>,
<code>spring-jdbc.jar</code>, <code>spring-tx.jar</code>的支持</li>
<li>JdbcTemplate用來和數據庫交互，實現對表的CRUD操作</li>
<li>基本使用:
通過Spring提供的<code>DriverManagerDataSource</code>來配置數據源，然後通過<code>JdbcTemplate</code>來操作數據庫
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">   DriverManagerDataSource ds = <span class="keyword">new</span> DriverManagerDataSource();</span><br><span class="line">   ds.setDriverClassName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">   ds.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/xmlioc&quot;</span>);</span><br><span class="line">   ds.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">   ds.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">   <span class="comment">// JdbcTemplage jt = new JdbcTemplate()</span></span><br><span class="line">   <span class="comment">// jt.setDataSource(ds);</span></span><br><span class="line">   JdbcTemplate jt = <span class="keyword">new</span> JdbcTemplate(ds);</span><br><span class="line">   jt.execute(<span class="string">&quot;insert into account(name, money) values(&#x27;ttt&#x27;, 1000)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>配置XML使用
<ul>
<li><code>bean.xml</code> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置JdbcTemplate--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    配置dataSource--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/xmlioc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">   ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">   JdbcTemplate jt = ctx.getBean(<span class="string">&quot;jdbcTemplate&quot;</span>, JdbcTemplate.class);</span><br><span class="line">   jt.execute(<span class="string">&quot;insert into account(name, money) values (&#x27;xxx&#x27;, 2500)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li>通過JdbcTemplate進行CRUD
<ul>
<li>保存數據 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jt.update(<span class="string">&quot;insert into account(name, money) values (?, ?)&quot;</span>, <span class="string">&quot;xxx&quot;</span>, <span class="number">2500</span>);</span><br></pre></td></tr></table></figure></li>
<li>更新數據 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jt.update(<span class="string">&quot;update account set money = ?， name = ? where id = ?&quot;</span>, <span class="number">3000</span>, <span class="string">&quot;xxx&quot;</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure></li>
<li>刪除數據 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jt.update(<span class="string">&quot;delete from account where id = ?&quot;</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure></li>
<li>查詢所有
<ul>
<li>手寫RowMapper <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Account&gt; accounts = jt.query(<span class="string">&quot;select * from account where money &gt; ?&quot;</span>, <span class="keyword">new</span> AccountRowMapper(), <span class="number">1000f</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Account acc: accounts) &#123;</span><br><span class="line">   System.out.println(acc);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 封裝實現類，把一行封裝成一個Bean對象，之後Spring可以自動把對象加入到List中</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountRowMapper</span> <span class="keyword">implements</span> <span class="title">RowMapper</span>&lt;<span class="title">Account</span>&gt; </span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Account <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">      Account account = <span class="keyword">new</span> Account();</span><br><span class="line">      account.setId(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">      account.setName(rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">      account.setMoney(rs.getFloat(<span class="string">&quot;money&quot;</span>));</span><br><span class="line">      <span class="keyword">return</span> account;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>使用Spring提供的<code>BeanPropertyRowMapper()</code>方法和Bean類
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Account&gt; accounts = jt.query(<span class="string">&quot;select * from account where money &gt; ?&quot;</span>, <span class="keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account.class), <span class="number">1000f</span>);</span><br><span class="line"><span class="keyword">for</span> (Account acc: accounts) &#123;</span><br><span class="line">   System.out.println(acc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>查詢一個 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Account&gt; accounts = jt.query(<span class="string">&quot;select * from account where id = ?&quot;</span>, <span class="keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account.class), <span class="number">1</span>);</span><br><span class="line">System.out.println(accounts.size() == <span class="number">0</span> ? <span class="string">&quot;沒有查詢到數據&quot;</span> : accounts.get(<span class="number">0</span>));</span><br></pre></td></tr></table></figure></li>
<li>查詢返回一行一列 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 防止integer容量不足</span></span><br><span class="line">Long count = jt.queryForObject(<span class="string">&quot;select count(*) from account where money &gt; ?&quot;</span>, Long.class, <span class="number">1000f</span>);</span><br><span class="line">System.out.println(count);</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Dao的兩種寫法
<ul>
<li>寫入JdbcTemplate, 需要配置bean.xml或者使用Autowired注解
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 賬戶的持久層實現類</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJdbcTemplate</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">      List&lt;Account&gt; accounts = jdbcTemplate.query(<span class="string">&quot;select * from account where id = ?&quot;</span>, <span class="keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account.class), id);</span><br><span class="line">      <span class="keyword">return</span> accounts.size() == <span class="number">0</span> ? <span class="keyword">null</span> : accounts.get(<span class="number">0</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountByName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">      List&lt;Account&gt; accounts = jdbcTemplate.query(<span class="string">&quot;select * from account where name = ?&quot;</span>, <span class="keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account.class), name);</span><br><span class="line">      <span class="keyword">if</span> (accounts.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (accounts.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Account數量大於1&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> accounts.get(<span class="number">0</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateAccount</span><span class="params">(Account acc)</span> </span>&#123;</span><br><span class="line">      jdbcTemplate.update(<span class="string">&quot;update account set name = ?, money = ? where id = ?&quot;</span>, acc.getName(), acc.getMoney(), acc.getId());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>不寫JdbcTemplate屬性，而是繼承<code>JdbcDaoSupport</code>類，這個類裏面有<code>JdbcTemplate</code>和<code>DataSource</code>，
但是這樣不能使用注解的<code>@Autowired</code> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 賬戶的持久層實現類</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">extends</span> <span class="title">JdbcDaoSupport</span> <span class="keyword">implements</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">      List&lt;Account&gt; accounts = jdbcTemplate.query(<span class="string">&quot;select * from account where id = ?&quot;</span>, <span class="keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account.class), id);</span><br><span class="line">      <span class="keyword">return</span> accounts.size() == <span class="number">0</span> ? <span class="keyword">null</span> : accounts.get(<span class="number">0</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountByName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">      List&lt;Account&gt; accounts = jdbcTemplate.query(<span class="string">&quot;select * from account where name = ?&quot;</span>, <span class="keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account.class), name);</span><br><span class="line">      <span class="keyword">if</span> (accounts.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (accounts.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Account數量大於1&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> accounts.get(<span class="number">0</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateAccount</span><span class="params">(Account acc)</span> </span>&#123;</span><br><span class="line">      jdbcTemplate.update(<span class="string">&quot;update account set name = ?, money = ? where id = ?&quot;</span>, acc.getName(), acc.getMoney(), acc.getId());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ol>
<h2 id="spring中的事務控制">Spring中的事務控制</h2>
<ol type="1">
<li>概述
<ul>
<li>JavaEE體系中，事務控制都是在業務層</li>
<li>Spring框架提供了一組事務控制的接口</li>
<li>Spring的事務控制是基於AOP的，可以通過編程方式實現，也可以通過配置方式實現</li>
</ul></li>
<li>Spring提供的事務控制API
<ul>
<li><code>pom.xml</code>中配置maven坐標 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><code>PlatformTransactionManager</code>接口
<ul>
<li><code>TransactionStatus getTransaction()</code>,
<code>void commit()</code>, <code>void rollback()</code></li>
<li>實現類:
<ul>
<li><code>DataSourceTransactionManager</code>: 使用Spring
JDBC或者iBatis進行持久化數據的時候使用</li>
<li><code>HibernateTransactionManager</code>:
使用Hibernate進行持久化數據的時候使用</li>
<li><code>JpaTransactionManager</code>:
使用JPA進行持久化數據的時候使用</li>
<li><code>JtaTransactionManager</code>:
使用JTA進行持久化數據的時候使用</li>
</ul></li>
</ul></li>
</ul></li>
<li>基於XML的聲明式事務控制配置
<ul>
<li>網路資料的數據庫隔離性
<ul>
<li>髒讀，不可重複讀，幻讀
<ul>
<li>臟讀(dirty read):
事務A正在訪問數據，并且進行了修改，但是沒有提交到數據庫，事務B也訪問了數據，并且使用了數據，這是B發生了髒讀，因爲A可能回滾，數據不一定會寫到數據庫中</li>
<li>不可重複讀(non-repeatable
read)：事務A訪問數據，期間事務B訪問了數據，并進行了修改，這樣事務A下一次讀取數據庫會得到不同的數據，這樣A發生了不可重複讀</li>
<li>幻讀(phantom problem):
在事務不是獨立執行的時候發生，同樣的查詢執行兩次，返回結果的行數不一致，就像幻覺一樣</li>
</ul></li>
<li>數據庫事務隔離級別
<ul>
<li><code>default</code>: 使用數據庫設置的隔離級別</li>
<li><code>read_uncommitted</code>:
可能出現髒讀，不可重複讀，幻讀。最低隔離級別，并發性高</li>
<li><code>read_committed</code>:
可能出現不可重複讀，幻讀。鎖定正在讀取的行</li>
<li><code>repeatable_read</code>: 幻讀。鎖定所讀取的所有行</li>
<li><code>serializable</code>:
保證不會出現髒讀，不可重複讀，幻讀。鎖定整個表</li>
</ul></li>
<li>Spring事務的傳播行爲
<ul>
<li>事務的傳播行爲指的是一個事務調用了另一個事務，那麽應該繼續在這個事務處理，還是開啓新事務，還是其他等等</li>
<li>傳播行爲分類
<ul>
<li><code>PROPAGATION_REQUIRED</code>：當前方法必須運行在事務中。如果存在事務，則加入事務，如果沒有事務，則啓動一個新事務</li>
<li><code>PROPAGATION_SUPPORTS</code>：當前方法支持運行在事務中。如果存在事務，則加入事務，否則非事務運行</li>
<li><code>PROPAGATION_MANDATORY</code>：當前方法必須運行在事務中。如果存在事務，則加入事務，否則抛出異常</li>
<li><code>PROPAGATION_REQUIRED_NEW</code>：當前方法必須運行在自己的事務中。如果存在事務，挂起已經存在的事務，啓動一個新事務執行</li>
<li><code>PROPAGATION_NOT_SUPPORTED</code>：當前方法不支持在事務中運行，如果存在事務，則挂起已經存在的事務，非事務運行</li>
<li><code>PROPAGATION_NEVER</code>：當前方法不能運行在事務中，如果存在當前事務，抛出異常</li>
<li><code>PROPAGATION_NESTED</code>：類似於<code>PROPAGATION_REQUIRED_NEW</code>，但是是嵌套事務</li>
</ul></li>
</ul></li>
</ul></li>
<li>配置<code>bean.xml</code>
<ul>
<li>配置事務管理器的bean</li>
<li>用<code>&lt;tx:advice id=? transaction-manager=?&gt;&lt;/tx:advice&gt;</code>配置事務的通知</li>
<li>用<code>&lt;tx:attributes&gt;&lt;/tx:attributes&gt;</code>配置事務的屬性
<ul>
<li><code>isolation</code>：指定事物的隔離級別，默認default</li>
<li><code>propagation</code>：
用於指定事務的傳播行爲，默認required，表示一定有事務，增刪改用這個，查詢可以設置爲supports</li>
<li><code>read-only</code>：
用於指定事務是否只讀，默認false，查詢應該是true，其他是false即可</li>
<li><code>timeout</code>：用於指定事務的超時時間，默認是-1，表示永遠不超時</li>
<li><code>rollback-for</code>：用於指定一個異常，產生這個異常的時候，事務回滾，其他異常的時候不回滾。沒有默認值，表示所有異常都回滾</li>
<li><code>no-rollback-for</code>：用於指定一個異常，產生這個異常的時候不回滾，其他都回滾。沒有默認值，表示所有異常都回滾</li>
</ul></li>
<li>用<code>&lt;tx:method name=? propagation=? read-only=?&gt;&lt;/tx:method&gt;</code>配置事務的方法，這個要在<code>&lt;tx:attributes&gt;</code>内部，查詢方法是<code>PROPAGATION_SUPPORTS</code>和<code>true</code>，其他方法是<code>PROPAGATION_REQUIRED</code>和<code>false</code></li>
<li>在AOP内部用<code>&lt;aop:pointcut id=? expression=?</code>配置通用切入點表達式</li>
<li>在AOP内部yong<code>&lt;aop:advisor advice-ref=? pointcut-ref=?</code>把切入點表達式和通知聯係起來，<code>advice-ref</code>是通知的id名，<code>pointcut-ref</code>是切入點表達式的id名
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--    配置賬戶持久層--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.dao.impl.AccountDaoImpl&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jdbcTemplate&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--    配置賬戶業務層--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.service.impl.AccountServiceImpl&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--    配置dataSource--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/xmlioc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--    配置事務管理器--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--    配置事務的通知--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 這個用來通配查詢方法--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:method</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 這個用來通配其他所有方法--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 配置AOP--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 配置公用切入點表達式--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt1&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.yanxuanshaozhu.service.impl.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 建立事務通知和切入點表達式的對應關係--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li>基於注解的聲明式事務控制
<ul>
<li>配置流程
<ul>
<li>使用<code>&lt;bean&gt;</code>標簽配置事務管理器</li>
<li>開啓Spring對注解事務的支持:
<code>&lt;tx:annotation-driven transaction-manager= ?&gt;&lt;/tx:annotation-driven&gt;</code></li>
<li>在需要事務的類和方法加上<code>@Transactional(propagation=?, read-only=?)</code>注解，按照對應方法來判斷傳播行爲和只讀屬性的值</li>
</ul></li>
<li>基於<code>bean.xml</code>和注解的事務控制 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">      https://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--    配置Spring創建容器時要掃描的包--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.yanxuanshaozhu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--配置JdbcTemplate--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--    配置dataSource--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/xmlioc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--    配置事務管管理器--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--    開啓Spring對注解事務的支持--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>基於純注解的事務控制
<ul>
<li>寫一個配置類入口 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.yanxuanshaozhu&quot;)</span> <span class="comment">// 設置創建容器時掃描的包</span></span><br><span class="line"><span class="meta">@Import(&#123;JdbcConfig.class, TransactionConfig.class&#125;)</span> <span class="comment">// 導入其他配置類</span></span><br><span class="line"><span class="meta">@PropertySource(value = &quot;jdbc.properties&quot;)</span> <span class="comment">// 加載jdbc.properties</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">//開啓Spring對注解的支持</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Jdbc配置類 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 鏈接數據庫相關的配置</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfig</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Value(&quot;$&#123;driver&#125;&quot;)</span> <span class="comment">// 取得properties文件中的值</span></span><br><span class="line">   <span class="keyword">private</span> String driver;</span><br><span class="line">   <span class="meta">@Value(&quot;$&#123;url&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String url;</span><br><span class="line">   <span class="meta">@Value(&quot;$&#123;user&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String user;</span><br><span class="line">   <span class="meta">@Value(&quot;$&#123;pwd&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String pwd;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 創建JdbcTemplate對象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="meta">@Bean(name = &quot;jdbcTemplate&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">createJdbcTemplate</span><span class="params">(DataSource ds)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(ds);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 創建一個數據源對象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="meta">@Bean(name = &quot;dataSource&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> DataSource <span class="title">createDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      DriverManagerDataSource ds = <span class="keyword">new</span> DriverManagerDataSource();</span><br><span class="line">      ds.setDriverClassName(driver);</span><br><span class="line">      ds.setUrl(url);</span><br><span class="line">      ds.setUsername(user);</span><br><span class="line">      ds.setPassword(pwd);</span><br><span class="line">      <span class="keyword">return</span> ds;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>創建事務管理器 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 和事務有關的類</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 創建事務管理器對象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="meta">@Bean(name = &quot;transactionManager&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">createTransactionManager</span><span class="params">(DataSource ds)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(ds);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>在需要事務的類和方法加上<code>@Transactional(propagation=?, read-only=?)</code>注解，按照對應方法來判斷傳播行爲和只讀屬性的值</li>
</ul></li>
</ul></li>
<li>編程式事務控制的方式
<ul>
<li>事務控制基本都是聲明式的，編程式的事務控制應用極少</li>
<li>在<code>bean.xml</code>中配置<code>&lt;bean id=? class="org.springframework.transaction.support.TransactionTemplate"&gt;&lt;/bean&gt;</code>標簽</li>
<li>業務層方法寫在<code>transactionTemplate.execute()</code>方法<code>的匿名内部</code>TransactionCallback<code>類的</code>doingTransaction()<code>方法中，如果有異常,</code>doingTransaction()<code>會調用</code>TransactionTemplate.rollback()<code>方法回滾，如果沒有異常,</code>doingTransaction()<code>會調用</code>TransactionTemplate.commit()`方法事務提交
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> IAccountDao accountDao;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 創建事務模板對象和set方法讓Spring來進行注入</span></span><br><span class="line">   <span class="keyword">private</span> TransactionTemplate transactionTemplate;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransactionTemplate</span><span class="params">(TransactionTemplate transactionTemplate)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.transactionTemplate = transactionTemplate;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountDao</span><span class="params">(IAccountDao accountDao)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.accountDao = accountDao;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accountDao.findAccountById(id);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 每一個需要事務的業務層方法都需要放在transactionTemplate.execute()方法中</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(String from, String to, <span class="keyword">float</span> amount)</span> </span>&#123;</span><br><span class="line">      transactionTemplate.execute(<span class="keyword">new</span> TransactionCallback&lt;Object&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">doInTransaction</span><span class="params">(TransactionStatus status)</span> </span>&#123;</span><br><span class="line">               Account fromAccount = accountDao.findAccountByName(from);</span><br><span class="line">               Account toAccount = accountDao.findAccountByName(to);</span><br><span class="line">               fromAccount.setMoney(fromAccount.getMoney() - amount);</span><br><span class="line">               accountDao.updateAccount(fromAccount);</span><br><span class="line">               toAccount.setMoney(toAccount.getMoney() + amount);</span><br><span class="line">               accountDao.updateAccount(toAccount);</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>可以發現，因爲每一個需要事務的方法都需要放在<code>transactionTemplate.execute()</code>中，有很多重複代碼，不利於解耦，因此實際上很少用到</li>
</ul></li>
</ol>
<h1 id="springmvc">SpringMVC</h1>
<h2 id="spring-mvc基礎">Spring MVC基礎</h2>
<ol type="1">
<li>基本概念
<ul>
<li>三層架構
<ul>
<li>架構:C/S 或者B/S</li>
</ul></li>
<li>三層架構
<ul>
<li>表現層：SpringMVC，表現層又叫做web層，主要負責接收客戶端的請求，向客戶端發送請求結果</li>
<li>業務層：Spring，負責業務邏輯處理，和項目中的需求挂鈎</li>
<li>持久層：MyBatis， 持久層又叫做dao層，負責數據持久化</li>
</ul></li>
<li>表現層框架MVC
<ul>
<li>Model模型：Java Bean，封裝數據</li>
<li>View視圖：JSP，用來和用戶進行交互</li>
<li>Controller控制器: Servlet，用來接受請求和返回數據</li>
</ul></li>
<li>SpringMVC是一個基於Java實現的MVC設計模型的請求驅動類型的輕量級Web框架，屬於Springframework的後續產品。Spring框架整合SpringMVC比整合其他的表現層框架要容易</li>
</ul></li>
<li>SpringMVC的Maven環境配置
<ul>
<li>創建maven攻城的時候選<code>Create from atchetype</code>裏面的<code>org.apache.maven.archetypes:maven-archetype-webapp</code></li>
<li>配置流程
<ul>
<li>導入相關依賴: <code>spring-contexg</code>, <code>spring-web</code>,
<code>spring-webmvc</code>, <code>javax.servlet-api</code>,
<code>jsp-api</code>。
注意如果是tomcat10.x版本的話，tomcat的兩個maven依賴配置用新的。但是非常不幸，SpringMVC
5.x版本不支持tomcat10.x，所以要改成tomcat9.x，所以還是要用舊的... <span style="color:red;">之前使用Tomcat10.x的時候這裏使用的是自己寫的Servlet類，無論是實現接口還是繼承HttpServlet，都是用的Tomcat10.x的Jakarta的命名空間，但是這裏用的是Spring内部實現類，用的依舊是舊版的Javax命名空間，所以必須使用Tomcat9.x或者之前的版本
</span> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 新版本API，傳説Spring framework 6.x會支持這個API --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>版本號<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>版本號<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 舊版本API --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>創建SpringMVC控制器類(等同於Servlet功能)，這個針對不同的請求和請求路徑寫多個方法即可
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用Controller定義bean</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ControllerDemo</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 設置當前方法的訪問路徑</span></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">   <span class="comment">// 當前方法的返回值作爲請求體返回給客戶端</span></span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Save 方法執行了&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;: &#x27;saved&#x27;&#125;&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>初始化SpringMVC配置環境，設定SpringMVC環境加載對應的bean。注意SpringMVC和Spring掃描的包應該不一樣，SpringMVC應該只掃描<code>controller</code>包，Spring應該只掃描<code>dao</code>包和<code>service</code>包
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 創建springmvc的配置文件，加載controller對應的bean</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// SpringMVC掃描的包</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.yanxuanshaozhu.controller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMvcConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 創建Spring的配置文件，加載dao和service對應的bean</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// Spring掃描的包，有兩種寫法，一種是寫多個包路徑，一般主要有這個</span></span><br><span class="line"><span class="comment">// @ComponentScan(&quot;com.yanxuanshaozhu.dao&quot;, &quot;com.yanxuanshaozhu.service&quot;)</span></span><br><span class="line"><span class="comment">// 第二種寫法是使用excludeFilters屬性，排除掉不需要掃描的包，SpringBoot使用了這種方法</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.yanxuanshaozhu&quot;,</span></span><br><span class="line"><span class="meta">      excludeFilters = @ComponentScan.Filter(</span></span><br><span class="line"><span class="meta">               type = FilterType.ANNOTATION,  // 按照注解排除</span></span><br><span class="line"><span class="meta">               classes = Controller.class // 排除被@Controller注解的类</span></span><br><span class="line"><span class="meta">      ))</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>初始化Servlet容器，加載SpringMVC和Spring的環境，并且設置SpringMVC技術處理的請求
<ul>
<li>標準寫法 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定義Servlet容器啓動的配置類，從而在Servlet啓動的時候加載Sprng的配置類</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletInitializer</span> <span class="keyword">extends</span> <span class="title">AbstractDispatcherServletInitializer</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 加載SpringMVC容器的配置</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> WebApplicationContext <span class="title">createServletApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 創建SpringMVC的配置類，不能用AnnotationConfigApplicationContext，只能用AnnotationConfigWebApplicationContext</span></span><br><span class="line">      AnnotationConfigWebApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigWebApplicationContext();</span><br><span class="line">      ctx.register(SpringMvcConfiguration.class);</span><br><span class="line">      <span class="keyword">return</span> ctx;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 規定哪些請求路徑會被SpringMVC處理</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">      <span class="comment">// 所有請求路徑規SpringMVC處理</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">&quot;/&quot;</span>&#125;;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 加載Spring容器的配置</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> WebApplicationContext <span class="title">createRootApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      AnnotationConfigWebApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigWebApplicationContext();</span><br><span class="line">      ctx.register(SpringConfiguration.class);</span><br><span class="line">      <span class="keyword">return</span> ctx;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>簡化寫法：<code>AbstractAnnotationConfigDispatcherServletInitializer</code>繼承了<code>AbstractDispatcherServletInitializer</code>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletInitializer</span> <span class="keyword">extends</span> <span class="title">AbstractAnnotationConfigDispatcherServletInitializer</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 加載Spring的配置類</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Class[]&#123;SpringConfiguration.class&#125;;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 加載SpringMVC的配置類</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Class[]&#123;SpringMvcConfiguration.class&#125;;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 規定哪些請求路徑由SpringMVC處理</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">&quot;/&quot;</span>&#125;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>使用Postman進行測試get請求和post請求
<ul>
<li>創建workspace和collection來保存測試，方便以後使用</li>
</ul></li>
</ul></li>
</ul></li>
</ol>
<h2 id="springmvc的請求和響應">SpringMVC的請求和響應</h2>
<ol type="1">
<li>SpringMVC處理請求
<ul>
<li>不同模塊的相同請求路徑有兩種寫法
<ul>
<li>方法1:
每個模塊的方法内部注解加上模塊名前綴，如<code>@RequestMapping("/user/save")</code>，<code>@RequestMapping("/book/save")</code></li>
<li>方法2: 每個模塊上面加上請求路徑注解,
如<code>@RequestMapping("/user")</code>，<code>@RequestMapping("/book")</code>，這樣模塊内部的方法就不用每一個方法的注解都加上路徑前綴了</li>
</ul></li>
<li>請求參數類型和具體寫法
<ul>
<li>Controller和Servlet不一樣，Controller裏面的方法不區分接受的是get請求還是post請求</li>
<li>服務器中方法寫具體參數:
使用<code>@Request("請求參數") T 方法參數</code>
完成請求參數和方法參數的對應，如果請求參數和方法參數的名字一樣，可以省略掉注解直接寫<code>T 請求參數/方法參數</code>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/info&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">info</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String name, <span class="meta">@RequestParam(&quot;age&quot;)</span> <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">   System.out.println(<span class="string">&quot;User info&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;user&#x27;:&#123;&#x27;type&#x27;: &#x27;info&#x27;, &#x27;name&#x27;: &quot;</span> + name + <span class="string">&quot;, &#x27;age&#x27;: &quot;</span> + age + <span class="string">&quot;&#125;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>服務器中方法寫對象參數: <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/userInfo&quot;, produces = &quot;text/html;charset=utf-8&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">info</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">   System.out.println(<span class="string">&quot;User info with object&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;user&#x27;:&#123;&#x27;type&#x27;: &#x27;info&#x27;, &#x27;name&#x27;: &quot;</span> + user.getName() + <span class="string">&quot;, &#x27;age&#x27;: &quot;</span> + user.getAge() + <span class="string">&quot;&#125;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>服務器中方法寫對象+嵌套對象參數傳遞:
這時候請求端參數要寫<code>name</code>, <code>age</code>,
<code>address.city</code>,
<code>address.province</code>用點分隔嵌套對象和屬性 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/userNestedInfo&quot;, produces = &quot;text/html;charset=utf-8&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">infoNested</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">   System.out.println(<span class="string">&quot;User info with nested object&quot;</span>);</span><br><span class="line">   System.out.println(user);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;user&#x27;:&#123;&#x27;type&#x27;: &#x27;info&#x27;, &#x27;name&#x27;: &quot;</span> + user.getName() + <span class="string">&quot;, &#x27;age&#x27;: &quot;</span> + user.getAge() +</span><br><span class="line">            <span class="string">&quot;, &#x27;city&#x27;: &quot;</span> + user.getAddress().getCity() + <span class="string">&quot;, &#x27;province&#x27;: &quot;</span> + user.getAddress().getProvince() + <span class="string">&quot;&#125;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>服務器中方法寫數組參數: 這時候請求端數組裏面的參數的key要相同
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/arrayInfo&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">arrayInfo</span><span class="params">(<span class="meta">@RequestParam(&quot;請求端數組名&quot;)</span> String[] args)</span> </span>&#123;</span><br><span class="line">   System.out.println(Arrays.toString(args));</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;arrayInfo&#x27;: &#x27;resp&#x27; &#125;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>服務器中方法寫集合參數:
這時候請求端數組裏面的參數的key要相同，并且服務器中方法參數前加上<code>@RequestParam</code>注解，否則服務器會試圖把請求參數傳入集合的屬性
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/listInfo&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">arrayInfo</span><span class="params">(<span class="meta">@RequestParam(&quot;請求端數組名&quot;)</span> List&lt;String&gt; args)</span> </span>&#123;</span><br><span class="line">   System.out.println(args);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;listInfo&#x27;: &#x27;resp&#x27; &#125;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>客戶端和服務器之間傳遞JSON
<ul>
<li>首先在項目中加入<code>jackson-databind</code>依賴</li>
<li>在SpringMVC的配置類上面加入<code>@EnableWebMvc</code>注解，開啓JSON和Java對象的轉換功能</li>
<li>在服務器方法參數前加入<code>@RequestBody</code>注解
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 傳遞JSON數組</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/jsonArray&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">jsonArray</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;String&gt; args)</span> </span>&#123;</span><br><span class="line">   System.out.println(args);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;jsonArrayInfo&#x27;: &#x27;resp&#x27;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 傳遞JSON對象</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/jsonObject&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">jsonObject</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">   System.out.println(user);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;user&#x27;:&#123;&#x27;type&#x27;: &#x27;info&#x27;, &#x27;name&#x27;: &quot;</span> + user.getName() + <span class="string">&quot;, &#x27;age&#x27;: &quot;</span> + user.getAge() +</span><br><span class="line">            <span class="string">&quot;, &#x27;city&#x27;: &quot;</span> + user.getAddress().getCity() + <span class="string">&quot;, &#x27;province&#x27;: &quot;</span> + user.getAddress().getProvince() + <span class="string">&quot;&#125;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 傳遞JSON對象數組</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/jsonObjectArray&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">jsonObjectArray</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;User&gt; users)</span> </span>&#123;</span><br><span class="line">   StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">   builder.append(<span class="string">&quot;[\n&quot;</span>);</span><br><span class="line">   <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">         builder.append(<span class="string">&quot;&#123;&#x27;user&#x27;:&#123;&#x27;type&#x27;: &#x27;info&#x27;, &#x27;name&#x27;: &quot;</span> + user.getName() + <span class="string">&quot;, &#x27;age&#x27;: &quot;</span> + user.getAge() +</span><br><span class="line">               <span class="string">&quot;, &#x27;city&#x27;: &quot;</span> + user.getAddress().getCity() + <span class="string">&quot;, &#x27;province&#x27;: &quot;</span> + user.getAddress().getProvince() + <span class="string">&quot;&#125;&#125;,\n&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   builder.replace(builder.length() - <span class="number">2</span>, builder.length(), <span class="string">&quot;&quot;</span>);</span><br><span class="line">   builder.append(<span class="string">&quot;\n]&quot;</span>);</span><br><span class="line">   String res = builder.toString();</span><br><span class="line">   System.out.println(res);</span><br><span class="line">   <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>客戶端和服務器之間傳遞日期
<ul>
<li>SpringMVC默認支持標準格式(<code>年/月/日</code>，或者<code>月/日/年</code>)的日期字符串自動轉換成Date對象</li>
<li>對於非標準日期格式，需要使用<code>@DateTimeFormat(pattern="請求參數日期格式")</code>注解修飾請求參數，否則報錯，
比如<code>@DateTimeFormat(pattern = "yyyy-dd-MM") @RequestParam("data") Date date</code></li>
<li>内部原理:
spring-core中的<code>Converter</code>接口有衆多實現類，完成了輸入類型到目標類型的轉換。<code>@EnableWebMvc</code>注解開啓之後可以根據類型匹配對應的類型轉換器</li>
</ul></li>
<li>請求參數包括中文可能會有亂碼，需要進行處理:
<ul>
<li>處理在服務器内部中文亂碼:
在初始化Servlet容器的類裏面加上一個過濾器，設置服務器的charsetEncoding為UTF-8
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Filter[] getServletFilters() &#123;</span><br><span class="line">   CharacterEncodingFilter filter = <span class="keyword">new</span> CharacterEncodingFilter();</span><br><span class="line">   filter.setEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Filter[]&#123;filter&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>處理響應中文亂碼
<ul>
<li>第一步: 按照上面的方法首先處理服務器内部中文亂碼</li>
<li>第二部：修改相關Controller内部的<code>@RequestMapping()</code>注解，加上<code>produced</code>屬性，比如<code>@RequestMapping(value= "/info", produces = "text/html;charset=utf-8")</code></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li>SpringMVC發送響應
<ul>
<li>頁面跳轉
<ul>
<li>直接返回字符串：這種方式會將返回的字符串和視圖解析器的前後綴拼接后跳轉
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在SpringConfiguration.java中</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ViewResolver <span class="title">configureViewResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 用來返回指定目錄下的指定後綴的文件</span></span><br><span class="line">   InternalResourceViewResolver internalResourceViewResolver = <span class="keyword">new</span> InternalResourceViewResolver();</span><br><span class="line">   <span class="comment">// 設置訪問前綴</span></span><br><span class="line">   internalResourceViewResolver.setPrefix(<span class="string">&quot;/WEB-INF/jsp/&quot;</span>);</span><br><span class="line">   <span class="comment">// 設置訪問後綴</span></span><br><span class="line">   internalResourceViewResolver.setSuffix(<span class="string">&quot;.jsp&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> internalResourceViewResolver;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在UserController.java中</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/info&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">info</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;info&quot;</span>;   <span class="comment">// 這代表自動跳轉到/WEB-INF/jsp/info.jsp</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>通過<code>ModelAndView</code>返回:
Model是用來封裝數據的，View是用來展示數據的 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/info&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">info</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">   <span class="comment">// 設置展示頁面名稱，同樣會拼接視圖解析器的前後綴</span></span><br><span class="line">   modelAndView.setViewName(<span class="string">&quot;info&quot;</span>);  <span class="comment">// 訪問/WEB-INF/jsp/info.jsp</span></span><br><span class="line">   <span class="comment">// 通過模型添加數據，在頁面上可以通過$&#123;key&#125;來拿到數據</span></span><br><span class="line">   modelAndView.addObject(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;張三&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ModelAndView可以使用Spring直接注入，不用自己去new</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/info&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">info</span><span class="params">(ModelAndView modelAndView)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 設置展示頁面名稱，同樣會拼接視圖解析器的前後綴</span></span><br><span class="line">   modelAndView.setViewName(<span class="string">&quot;info&quot;</span>);  <span class="comment">// 訪問/WEB-INF/jsp/info.jsp</span></span><br><span class="line">   <span class="comment">// 通過模型添加數據，在頁面上可以通過$&#123;key&#125;來拿到數據</span></span><br><span class="line">   modelAndView.addObject(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;張三&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 還可以只讓Spring注入Model數據，返回字符串跳轉頁面</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/info&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">info</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 通過Model添加數據</span></span><br><span class="line">   model.addAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;張三&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;info&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 類似的寫法是注入一個HttpServletRequest對象</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/info&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">info</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 通過Model添加數據</span></span><br><span class="line">   request.addAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;張三&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;info&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>回寫數據
<ul>
<li>直接返回字符串 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 讓Spring注入HttpServletResponse對象，在寫數據到頁面上，耦合度高</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/info&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">info</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">   response.getWriter().writer(<span class="string">&quot;直接在頁面上寫入的字符串&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用@ResponseBody注解，耦合度地</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/info&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">info</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;直接在頁面上寫入的字符串&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>返回JSON字符串的Java對象
<ul>
<li>加入<code>jackson-databind</code>依賴</li>
<li>使用<code>@ResponseBody</code>注解，返回JSON數據 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/jsonData&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">userInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   System.out.println(<span class="string">&quot;Respond json object&quot;</span>);</span><br><span class="line">   User user = <span class="keyword">new</span> User();</span><br><span class="line">   user.setName(<span class="string">&quot;jing wang&quot;</span>);</span><br><span class="line">   user.setAge(<span class="number">12</span>);</span><br><span class="line">   Address address = <span class="keyword">new</span> Address();</span><br><span class="line">   address.setCity(<span class="string">&quot;xicheng&quot;</span>);</span><br><span class="line">   address.setProvince(<span class="string">&quot;beijing&quot;</span>);</span><br><span class="line">   user.setAddress(address);</span><br><span class="line">   <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li><code>@ResponseBody</code>注解
<ul>
<li>作用：設置當前控制器方法的返回值作爲響應躰</li>
<li>内部原理:
使用<code>HttpMessageConverter</code>接口的實現類<code>MappingJackson2HttpMessageConverter</code>完成轉換</li>
</ul></li>
</ul></li>
</ol>
<h2 id="rest風格">REST風格</h2>
<ol type="1">
<li>簡介
<ul>
<li>定義 REST(Representional State Transfer)，表現形式狀態轉換</li>
<li>傳統風格資源描述方式和REST風格資源描述舉例
<ul>
<li>傳統風格
<ul>
<li>查詢用戶信息
<code>http://localhost:8080/user/getById?id=1</code></li>
<li>保存用戶信息 <code>http://localhost:8080/user/save</code></li>
</ul></li>
<li>REST風格
<ul>
<li>查詢用戶信息 <code>http://localhost:8080/user/1</code></li>
<li>保存用戶信息 <code>http://localhost:8080/user</code></li>
</ul></li>
<li>REST風格優點
<ul>
<li>書寫簡化</li>
<li>隱藏資源的訪問行爲，無法通過URL得知是對資源的何種操作</li>
</ul></li>
<li>REST風格通過行爲的不同來實現CRUD的區別
<ul>
<li>查詢全部用戶信息 <code>http://localhost:8080/users</code>
GET方法</li>
<li>查詢指定用戶信息 <code>http://localhost:8080/users/1</code>
GET方法</li>
<li>添加用戶信息 <code>http://localhost:8080/users</code>
POST方法(新增/保存)</li>
<li>修改用戶信息 <code>http://localhost:8080/users</code>
PUT方法(修改/更新)</li>
<li>刪除指定用戶信息 <code>http://localhost:8080/users/1</code>
DELETE方法</li>
</ul></li>
<li>REST風格裏URL的模塊名稱用複數</li>
<li>根據REST風格對資源進行訪問叫做RESTful</li>
</ul></li>
</ul></li>
<li>RESTful入門案例
<ul>
<li>幾個注解比較
<ul>
<li><code>@RequestBody</code>用於接受請求體中的JSON數據</li>
<li><code>@RequestParam</code>用於接受URL地址中key=value形式的數據</li>
<li><code>@PathVariable</code>用於接受URL路徑參數，使用<code>&#123;參數名&#125;</code>描述路徑參數</li>
</ul></li>
<li>Rest風格實現:
使用<code>@RequestMapping</code>注解的<code>method</code>屬性指定請求的訪問方式，
使用<code>@PathVariable</code>注解指定訪問路徑中的參數
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 增加新數據</span></span><br><span class="line">   <span class="meta">@RequestMapping(method = RequestMethod.POST)</span></span><br><span class="line">   <span class="meta">@ResponseBody</span> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Add method called&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Add method called&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 刪除數據</span></span><br><span class="line">   <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.DELETE)</span></span><br><span class="line">   <span class="meta">@ResponseBody</span> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">deleteById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Delete method called by id &quot;</span> + id);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Delete method called by id&quot;</span> + id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 修改數據</span></span><br><span class="line">   <span class="meta">@RequestMapping(method = RequestMethod.PUT)</span></span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Update method called&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot; Update method called&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//查找所有數據</span></span><br><span class="line">   <span class="meta">@RequestMapping(method = RequestMethod.GET)</span></span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">searchAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;SearchAll method called&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;SearchAll method called&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 查找單個數據</span></span><br><span class="line">   <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">searchByID</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;SearchById method called by id &quot;</span> + id);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;SearchById method called by id &quot;</span> + id;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>快速開發的簡寫
<ul>
<li>如果每個方法都有<code>@ResponseBody</code>注解的話，這個注解就可以放到類上面11</li>
<li><code>@Controller</code>注解和<code>@ResponseBody</code>注解一起出現的話，等價於<code>@RestController</code>注解</li>
<li><code>@RequestMapping(method = RequestMethod.POST)</code>注解等價於<code>@PostMapping</code>注解，其他請求方法的等價性是類似的</li>
</ul></li>
<li>入門案例
<ul>
<li>注意對於網站的靜態資源不應該經過SpringMVC的處理，應該是由Servlet容器直接訪問，因此需要增加一個配置類，設置攔截路徑，并讓SpringMVC的配置類掃描這個類/導入這個類
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SpringMVC的支持配置類</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMvcConfigurationSupport</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 黨訪問pages目錄下面的資源的時候，不被MVC攔截，而是讓Servlet直接訪問資源</span></span><br><span class="line">      <span class="comment">// **代表任意目錄</span></span><br><span class="line">      registry.addResourceHandler(<span class="string">&quot;/pages/**&quot;</span>).addResourceLocations(<span class="string">&quot;/pages/&quot;</span>);</span><br><span class="line">      registry.addResourceHandler(<span class="string">&quot;/js/**&quot;</span>).addResourceLocations(<span class="string">&quot;/js/&quot;</span>);</span><br><span class="line">      registry.addResourceHandler(<span class="string">&quot;/css/**&quot;</span>).addResourceLocations(<span class="string">&quot;/css/&quot;</span>);</span><br><span class="line">      registry.addResourceHandler(<span class="string">&quot;/plugins/**&quot;</span>).addResourceLocations(<span class="string">&quot;/plugins/&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SpringMVC的配置類</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.yanxuanshaozhu.controller&quot;, &quot;com.yanxuanshaozhu.config&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMvcConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>注意前端頁面在訪問服務器的時候，路徑要從項目虛擬目錄開始寫，比如<code>axio.get("/項目虛擬目錄/請求資源路徑")</code></li>
</ul></li>
</ul></li>
</ol>
<h1 id="mybatis">MyBatis</h1>
<h2 id="mybatis基礎">MyBatis基礎</h2>
<ol type="1">
<li>原始JDBC操作分析
<ul>
<li>原始操作 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line">PreparedStatement pstmt = conn.prepareStatement(sql);</span><br><span class="line"><span class="comment">// 查詢</span></span><br><span class="line">ResultSet rs = pstmt.executeQuery();</span><br><span class="line"><span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">   <span class="comment">// 封裝數據庫中一行到JavaBean</span></span><br><span class="line">&#125;</span><br><span class="line">rs.close();</span><br><span class="line">stmt.close();</span><br><span class="line">conn.close();</span><br><span class="line"><span class="comment">// 增刪改數據</span></span><br><span class="line">pstmt.executeUpdate();</span><br><span class="line">stmt.close();</span><br><span class="line">conn.close();</span><br></pre></td></tr></table></figure></li>
<li>原始JDBC缺陷分析和解決方式
<ul>
<li>數據庫頻繁創建，釋放資源浪費系統性能： 使用數據連接池</li>
<li>sql數據硬編碼不易維護：將sql語句抽取到xml配置文件中或者使用注解進行配置</li>
<li>查詢中結果中數據和JavaBean對象的映射需要手動配置：使用反射進行自動填充</li>
</ul></li>
</ul></li>
<li>MyBatis基礎
<ul>
<li>簡介
<ul>
<li>MyBatis是一個Java持久層框架，它内部封裝了JDBC，執行sql語句并且將結果映射為Java對象返回，屏蔽了底層細節，使得開發者只需要關注sql語句本身</li>
<li>MyBatis通過xml或者注解的方式將statement配置起來，應且通過Java對象和statement中的動態參數進行映射生成最終執行的sql語句</li>
</ul></li>
<li>項目配置流程
<ul>
<li>導入mybatis的jar<code>mybatis-x.x.x.jar</code>包或者在pom.xml中配置mybatis的坐標，還需要數據庫驅動
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>創建數據庫中表XXX</li>
<li>在項目中創建XXX實體類</li>
<li>編寫映射文件<code>XXXMapper.xml</code>：寫sql語句，路徑和JavaBean對應，比如<code>java</code>目錄下面的<code>com.yanxuanshaozhu.model.XXX</code>，就要寫<code>resources</code>目錄下面的<code>com/yanxuanshaozhu/config/XXXMapper.xml</code>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 這個表的格式直接在mybatis官網複製即可 --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">      <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">      <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在Java程序裏面通過使用namespaceId.methodId的方式調用sql，比如userMapper.findAll --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;userMapper&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 查詢寫上結果對應的JavaBean對象，mybatis就可以自動設置映射 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">      select * from User;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span>            </span><br></pre></td></tr></table></figure></li>
<li>編寫核心文件<code>SqlMapConfig.xml</code>：寫mybatis的核心配置，和上面的<code>XXXMapper.xml</code>文件放在同一個目錄中
<ul>
<li><code>transactionManager</code>:
可選為<code>JDBC</code>(通過JDBC管理事務)或者<code>MANAGED</code>(通過容器管理事務，很少使用)</li>
<li><code>dataSource</code>: 可選為<code>POOLED</code>(連接池),
<code>UNPOOLED</code>(不使用連接池), <code>JNDI</code>(很少用)</li>
<li><code>mappers</code>内部的<code>mappter</code>使用<code>resource</code>配置相對於<code>resources</code>目錄的路徑,
或者用<code>url</code>配置磁盤上絕對路徑,
或者用<code>class</code>類映射器接口實現類的全限定類名,
或者用<code>name</code>將包内的映射器接口實現全部注冊爲映射器</li>
<li><code>properties</code>加載外部配置文件，防止核心配置文件中硬編碼</li>
<li><code>typeAliases</code>和内部的<code>typeAlias</code>定義別名
<ul>
<li>這樣在映射文件<code>XXXMapper.xml</code>内部就可以不寫全限定類名，而是寫別名，簡化開發</li>
<li>在<code>configuration</code>内部最開始寫<code>properties</code>,
再寫<code>typeAliases</code>, 再寫<code>typeHandlers</code>,
再寫<code>environments</code>, 再寫<code>mappers</code>, 順序固定</li>
<li>MyBatis内部定義了基本類型和String等的別名(Integer-&gt; int, String
-&gt;string) <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--這個表的格式直接在mybatis官網複製即可  --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">      <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">      <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;com/yanxuanshaozhu/properties/db.properties&quot;</span>/&gt;</span>      </span><br><span class="line">      <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.yanxuanshaozhu.domain.User&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">typeAlias</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 可以配置多個環境，然後選擇一個默認環境 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- transactionManager和dataSource這裏都是固定寫法  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!-- 下面使用$&#123;鍵名&#125;讀取了db.properties中的内容  --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 配個多個mapper，用來加載映射文件 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/yanxuanshaozhu/mapper/UserMapper.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li>編寫測試類 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">   <span class="comment">// 獲取核心配置文件</span></span><br><span class="line">   InputStream in = Resources.getResourceAsStream(<span class="string">&quot;com/yanxuanshaozhu/mapper/SqlMapperConfig.xml&quot;</span>);</span><br><span class="line">   <span class="comment">// 通過工廠對象的build方法加載核心配置文件，從而獲得session工廠對象</span></span><br><span class="line">   SqlSessionFactory sqlSessionFactory= <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">   <span class="comment">// 獲得session會話對象，并且自動提交事務</span></span><br><span class="line">   <span class="comment">// sqlSessionFactory.openSession()和sqlSessionFactory.openSession(false)都不會自動提交事務，需要手動sqlSession.commit()</span></span><br><span class="line">   SqlSession sqlSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">   <span class="comment">// 執行操作，參數是namespaceId.methodId</span></span><br><span class="line">   List&lt;Object&gt; userList = sqlSession.selectList(<span class="string">&quot;userMapper.findAll&quot;</span>);</span><br><span class="line">   System.out.println(userList);</span><br><span class="line">   <span class="comment">// 釋放資源</span></span><br><span class="line">   sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>MyBatis簡單增刪改查操作
<ul>
<li>插入 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;userMapper&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 插入數據，數據來源於JavaBean，這裏使用了別名--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 這裏使用#&#123;JavaBean對象屬性名指定數據來源&#125; --&gt;</span></span><br><span class="line">      insert into User(username, password) values(#&#123;username&#125;, #&#123;password&#125;)</span><br><span class="line">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">InputStream in = Resources.getResourceAsStream(<span class="string">&quot;com/yanxuanshaozhu/mapper/SqlMapperConfig.xml&quot;</span>);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setUsername(<span class="string">&quot;insertedName&quot;</span>);</span><br><span class="line">user.setPassword(<span class="string">&quot;insertedPassword&quot;</span>);</span><br><span class="line">sqlSession.insert(<span class="string">&quot;userMapper.add&quot;</span>, user);</span><br><span class="line">sqlSession.close();</span><br></pre></td></tr></table></figure></li>
<li>刪除 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;userMapper&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 刪除數據，條件來源於JavaBean，這裏使用了別名  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delete&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 這裏只有一個參數，#&#123;參數名&#125;裏面的參數名隨便寫什麽都可以 --&gt;</span></span><br><span class="line">   delete from user where id = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span>  </span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">InputStream in = Resources.getResourceAsStream(<span class="string">&quot;com/yanxuanshaozhu/mapper/SqlMapperConfig.xml&quot;</span>);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">sqlSession.delete(<span class="string">&quot;userMapper.delete&quot;</span>, <span class="number">6</span>);</span><br><span class="line">sqlSession.close();</span><br></pre></td></tr></table></figure></li>
<li>修改 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;userMapper&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 修改數據，數據來源於JavaBean，這裏使用了別名  --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">      update user set username = #&#123;username&#125;, password = #&#123;password&#125;</span><br><span class="line">      where id = #&#123;id&#125;;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span>  </span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">InputStream in = Resources.getResourceAsStream(<span class="string">&quot;com/yanxuanshaozhu/mapper/SqlMapperConfig.xml&quot;</span>);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setId(<span class="number">1</span>);</span><br><span class="line">user.setUsername(<span class="string">&quot;updatedName&quot;</span>);</span><br><span class="line">user.setPassword(<span class="string">&quot;updatedPwd&quot;</span>);</span><br><span class="line">sqlSession.update(<span class="string">&quot;userMapper.update&quot;</span>, user);</span><br><span class="line">sqlSession.close();</span><br></pre></td></tr></table></figure></li>
<li>查詢多個 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;userMapper&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 查詢數據，數據來源於JavaBean，這裏使用了別名  --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">      select * from User;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span>  </span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">InputStream in = Resources.getResourceAsStream(<span class="string">&quot;com/yanxuanshaozhu/mapper/SqlMapperConfig.xml&quot;</span>);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">List&lt;Object&gt; userList = sqlSession.selectList(<span class="string">&quot;userMapper.findAll&quot;</span>);</span><br><span class="line">System.out.println(userList);</span><br><span class="line">sqlSession.close();</span><br></pre></td></tr></table></figure></li>
<li>查詢一個 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;userMapper&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 查詢數據，數據來源於JavaBean，這裏使用了別名  --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">      select *</span><br><span class="line">      from user</span><br><span class="line">      where id = #&#123;id&#125;;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span>  </span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">InputStream in = Resources.getResourceAsStream(<span class="string">&quot;com/yanxuanshaozhu/mapper/SqlMapperConfig.xml&quot;</span>);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">User user = (User)sqlSession.selectOne(<span class="string">&quot;userMapper.findById&quot;</span>, <span class="number">1</span>);</span><br><span class="line">System.out.println(user);</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
</ol>
<h2 id="mybatis進階">MyBatis進階</h2>
<ol type="1">
<li>MyBatis的dao層實現
<ul>
<li>傳統實現方式：手寫Dao的代碼 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span></span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream in = Resources.getResourceAsStream(<span class="string">&quot;com/yanxuanshaozhu/mapper/config.xml&quot;</span>);</span><br><span class="line">            SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">            SqlSession sqlSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">            List&lt;User&gt; users = sqlSession.selectList(<span class="string">&quot;userMapper.findAll&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> users;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>通過代理開發方式實現：只需要編寫Dao層接口(這個接口一般叫<code>XXXMapper.java</code>)，由MyBatis根據接口的定義創建動態代理對象
<ul>
<li>遵循規範
<ol type="1">
<li><code>XXXMapper.xml</code>中的<code>namespace</code>屬性值要和Dao層的<code>XXXMapper.java</code>的全限定類名一致(注意这里不能使用别名)</li>
<li><code>XXXMapper.java</code>接口中方法的方法名稱和<code>XXXMapper.xml</code>中的方法的<code>id</code>屬性一致</li>
<li><code>XXXMapper.java</code>接口中方法的返回類型和<code>XXXMapper.xml</code>中的方法的<code>resultType</code>屬性一致(注意比如返回值是<code>List&lt;User&gt;</code>，那么<code>resultType</code>屬性值是<code>user</code>即可)</li>
<li><code>XXXMapper.java</code>接口中方法的參數類型和<code>XXXMapper.xml</code>中的方法的<code>parameterType</code>屬性一致</li>
</ol></li>
<li>使用方法：在需要使用<code>XXXMapper</code>对象的时候，通过<code>XXXMapper xxxMapper = sqlSession.getMapper(XXXMapper.class)</code></li>
<li>一个例子 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在userMapper.xml文件中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.yanxuanshaozhu.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;commonSql&quot;</span>&gt;</span>select *</span><br><span class="line">      from user<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;commonSql&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">      where id = #&#123;id&#125;;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;commonSql&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">      update user</span><br><span class="line">      set username = #&#123;username&#125;,</span><br><span class="line">            password =#&#123;password&#125;</span><br><span class="line">      where id = #&#123;id&#125;;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">      insert into user (username, password)</span><br><span class="line">      values (#&#123;username&#125;, #&#123;password&#125;);</span><br><span class="line">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">      delete</span><br><span class="line">      from user</span><br><span class="line">      where id = #&#123;id&#125;;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserMapper.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">   <span class="function">User <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">   <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">updateById</span><span class="params">(User user)</span></span>;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(User user)</span></span>;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">InputStream in = Resources.getResourceAsStream(<span class="string">&quot;com/yanxuanshaozhu/mapper/config.xml&quot;</span>);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// MyBatis通过动态代理创建对象</span></span><br><span class="line">UserDao userDao = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">User user = userDao.findById(<span class="number">1</span>);</span><br><span class="line">System.out.println(user);</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li>動態SQL
<ul>
<li>動態SQL： 根據用戶輸入條件或者外部條件動態組合的SQK語句塊</li>
<li><code>if</code>語句舉例 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">   select * from user</span><br><span class="line">   <span class="comment">&lt;!-- 使用where保證進入判斷，如果内部的test全部不成立，則相當於沒有where --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 如果test成立那麽執行内部語句，否則跳過内部語句  --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != null&quot;</span>&gt;</span></span><br><span class="line">            id = #&#123;id&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">            and username = #&#123;username&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span></span><br><span class="line">            and password = #&#123;password&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">   ;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><code>foreach</code>語句舉例 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">where</span> id <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from user</span><br><span class="line">   <span class="tag">&lt;<span class="name">where</span>&gt;</span> </span><br><span class="line">      <span class="comment">&lt;!-- 如果傳入的是數組寫collection=&quot;array&quot;, 如果傳入的是列表寫collection=&quot;list&quot; --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- item名字隨便寫，和foreach内部一致即可 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">open</span>=<span class="string">&quot;id in (&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">         #&#123;id&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>SQL片段抽取
<ul>
<li>對於多個SQL語句中重複的部分，可以抽取出來，其他語句引用這部分即可，利於簡潔化和解耦</li>
<li>使用<code>&lt;sql id="公共SQL的唯一id"&gt;SQL語句&lt;/sql&gt;</code>抽取公共SQL語句</li>
<li>使用<code>&lt;include refid="公共SQL的唯一id"&gt;&lt;/include&gt;</code>引用gonggongSQL語句</li>
</ul></li>
<li>MyBatis自定義類型轉換器
<ul>
<li>MyBatis自帶了數據庫類型和Java類型的轉換，這些轉換是自動完成了，不需要手動配置</li>
<li>自定義轉換器流程
<ol type="1">
<li>自定義轉換器類實現<code>TypeHandler</code>接口，或者繼承<code>BaseTypeHandler</code>類</li>
<li>重寫類中方法 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 目標是實現Java的Date和SQL的Bigint之間轉換</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateTypeHandler</span> <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Java類型轉換成數據庫類型</span></span><br><span class="line">   <span class="comment">// preparedStatement是要執行的語句，i是要轉換的字段的索引</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement preparedStatement, <span class="keyword">int</span> i, Date date, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">      <span class="keyword">long</span> time = date.getTime();</span><br><span class="line">      preparedStatement.setLong(i, time);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 數據庫類型轉換成Java類型</span></span><br><span class="line">   <span class="comment">// resultSet是查詢的結果集，s是要轉換的字段名稱</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Date <span class="title">getNullableResult</span><span class="params">(ResultSet resultSet, String s)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">      <span class="keyword">long</span> time = resultSet.getLong(s);</span><br><span class="line">      Date date = <span class="keyword">new</span> Date(time);</span><br><span class="line">      <span class="keyword">return</span> date;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 數據庫類型轉換成Java類型</span></span><br><span class="line">   <span class="comment">// resultSet是查詢的結果集，s是要轉換的字段的索引</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Date <span class="title">getNullableResult</span><span class="params">(ResultSet resultSet, <span class="keyword">int</span> i)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">      <span class="keyword">long</span> time = resultSet.getLong(i);</span><br><span class="line">      Date date = <span class="keyword">new</span> Date(time);</span><br><span class="line">      <span class="keyword">return</span> date;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">// 數據庫類型轉換成Java類型</span></span><br><span class="line">   <span class="comment">// callableStatement用來調用存儲過程，i是要轉換的字段的索引</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Date <span class="title">getNullableResult</span><span class="params">(CallableStatement callableStatement, <span class="keyword">int</span> i)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">      <span class="keyword">long</span> time = callableStatement.getLong(i);</span><br><span class="line">      Date date = <span class="keyword">new</span> Date(time);</span><br><span class="line">      <span class="keyword">return</span> date;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>在MyBatis核心配置文件中注冊這個自定義的轉換器：在<code>typeHandlers</code>標簽中寫<code>typeHandler</code>標簽
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 這個標簽寫在typeAlias之後，environments之前 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;com.yanxuanshaozhu.handler.DateTypeHandler&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">typeHandler</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol></li>
</ul></li>
<li>MyBatis多表操作(多表查詢)
<ul>
<li>單表查詢的時候，MyBatis自動完成了列名和JavaBean屬性的映射，多表查詢需要手動設置映射</li>
<li>一对一模型:
在多表關聯的時候，設置好結果表列名到各個表的屬性的映射，然後把查詢操作的<code>resultMap</code>屬性設置成這個映射即可
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- purchaseMapper.xml文件中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.yanxuanshaozhu.mapper.PurchaseMapper&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 这里的type是别名--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userPurchase&quot;</span> <span class="attr">type</span>=<span class="string">&quot;purchase&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--  内部写手动指定字段和实体的映射关系, column是结果表的列名，property是实体类的属性--&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--  id代表結果表的主键， 其他是列使用result--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;pid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;user.id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;user.username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;user.password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;user.birthday&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;time&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;total&quot;</span> <span class="attr">property</span>=<span class="string">&quot;total&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserPurchase&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userPurchase&quot;</span>&gt;</span></span><br><span class="line">      select u.id as uid,</span><br><span class="line">               username,</span><br><span class="line">               password,</span><br><span class="line">               birthday,</span><br><span class="line">               p.id as pid,</span><br><span class="line">            time, total</span><br><span class="line">      from user as u,</span><br><span class="line">            purchase as p</span><br><span class="line">      where u.id = p.uid;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// purchaseMapper.java文件中</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PurchaseMapper</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 返回Purchase類型，因爲xml文件中resultMap的type設置成了Purchase類型</span></span><br><span class="line">   <span class="function">List&lt;Purchase&gt; <span class="title">findUserPurchase</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">&lt;!-- 另一種配置映射的方法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.yanxuanshaozhu.mapper.PurchaseMapper&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--    这里的type是别名--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userPurchase&quot;</span> <span class="attr">type</span>=<span class="string">&quot;purchase&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--  内部写手动指定字段和实体的映射关系, column是结果表的列名，property是实体类的属性--&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--  id代表主键， 其他是result--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;pid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;time&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;total&quot;</span> <span class="attr">property</span>=<span class="string">&quot;total&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--  這裏的property書purchase實體類中的屬性名, javaType是User實體類的別名     --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;user&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserPurchase&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userPurchase&quot;</span>&gt;</span></span><br><span class="line">      select u.id as uid,</span><br><span class="line">               username,</span><br><span class="line">               password,</span><br><span class="line">               birthday,</span><br><span class="line">               p.id as pid,</span><br><span class="line">            time, total</span><br><span class="line">      from user as u,</span><br><span class="line">            purchase as p</span><br><span class="line">      where u.id = p.uid;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>一對多模型：如果一個TypeA對應多個TypeB，那麽需要在TypeA的JavaBean中設置一個<code>List&lt;TypeB&gt;</code>的屬性，然後仍在自定義映射的<code>resultMap</code>中設置<code>collection</code>來配置TypeB的JavaBean和數據庫表的映射
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用了別名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userPurchase&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 用來配置purchase的映射， property是user的JavaBean中屬性名, ofType是Purchase全限定類名的別名 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;purchases&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;purchase&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;pid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;time&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;total&quot;</span> <span class="attr">property</span>=<span class="string">&quot;total&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserPurchases&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userPurchase&quot;</span>&gt;</span></span><br><span class="line">   select u.id as uid, username, password, birthday, p.id as pid, time, total</span><br><span class="line">   from user as u, purchase as p</span><br><span class="line">   where u.id = p.uid;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">   <span class="function">List&lt;User&gt; <span class="title">getUserPurchases</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>多對多模型：和一對多相比多一個中間表 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userRoles&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;roles&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;role&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;rid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;rid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;rname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;rname&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;rdesp&quot;</span> <span class="attr">property</span>=<span class="string">&quot;rdesp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserRoles&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userRoles&quot;</span>&gt;</span></span><br><span class="line">   select u.id as uid, username, password, birthday, r.rid as rid, rname, rdesp</span><br><span class="line">   from user as u,</span><br><span class="line">         userrole as ur,</span><br><span class="line">         role as r</span><br><span class="line">   where u.id = ur.uid</span><br><span class="line">      and ur.rid = r.rid;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">   <span class="function">List&lt;User&gt; <span class="title">getUserRoles</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>MyBatis注解開發
<ul>
<li>MyBatis注解開發主要是用來代替Mapper映射文件的編寫</li>
<li>一些注解: <code>@Insert</code>新增, <code>@Update</code>更新,
<code>@Delete</code>刪除, <code>@Select</code>查詢,
<code>@Results</code>封裝多個結果集代替<code>resultMap</code>標簽),
<code>@Result</code>,封裝結果集(代替<code>id</code>和<code>result</code>標簽)
<code>@One</code>一對一模型結果集封裝(代替<code>association</code>標簽),
<code>@Many</code>一對多結果集封裝(代替<code>collection</code>標簽)</li>
<li>基本增刪改查 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在xxxMapper.java中加入對應方法的注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Select(&quot;select * from user;&quot;)</span></span><br><span class="line">   <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Select(&quot;select * from user where id = #&#123;id&#125;;&quot;)</span></span><br><span class="line">   <span class="function">User <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Insert(&quot;insert into user (username, password) values (#&#123;username&#125;, #&#123;password&#125;);&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Update(&quot;update user\n&quot; +</span></span><br><span class="line"><span class="meta">            &quot;set username = #&#123;username&#125;, password = #&#123;password&#125; where id = #&#123;id&#125;;&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">updateById</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Delete(&quot;delete from user where id = #&#123;id&#125;;&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在核心配置類裏面加載映射關係，然後刪除xxxMapper.xml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span> &gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 設置核心配置文件掃描的包路徑來找到XXXMapper.java文件  --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.yanxuanshaozhu.mapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>多表查詢 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PurchaseMapper</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Select(&quot;select u.id as uid, username, password, birthday, p.id as pid, time ,total from user as u, purchase as p where p.uid = u.id;&quot;)</span></span><br><span class="line">   <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">            // 這裏的user就是上面sql語句中的user</span></span><br><span class="line"><span class="meta">            @Result( column = &quot;uid&quot;, property = &quot;user.id&quot;),</span></span><br><span class="line"><span class="meta">            @Result( column = &quot;username&quot;, property = &quot;user.username&quot;),</span></span><br><span class="line"><span class="meta">            @Result( column = &quot;password&quot;, property = &quot;user.password&quot;),</span></span><br><span class="line"><span class="meta">            @Result( column = &quot;birthday&quot;, property = &quot;user.birthday&quot;),</span></span><br><span class="line"><span class="meta">            // 使用id = true代表這個是結果表的主鍵</span></span><br><span class="line"><span class="meta">            @Result( id = true, column = &quot;pid&quot;, property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">            @Result( column = &quot;time&quot;, property = &quot;time&quot;),</span></span><br><span class="line"><span class="meta">            @Result( column = &quot;total&quot;, property = &quot;total&quot;)</span></span><br><span class="line"><span class="meta">   &#125;)</span></span><br><span class="line">   <span class="function">List&lt;Purchase&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用類似association標簽的寫法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PurchaseMapper</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Select(&quot;select u.id as uid, username, password, birthday, p.id as pid, time, total from purchase as p join user as u on p.uid = u.id;&quot;)</span></span><br><span class="line">   <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">            // 使用id = true代表這個是結果表的主鍵</span></span><br><span class="line"><span class="meta">            @Result(id = true, column = &quot;pid&quot;, property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;time&quot;, property = &quot;time&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;total&quot;, property = &quot;total&quot;),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                  property = &quot;user&quot;, // Purchase中的User屬性的名稱</span></span><br><span class="line"><span class="meta">                  column = &quot;uid&quot;,   // 按照哪列名進行查詢</span></span><br><span class="line"><span class="meta">                  one = @One(select = &quot;com.yanxuanshaozhu.mapper.UserMapper.findById&quot;), // 調用接口中的類來查詢</span></span><br><span class="line"><span class="meta">                  javaType = User.class // 返回結果的類型</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">            )</span></span><br><span class="line"><span class="meta">   &#125;)</span></span><br><span class="line">   <span class="function">List&lt;Purchase&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ol>
<h2 id="mybatisplus">MyBatisPlus</h2>
<ol type="1">
<li>介紹
<ul>
<li>MyBatis-Plus(MP)是一個MyBatis增强工具，簡化開發，提高效率</li>
<li>特點
<ul>
<li>只做增强，不做改變：不影響使用MyBatis的項目</li>
<li>效率高：只需要簡單配置，就可以快速地進行CRUD操作</li>
<li>豐富功能：代碼生成，分頁，性能分析功能都包含在内</li>
</ul></li>
<li>Maven <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.baomidou/mybatis-plus --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>配置MP的方法
<ul>
<li>Mybatis配置MP
<ul>
<li>在<code>pom.xml</code>中加入MP的依賴</li>
<li>在<code>dom.XXX</code>類中加入映射的數據庫表的注解<code>@TableName("數據庫的表名")</code></li>
<li>讓<code>XXXMapper</code>繼承<code>BaseMapper&lt;XXX&gt;</code>，
這樣就可以使用MP中的自帶方法了</li>
<li>修改<code>new SqlSessionFactoryBuilder()</code>為<code>new SqlSessionFactoryBuilder()</code></li>
<li>使用MP中的方法進行搜索，比如<code>mapper.selectList(null)</code>等價於自定義的<code>mapper.findAll()</code></li>
</ul></li>
<li>Spring配置MP
<ul>
<li>把Mybatis配置類注入<code>SqlSessionFactory</code>的方法改成注入<code>MybatisSqlSessionFactoryBean</code>的方法
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">MyBatisSqlSessionFactoryBean</span><span class="params">(<span class="meta">@Autowired</span> DataSource ds)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">   MybatisSqlSessionFactoryBean bean = <span class="keyword">new</span> MybatisSqlSessionFactoryBean();</span><br><span class="line">   bean.setDataSource(ds);</span><br><span class="line">   bean.setTypeAliasesPackage(<span class="string">&quot;com.yanxuanshaozhu.domain.Account&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> bean.getObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li>來自BaseMapper的通用CRUD操作
<ul>
<li>[EMPTY] <!-- This section was empty in the HTML provided --></li>
</ul></li>
</ol>
<h1 id="ssm框架整合">SSM框架整合</h1>
<ol type="1">
<li>基本整合
<ul>
<li>注意一个问题：在jsp文件中使用<code>$&#123;pageContext.request.contextPath&#125;</code>拿到项目虚拟目录的时候，要注意有这个<code>&lt;%@ page isELIgnored="false"%&gt;</code>，比如idea自动生成的jsp就没有，会导致EL表达式不解析，然后路径报错</li>
<li>注意另一個問題：如果你的JUnit
test報錯的話，刪掉<code>@EnableWebMvc</code>，然後再執行就可以了......</li>
<li>Spring整合MyBatis：把MyBatis核心配置文件刪除，使用純注解的方式讓Spring自動注入相關配置
<ul>
<li>建立<code>JdbcConfig.java</code>配置類，配置<code>DataSource</code>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 從properties配置文件讀取内容</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:/com/yanxuanshaozhu/properties/db.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfig</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 把properties文件的内容注入到變量中</span></span><br><span class="line">   <span class="meta">@Value(&quot;$&#123;driver&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String driver;</span><br><span class="line">   <span class="meta">@Value(&quot;$&#123;url&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String url;</span><br><span class="line">   <span class="meta">@Value(&quot;$&#123;user&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String user;</span><br><span class="line">   <span class="meta">@Value(&quot;$&#123;password&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 配置DruidDataSource</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> DataSource <span class="title">getDataSource</span><span class="params">()</span> <span class="keyword">throws</span> PropertyVetoException, SQLException </span>&#123;</span><br><span class="line">      DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">      dataSource.setDriverClassName(driver);</span><br><span class="line">      dataSource.setUrl(url);</span><br><span class="line">      dataSource.setUsername(user);</span><br><span class="line">      dataSource.setPassword(password);</span><br><span class="line">      <span class="keyword">return</span> dataSource;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>建立<code>MyBatisConfig.java</code>類，配置<code>SqlSessionFactory</code>和<code>MapperScannerConfigurer</code>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 配置SqlSessionFactory，從而可以讓Spring注入XXXMapper</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">sqlSessionFactory</span><span class="params">(<span class="meta">@Autowired</span> DataSource ds)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      SqlSessionFactoryBean sqlSessionFactoryBean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">      sqlSessionFactoryBean.setDataSource(ds);</span><br><span class="line">      <span class="comment">// 設置之後可以不用全限定類名，而是直接使用類名</span></span><br><span class="line">      sqlSessionFactoryBean.setTypeAliasesPackage(<span class="string">&quot;com.yanxuanshaozhu.domain.Account&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> sqlSessionFactoryBean.getObject();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 配置MapperScannerConfigurer，指定掃描XXXMapper.java所在的包得到Mapper</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> MapperScannerConfigurer <span class="title">getMapperScannerConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      MapperScannerConfigurer configurer = <span class="keyword">new</span> MapperScannerConfigurer();</span><br><span class="line">      configurer.setBasePackage(<span class="string">&quot;com.yanxuanshaozhu.mapper&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> configurer;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>SpringConfiguration.java</code>中導入上述兩個類</li>
</ul></li>
</ul></li>
</ol>
<h1 id="springboot">SpringBoot</h1>
<h2 id="springboot基礎">SpringBoot基礎</h2>
<!-- Content for this section was not present in the HTML -->
<h1 id="尚硅谷spring6">尚硅谷Spring6</h1>
<ol type="1">
<li>How an object is created in Spring using XML configuration
<ul>
<li>Load the <code>bean.xml</code> file</li>
<li>Analyze the xml file</li>
<li>Get the id and class attribute from the <code>bean</code> tag</li>
<li>Use reflection to create the instance <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = class.forName(<span class="string">&quot;fullClassName&quot;</span>);</span><br><span class="line">User user = (User)clazz.getDeclaredConstructor().newInstance();</span><br></pre></td></tr></table></figure></li>
<li>The created objects are stored inside the
<code>Map&lt;String, BeanDefinition&gt;</code>中</li>
<li>Use <code>context.getBean(idName)</code> to get the objects</li>
</ul></li>
<li>Log4j2 log framework
<ul>
<li>Include dependencies in <code>pom.xml</code>，create
<code>log4j2.xml</code> to control log format</li>
</ul></li>
<li>IOC
<ul>
<li>IOC container: contains map of beans</li>
<li>Use <code>BeanDefinitionReader</code> to get
<code>BeanDefinition</code></li>
<li>Use <code>BeanFactory</code>(spring internal interface, developer
should use the <code>ApplicationContext</code> interface and its
implementing classes instead) and Reflection to instantiate beans</li>
<li>Bean is then initialized</li>
<li>Use <code>context.getBean(idName)</code> to get bean</li>
</ul></li>
<li>DI(Dependency injection)
<ul>
<li>When creating beans, inject their dependencies using
configurations</li>
<li>How to
<ul>
<li>Use set method</li>
<li>Use constructor</li>
</ul></li>
</ul></li>
<li>IOC: XML-based configuration
<ul>
<li>Get bean object <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// by id</span></span><br><span class="line">User u1 = (User)context.getBean(<span class="string">&quot;beanId&quot;</span>);</span><br><span class="line"><span class="comment">// by type: cannot have multiple beans with the same class, if user is an interface </span></span><br><span class="line"><span class="comment">// and it has one implementing class, polymorphism works here </span></span><br><span class="line">User u2 = context.getBean(User.class);</span><br><span class="line"><span class="comment">// by id and type</span></span><br><span class="line">User u3 = context.getBean(<span class="string">&quot;beanId&quot;</span>, User.class);</span><br></pre></td></tr></table></figure></li>
<li>DI via setter/constructor <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- via setter, this requires the constructor with no arguments --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book-setter&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.book.Book&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;name1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">value</span>=<span class="string">&quot;author1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Use &lt;null&gt;&lt;/null&gt; or &lt;null/&gt; for null values --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- via constructor, this requires the constructor with the corresponding arguments --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book-constructor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.book.Book&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;name2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">value</span>=<span class="string">&quot;author2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>DI with object <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- via referencing collaborator bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dept1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.dept.Department&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;department1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;e1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.dept.Employee&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- the value of ref is the id of a collaborator bean --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dept1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- via using inner bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;e2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.dept.Employee&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dept2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.dept.Department&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;department2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>   </span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- via compound property names --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;e3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.dept.Employee&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dept1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- name is a field of in the Department class --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept.name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;department3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>DI with array/collection <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- DI for array --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;e4&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.dept.Employee&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hobbies&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>H1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>H2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>H3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- DI for object list --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dept5&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.dept.Department&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;employees&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- the value of bean is the id of a collaborator bean --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;e1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;e2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- DI for map --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;stu1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.school.Student&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;teachers&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- if the entry value is a built-in object, use value=&quot;xxx&quot; --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value-ref</span>=<span class="string">&quot;t1&quot;</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span> <span class="attr">value-ref</span>=<span class="string">&quot;t2&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>DI using other methods
<ul>
<li>Use <code>util</code> for collections(<code>util:list</code>,
<code>util:map</code>, etc.), this requires modification of the XML
namespace</li>
<li>Use <code>p:attribute = "value"</code>,
<code>p:attribute-ref="beanId"</code> for DI, this requires modification
ox the XML namespace</li>
</ul></li>
<li>Import external properties file(database configuration, data source)
<ul>
<li>Include the <code>context</code> namespace <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Use <code>context</code> tag to import the properties file
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Configure C3p0 dataSource in the XML file <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- value is the key in the jdbc.properties file --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.user&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Scope of bean
<ul>
<li>Singleton: bean is created when the IOC container is
initialized</li>
<li>Prototype: bean is created when it is required</li>
<li>Usage:
<code>&lt;bean scope="singleton/prototype"&gt;&lt;/bean&gt;</code></li>
</ul></li>
<li>FactoryBean
<ul>
<li>Can be used to encapsulate object construction logic in class, often
are used to incorporate with other frameworks <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> User <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">      <span class="keyword">return</span> User.class;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Autowire configuration
<ul>
<li>For the controller, service, dao framework, let spring to initialize
fields automatically</li>
<li><code>autowire="byName/byType/constructor/no"</code>(if byName is
used, the bean id must be the same as the filed name), it works fine if
a bean is matched, if no bean is matched, the corresponding field will
be null, if multiple bean are matched, an error will be raised</li>
<li>Example <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserControllerImpl</span> <span class="keyword">implements</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">   <span class="comment">// The getter and setter should be generated</span></span><br><span class="line">   <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> UserService <span class="title">getUserService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> userService;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserService</span><span class="params">(UserService userService)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.userService = userService;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      userService.run();</span><br><span class="line">      System.out.println(<span class="string">&quot;UserControllerImpl is called&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Include the autowire=&quot;byType&quot; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userController&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.csdarchitecture.controller.UserControllerImpl&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.csdarchitecture.service.UserServiceImpl&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDAO&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.csdarchitecture.dao.UserDAOImpl&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li>IOC: Annotation-based configuration
<ul>
<li>Steps:
<ol type="1">
<li>Import dependencies: include the <code>context</code> namespace</li>
<li>Enable component scanning: Spring will scan the base package and its
children packages, whenever a class is annoated with
<code>@Component</code>, it will be included in the IOC container
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.yanxuanshaozhu&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- The following filters are excluded from the IOC container  --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Exclude by qualified class name --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;assignable&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;com.yanxuanshaozhu.annotation.User&quot;</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Exclude by annotation type --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Only scan the following filters  --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Include by qualified class name --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;assignable&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;com.yanxuanshaozhu.annotation.User&quot;</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Include by annotation type --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Use annotation to define beans:
<code>@Component(value="")</code>(value is the same as the bean id in
the XML configuration), <code>@Repository</code>, <code>@Service</code>,
<code>@Controller</code></li>
<li>DI: <code>@Autowired</code>, <code>@Qualified</code>,
<code>@Resource</code></li>
</ol></li>
<li>You can use both pure annotation configuration development or
combine annotation and XML file together in development</li>
<li><code>@Autowired</code>
<ul>
<li>By default, autowire uses match byType</li>
<li>Can be used on the constructor, setter method, method parameter,
field, annotation</li>
<li>Use Autowired for field
<ul>
<li>Directly annotate the field, no getter or setter is needed for the
field, this approach is not
recommended(<code>Field injection is not recommended</code>, because the
list of required dependencies are unclear during instance creation.
)</li>
<li>Create a setter method for the field and annotate the setter
method</li>
<li>Create a constructor with the field as the parameter and annotate
the constructor</li>
<li>Create a constructor with the field as the parameter and annotate
the parameter</li>
<li>If you only have a constructor with parameters, Autowired can be
omitted</li>
<li>You can use Autowired and Qualified together to enable match byName:
<code>@Qualified(value="fieldName")</code></li>
</ul></li>
</ul></li>
<li><code>@Resource</code>
<ul>
<li>By default, autowire uses match
byBame(<code>@Resource(name="xxx")</code> the name attribute should
match the value attribute of another bean, for example
<code>@Service("xxx")</code>), if name is not assigned, match by
fieldName(the field name xxx annotated with <code>@Resource</code>
should match the value attribute of another bean, for example
<code>@Service("xxx")</code>), then byType</li>
<li>Can be used on the field and setter method</li>
<li>For JDK higher than 11, you should include the following
dependencies, <b>DO NOT</b> use the Javax Annotation API, <b>USE</b> the
Jakarta Annotations API <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.annotation/javax.annotation-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.annotation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.annotation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Pure annotation development without the XML configuration file
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// The ComponentScan is a supplement of the XML context:component-scan tag</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.yanxuanshaozhu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>AOP
<ul>
<li>Delegation: delegate and the original object. Spring AOP is based on
dynamic delegation
<ul>
<li>An example of dynamic delegation <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// The target object to be delegated</span></span><br><span class="line">   <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ProxyFactory</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.target = target;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">getProxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      ClassLoader classLoader = target.getClass().getClassLoader();</span><br><span class="line">      <span class="comment">// Interfaces implemented by the target class</span></span><br><span class="line">      Class&lt;?&gt;[] interfaces = target.getClass().getInterfaces();</span><br><span class="line">      <span class="comment">// The handler deals with how proxy mimics the target object</span></span><br><span class="line">      InvocationHandler handler = <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Method from the target object with args to be implemented by the proxy</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">               Object result = method.invoke(target, args);</span><br><span class="line">               <span class="comment">//  Put other common features here</span></span><br><span class="line">               <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> Proxy.newProxyInstance(classLoader, interfaces, handler);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Dynamic dynamic proxy category
<ul>
<li>JDK dynamic proxy: can only proxy by interface(proxy and target
implements the same interfaces)</li>
<li>cglib dynamic proxy: can create a proxy by subclassing(proxy becomes
the subclass of the target class)</li>
</ul></li>
<li>AspectJ: AspectJ itself is a static proxy framework, the Spring
framework depends on the annotations AspectJ to achieve its dynamic
proxy and AOP</li>
</ul></li>
<li>AOP is a programming paradigm that aims to increase modularity by
allowing the separation of cross-cutting concerns. It does this by
adding additional behavior to existing code without modifying the code
itself</li>
<li>AOP concepts
<ul>
<li>Joinpoint: a point during the execution of a program, in Spring,
joinpoint is always the execution of a program</li>
<li>Pointcut: a predicate that matches join points, advices is
associated with a pointcut and runs at any join point matched by the
pointcut</li>
<li>Advice: action taken by an aspect at a particular join point,
different types of advice include <code>@Before</code>,
<code>@AfterReturning</code>, <code>@AfterThrowing</code>,
<code>@After</code>, <code>@Around</code></li>
<li>Aspect: describe how advice is associated with pointcut, it's the
central of AOP</li>
</ul></li>
<li>Annotation-based AOP
<ul>
<li>Steps
<ol type="1">
<li>Include the additional dependencies: <code>spring-aop</code>,
<code>spring-aspects</code></li>
<li>Create target resources: target interface, target class</li>
<li>Create aspect class that contains the pointcut and advice. This
class should be annotated by the <code>@Aspect</code>,
<code>@Component</code> annotations
<ul>
<li>Advice annotation syntax:
<code>@XXX(value="pointcut expression")</code></li>
<li>Point expression syntax:
<code>@Before(value="execution(modifier returnType qualifiedClassName.methodName(argTypes))")</code>,
example
<code>@Before(value="execution(com.yanxuanshaozhu.calculator.CalculatorImpl.add(int, int))")</code>,
use <code>*</code> to match arbitrary type/name, use <code>..</code> to
match arbitrary amount of arguments <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(value = &quot;execution(public * com.yanxuanshaozhu.annotationaop.CalculatorImpl.*(..))&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeMethod</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// Get the joinpoint method name</span></span><br><span class="line">   String methodName = joinPoint.getSignature().getName();</span><br><span class="line">   <span class="comment">// Get the jointpoint method arguments</span></span><br><span class="line">   Object[] args = joinPoint.getArgs();</span><br><span class="line">   System.out.println(<span class="string">&quot;Before executed on: &quot;</span> + methodName + <span class="string">&quot; method with arguments: &quot;</span> + Arrays.toString(args));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@After(value = &quot;execution(public * com.yanxuanshaozhu.annotationaop.CalculatorImpl.*(..))&quot;)</span></span><br><span class="line"><span class="comment">// AfterReturning is executed before the After method, and it can captures the returned value of the joinpoint method</span></span><br><span class="line"><span class="meta">@AfterReturning(value = &quot;execution(public * *.*(..))&quot;, returning = &quot;result&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturningMethod</span><span class="params">(JoinPoint joinPoint, Object result)</span> </span>&#123;</span><br><span class="line">   String methodName = joinPoint.getSignature().getName();</span><br><span class="line">   Object[] args = joinPoint.getArgs();</span><br><span class="line">   System.out.println(<span class="string">&quot;AfterReturning executed on: &quot;</span> + methodName + <span class="string">&quot; method with arguments: &quot;</span> + Arrays.toString(args) + <span class="string">&quot; and result: &quot;</span> + result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AfterThrowing(value = &quot;execution(public * *.*(..))&quot;, throwing = &quot;ex&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowingMethod</span><span class="params">(JoinPoint joinPoint, Throwable ex)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// Do something here</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Around(value = &quot;execution(public * *.*(..))&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aroundMethod</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> </span>&#123;</span><br><span class="line">   Object result = <span class="keyword">null</span>;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;Before&quot;</span>);</span><br><span class="line">         result = proceedingJoinPoint.proceed();</span><br><span class="line">         System.out.println(<span class="string">&quot;AfterReturning&quot;</span>);</span><br><span class="line">   &#125; <span class="keyword">catch</span> (Throwable a) &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;AfterThrowing&quot;</span>);</span><br><span class="line">   &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;After&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Reuse pointcut expression to reduce redundancy <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(value=&quot;execution(public * *.*(..))&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointCut</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Calling the pointCut method is equivalent to calling execution(public * *.*(..))</span></span><br><span class="line"><span class="comment">// If the pointcut method is defined in another package, use @Before(value=&quot;pkgName.className.methodName()&quot;)</span></span><br><span class="line"><span class="meta">@Before(value=&quot;pointCut()&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeMethod</span><span class="params">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>If you use XML, include <code>aop</code>, <code>context</code>,
enable component scan, enable aspectj autoproxy <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    Enable component scan--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.yanxuanshaozhu.annotationaop&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    Enable autoproxy in AspectJ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol></li>
</ul></li>
<li>XML-based AOP <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Enable component scan--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.yanxuanshaozhu.annotationaop&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Enable autoproxy--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Configure AOP settings --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Configure Aspect Class--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;logAspect&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pointcut&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">expression</span>=<span class="string">&quot;execution(public * com.yanxuanshaozhu.annotationaop.CalculatorImpl.*(..))&quot;</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;beforeMethod&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointcut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;afterMethod&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointcut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterReturningMethod&quot;</span> <span class="attr">returning</span>=<span class="string">&quot;result&quot;</span></span></span><br><span class="line"><span class="tag">                              <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointcut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;afterThrowingMethod&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointcut&quot;</span> <span class="attr">throwing</span>=<span class="string">&quot;ex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;aroundMethod&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointcut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:around</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Incorporate Junit with Spring
<ul>
<li>You do not need to create the ApplicationContext manually yourself,
Spring can do it all for you</li>
<li>Include the following dependencies: <code>junit-jupiter-api</code>
for JUnit5, <code>junit</code> for JUnit4, <code>spring-test</code></li>
<li>An example for JUnit5 with XML <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringJUnitConfig(locations = &quot;classpath:bean.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringTest</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(user);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>An example for JUnit 5 with configuration class <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(SpringExtension.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringTest</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(user);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>An example for JUnit4 with XML <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@SpringJUnitConfig(locations = &quot;classpath:bean.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringTest</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(user);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>An example for JUnit5 with configuration class <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringTest</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(user);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Spring Transaction
<ul>
<li>JdbcTemplate
<ul>
<li>Spring encapsulates JDBC, uses JdbcTemplate to do CRUD on the
database</li>
<li>Steps for using JdbcTempalte
<ol type="1">
<li>Include dependencies: <code>spring-jdbc</code>,
<code>mysql-connector-java</code>, <code>c3p0/druid</code></li>
<li>Configure the XML settings <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Import the properties file  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Create a dataSource   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.user&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Create a jdbcTemplate  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Basic CRUD
<ul>
<li>For insert, update, delete, simply use the <code>update</code>
method</li>
<li>For query, use <code>queryForObject</code>,
<code>queryForList</code> etc., which need a subclass instance of the
interface <code>RowMapper</code>, you can use arrow method or you can
use built-int classes <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Insert</span></span><br><span class="line">String insertSql = <span class="string">&quot;insert into student(name, id)values(?, ?);&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> rows = jdbcTemplate.update(insertSql, <span class="string">&quot;student4&quot;</span>, <span class="number">4</span>);</span><br><span class="line"><span class="comment">// Update</span></span><br><span class="line">String updateSql = <span class="string">&quot;update student set name = ? where id = ?;&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> rows = jdbcTemplate.update(updateSql, <span class="string">&quot;st4&quot;</span>, <span class="number">4</span>);</span><br><span class="line"><span class="comment">// Delete</span></span><br><span class="line">String updateSql = <span class="string">&quot;delete from student where id = ?;&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> rows = jdbcTemplate.update(updateSql, <span class="number">4</span>);</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Query for an object with user-defined mapper</span></span><br><span class="line">String querySql = <span class="string">&quot;select * from student where id = ?;&quot;</span>;</span><br><span class="line">Student student = jdbcTemplate.queryForObject(querySql, (rs, rowNum) -&gt; &#123;</span><br><span class="line">      Student tmp = <span class="keyword">new</span> Student();</span><br><span class="line">      tmp.setId(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">      tmp.setName(rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">      <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Query for an object with built-in Mapper, the column names </span></span><br><span class="line"><span class="comment">// in the database should be the same as the object field names</span></span><br><span class="line">String querySql = <span class="string">&quot;select * from student where id = ?;&quot;</span>;</span><br><span class="line">Student student = jdbcTemplate.queryForObject(querySql, <span class="keyword">new</span> BeanPropertyRowMapper&lt;&gt;(Student.class), <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Query for a list of objects</span></span><br><span class="line">String querySql = <span class="string">&quot;select * from student where id &gt;= ?;&quot;</span>;</span><br><span class="line">List&lt;Student&gt; results = jdbcTemplate.query(querySql, <span class="keyword">new</span> BeanPropertyRowMapper&lt;&gt;(Student.class), <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Query for a single value</span></span><br><span class="line">String querySql = <span class="string">&quot;select count(*) from student;&quot;</span>;</span><br><span class="line">Integer res = jdbcTemplate.queryForObject(querySql, Integer.class);</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ol></li>
</ul></li>
<li>Transaction
<ul>
<li>Transaction categories
<ul>
<li>Programmatic transaction: developer manually control
transactions</li>
<li>Declarative transaction: use configuration to let the Spring
framework automaticall control the transactions</li>
</ul></li>
<li>Controller, Service, DAO revisited
<ul>
<li>Controller layer passes the business logic to a specific serviec
layer <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buyBook</span><span class="params">(<span class="keyword">int</span> bookId, <span class="keyword">int</span> userId)</span> </span>&#123;</span><br><span class="line">   bookService.buyBook(bookId, userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Service layer decomposes the business logic into interactions with
the database <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buyBook</span><span class="params">(<span class="keyword">int</span> bookId, <span class="keyword">int</span> userId)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// search book price</span></span><br><span class="line">   <span class="keyword">int</span> price = bookDAO.getBookPriceById(bookId);</span><br><span class="line">   <span class="comment">// book store - 1</span></span><br><span class="line">   bookDAO.updateBookStorageById(bookId);</span><br><span class="line">   <span class="comment">// user balance -= book price</span></span><br><span class="line">   bookDAO.updateUserBalanceByIdAndPrice(userId, price);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>DAO layer actually implements methods to interact with the database
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBookPriceById</span><span class="params">(<span class="keyword">int</span> bookId)</span> </span>&#123;</span><br><span class="line">   String querySql = <span class="string">&quot;select price from book where id = ?;&quot;</span>;</span><br><span class="line">   Integer price = jdbcTemplate.queryForObject(querySql, Integer.class, bookId);</span><br><span class="line">   <span class="keyword">return</span> price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Declarative transaction using XML and annotation: this requires the
<code>tx</code> namespace. Then you can use the
<code>@Transactional</code> annotation in the service layer
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/tx/spring-tx-3.0.xsd&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Enable component scan --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Configure dataSource --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Configure jdbcTemplate --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Add transaction manager   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Enable the annotation-based transaction  --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><code>@Transactional()</code>
<ul>
<li>This annotation can be placed on a class or a method, if it
annotates a class, all methods inside are required to have the ACID
property</li>
<li>This annotation can have arguments to indicate
<code>timeout</code>(-1 for no timeout, n for n seconds), whether
<code>readOnly</code>(if readOnly, then only query is allowed), rollback
policy(whether rollback for specific type of errors, for example
<code>noRollbackFor = ArithmeticException.class</code>), transaction
isolation levels (<code>isolation=xxx</code>), transaction propagation
type(<code>propagation=xxx</code>)</li>
</ul></li>
<li>Declarative transaction using pure annotation configuration
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.yanxuanshaozhu.declarativetransaction&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> DataSource <span class="title">getDataSource</span><span class="params">()</span> <span class="keyword">throws</span> PropertyVetoException </span>&#123;</span><br><span class="line">      ComboPooledDataSource dataSource = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">      dataSource.setDriverClass(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">      dataSource.setUser(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">      dataSource.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">      dataSource.setJdbcUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> dataSource;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">getJdbcTemplate</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">      JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate();</span><br><span class="line">      jdbcTemplate.setDataSource(dataSource);</span><br><span class="line">      <span class="keyword">return</span> jdbcTemplate;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> DataSourceTransactionManager <span class="title">getDataSourceTransactionManager</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">      DataSourceTransactionManager dataSourceTransactionManager = <span class="keyword">new</span> DataSourceTransactionManager();</span><br><span class="line">      dataSourceTransactionManager.setDataSource(dataSource);</span><br><span class="line">      <span class="keyword">return</span> dataSourceTransactionManager;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Declarative transaction using pure XML configuration
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/tx/spring-tx-3.0.xsd&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Enable component scan --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Configure dataSource --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Configure jdbcTemplate --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Add transaction manager   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Advice configuration --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tx:attribute</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- Advice for all get* methods --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;get*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- Advice for all update* methods --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;update*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tx:attribute</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Configure pointcut expression --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(public * *.*.*(..))&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li>Resources
<ul>
<li>The <code>Resource</code> interface in the spring framework is more
capable for accessing low-level resources than the
<code>java.net.URL</code> class</li>
<li>Implementing classes: <code>UrlResource</code>,
<code>ClassPathResource</code>, <code>FileSystemResource</code>,
etc.</li>
</ul></li>
<li>i18n internationalization
<ul>
<li>Use properties file to achieve internationalization:
<code>len(internationalization) = 20</code>, i + len(18) + n</li>
<li>Java internationalization
<ul>
<li><code>java.util.Locale</code> is used to locate the current user's
language settings, <code>java.util.ResourceBundle</code> is used to
search the corresponding properties file</li>
<li>The properties file naming practice:
<code>basename_language_country.properties</code> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Suppose we have msg_zh_CN.properties and msg_en_US.properties</span></span><br><span class="line">ResourceBundle bundle1 = ResourceBundle.getBundle(<span class="string">&quot;msg&quot;</span>, <span class="keyword">new</span> Locale(<span class="string">&quot;zh&quot;</span>, <span class="string">&quot;CN&quot;</span>));</span><br><span class="line">System.out.println(bundle1.getString(<span class="string">&quot;test&quot;</span>));</span><br><span class="line">ResourceBundle bundle2 = ResourceBundle.getBundle(<span class="string">&quot;msg&quot;</span>, <span class="keyword">new</span> Locale(<span class="string">&quot;en&quot;</span>, <span class="string">&quot;US&quot;</span>));</span><br><span class="line">System.out.println(bundle2.getString(<span class="string">&quot;test&quot;</span>));</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Spring internationalization using the <code>MessageSource</code>
interface <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;messageSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basenames&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>msg<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line"><span class="comment">// Use an array to match the placeholders in the properties &#123;0&#125;, &#123;1&#125;,...</span></span><br><span class="line">Object[] objs = <span class="keyword">new</span> Object[] &#123;<span class="string">&quot;hao&quot;</span>&#125;;</span><br><span class="line">String value1 = context.getMessage(<span class="string">&quot;test&quot;</span>, objs, Locale.CHINA);</span><br><span class="line">String value2 = context.getMessage(<span class="string">&quot;test&quot;</span>, objs, Locale.US);</span><br><span class="line">System.out.println(value1);</span><br><span class="line">System.out.println(value2);</span><br></pre></td></tr></table></figure> <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test</span>=<span class="string">nimen &#123;0&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Validation
<ul>
<li>Validation should not be tied to the web tier and should be easy to
localize, and it should be possible to plug in any available
validator</li>
<li>Validation approaches
<ul>
<li>Implement <code>org.springframework.validation.Validator</code>, and
call the implementing class in the code
<ol type="1">
<li>Include dependencies: <code>hibernate-validator</code>,
<code>jakarta.el</code></li>
<li>Implement the <code>Validator</code> interface, override
<code>supports</code> and <code>validate</code> method
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonValidator</span> <span class="keyword">implements</span> <span class="title">Validator</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> Person.class.equals(clazz);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span><span class="params">(Object target, Errors errors)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// name cannot be empty rejectIfEmpty(errors, field name, user-defined errorCode, user-defined error message )</span></span><br><span class="line">      ValidationUtils.rejectIfEmpty(errors, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;name.empty&quot;</span>, <span class="string">&quot;Name cannot be null&quot;</span>);</span><br><span class="line">      <span class="comment">// age &gt;= 0 and age &lt; 150</span></span><br><span class="line">      Person p = (Person) target;</span><br><span class="line">      <span class="keyword">if</span> (p.getAge() &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            errors.rejectValue(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;age.value.negative&quot;</span>, <span class="string">&quot;Age cannot be negative&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p.getAge() &gt;= <span class="number">150</span>) &#123;</span><br><span class="line">            errors.rejectValue(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;age.value.large&quot;</span>, <span class="string">&quot;Age cannot be larger than 150&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Test <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Person person = <span class="keyword">new</span> Person();</span><br><span class="line">DataBinder dataBinder = <span class="keyword">new</span> DataBinder(person);</span><br><span class="line">dataBinder.setValidator(<span class="keyword">new</span> PersonValidator());</span><br><span class="line">dataBinder.validate();</span><br><span class="line">BindingResult bindingResult = dataBinder.getBindingResult();</span><br><span class="line">System.out.println(bindingResult.getAllErrors());</span><br></pre></td></tr></table></figure></li>
</ol></li>
<li>Use annotation to do validation
<ol type="1">
<li>Create configure class and configure
<code>LocalValidatorFactoryBean</code> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(value = &quot;com.yanxuanshaozhu.annotationapproach&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> LocalValidatorFactoryBean <span class="title">getLocalValidatorFactoryBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> LocalValidatorFactoryBean();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Create bean class with getter and setter methods, use annotations to
set validation rules <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// other parts are omitted</span></span><br><span class="line"><span class="meta">@Min(0)</span></span><br><span class="line"><span class="meta">@Max(150)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"><span class="meta">@NotNull</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure></li>
<li>Create validators <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Validator1</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> Validator validator;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">validatorByUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">      Set&lt;ConstraintViolation&lt;User&gt;&gt; validate = validator.validate(user);</span><br><span class="line">      <span class="keyword">return</span> validate.isEmpty();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Validate <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(SpringConfig.class);</span><br><span class="line">Validator1 validator1 = context.getBean(Validator1.class);</span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line"><span class="keyword">boolean</span> result = validator1.validatorByUser(user);</span><br><span class="line">System.out.println(result);</span><br></pre></td></tr></table></figure></li>
</ol></li>
<li>Use validation based on methods
<ol type="1">
<li>Create configure class and configure
<code>MethodValidationPostProcessor</code> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MethodValidationPostProcessor <span class="title">getMethodValidationPostProcessor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> MethodValidationPostProcessor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Create bean class with getter and setter methods, use annotations to
set validation rules</li>
<li>Create Validators <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">MyService</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">testMethod</span><span class="params">(<span class="meta">@NotNull</span> <span class="meta">@Valid</span> User user)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> user.toString();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Validate <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MyService service = context.getBean(MyService.class);</span><br><span class="line">System.out.println(service.testMethod());</span><br></pre></td></tr></table></figure></li>
</ol></li>
</ul></li>
</ul></li>
<li>AOT
<ul>
<li>JIT(just in time): compile bytecode to machine code at runtime, can
have large thoughput, can be optimized at runtime, but is low in start
and occupies large memory</li>
<li>AOT(ahead of time): compile bytecode machine code before runtime,
start fast, occupies small proportion of memory, cannot be optimized at
runtime, cannot run on multiple platforms</li>
<li>Spring uses Graalvm to support AOP, Java HotSpot supports JIT</li>
<li>You can use Graalvm native image to use Java AOT</li>
</ul></li>
</ol>
<h1 id="尚硅谷springmvc">尚硅谷SpringMVC</h1>
<ol type="1">
<li>Introduction
<ul>
<li>MVC framework
<ul>
<li>Model: java bean(beans to store data(database models), beans to
handle business logic(Service, Dao)), used to handle data analysis</li>
<li>View: html/jsp pages, deal with user interaction and data
display</li>
<li>Controller, servlet, used to receive and respond to requests</li>
</ul></li>
<li>SpringMVC
<ul>
<li>A lightweight web framework based on Java MVC model, part of the
Spring framework</li>
<li>Used for the presentation layer(web and controller)</li>
<li>Based on Serverlet, uses <code>DispatcherServlet</code> to handle
requests</li>
</ul></li>
<li>Intro project
<ul>
<li>Add dependencies: <code>spring-webmvc</code>,
<code>jakarta.servlet-api</code>,
<code>thymeleaf-spring6</code>(according to the official documentation
of thymeleaf, thymeleaf-spring 3.1.1 supports spring 6 and servlet api
&gt;= 5.0)</li>
<li>If the packaging is <code>&lt;war&gt;</code> in your project, the
dependencies will be included in the <code>web/WEB-INF/lib</code>
folder, with those whose <code>&lt;scope&gt;</code> is provided
excluded</li>
<li>Properly construct the project so that the <code>web</code> folder
and the <code>web/WEB-INF/web.xml</code> is located at the right
place</li>
<li>Configure <code>web.xml</code>
<ul>
<li>Default configuration: in this way, the <code>xxx-servlet.xml</code>
should be created and placed inside <code>web/WEB-INF</code>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- The servlet name xxx should be the same as the file name: xxx-servlet.xml --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Same as the servlet-name --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Match /login or .html or .css, does not match .jsp, which is handled by other servlets --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Custome configuration: in this way, the <code>xxx-servlet.xml</code>
should be plaed inside the value of <code>param-value</code>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Configure name and location--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- Here you need to create resources/SpringMVC.xml --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:SpringMVC.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Servlet by default is initialized when it&#x27;s accessed for the first time, </span></span><br><span class="line"><span class="comment">   since the DispatcherServlet handles lots staff, it will be very slow. Use this </span></span><br><span class="line"><span class="comment">   setting to initialize the DispatcherServlet when server starts--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Configure view resolver(maps view names to actual views) thymeleaf
in the <code>SpringMVC.xml</code>, files under the <code>WEB-INF</code>
cannot be accessed directly by the browser, you need to use the
thymeleaf viewResolver <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- This resolver handles html files --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;viewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring6.view.ThymeleafViewResolver&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;characterEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateEngine&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring6.SpringTemplateEngine&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateResolver&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring6.templateresolver.SpringResourceTemplateResolver&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/templates/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.html&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateMode&quot;</span> <span class="attr">value</span>=<span class="string">&quot;HTML&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!-- In the video it uses HTML5 as the value, which causes an error when using either JDK 17 or JDK 19 --&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--  &lt;property name=&quot;templateMode&quot; value=&quot;HTML5&quot;&gt;&lt;/property&gt;--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;characterEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Modify the html file, add the thymeleaf namespace
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Page redirection using thymeleaf <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- th:href let thymeleaf resolve this tag  --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- The absolute path starts from localhost:8080, you need to add the application </span></span><br><span class="line"><span class="comment">context path, which could be found in the Tomcat deployment configuration --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- @&#123;/path&#125; will be resolved by thymeleaf to /application-context/path --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- This path is actually localhost:8080/application-context/path, here is localhost:8080/applicationContext/target --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Since we already configure the thymeleaf resource, it will render the WEB-INF/templates/target.html page --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/target&#125;&quot;</span>&gt;</span>Go to Target page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/target&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">target</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;target&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li><code>@RequestMapping()</code>
<ul>
<li>A request mapping value should be unique among all controllers</li>
<li>This annotation can be placed on class and on method
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">// Similar to Express router</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/base&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller1</span> </span>&#123;</span><br><span class="line">   <span class="comment">// This actually handles localhost:8080/applicationContext/base/detail</span></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/detail&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">detail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;detail&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Match URL placeholder(like <code>/user/id</code> in javascript)
using the <code>@PathVariable</code> annotation. You can use multiple
placeholders in a url <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// If there is a placeholder in the url, the id must be provided,</span></span><br><span class="line"><span class="comment">// otherewise an error will occur</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="comment">// The value of pathvariable should be the same as the requestmapping value</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">profile</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;profile&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>If there is only one value parameter inside the annotation, the
<code>value=</code> can be omitted</li>
<li>Value can be an array, this means the controller can handles
multiple request urls</li>
<li><code>method=RequestMethod.GET/POST/...</code>, default is get
method. You can use <code>@GetMapping</code> annotation for get method,
etc. If request method is not allowed, an 405 error will be caused</li>
<li><code>paramName</code> request must have parameters,
<code>!paramName</code> request cannot have parameters,
<code>param=value</code> parameter name and value,
<code>param!= value</code> must have parameter and its value cannot be
the above value</li>
<li>URL parameters in thymeleaf: <code>(k1=v1, k2=v2)</code>, the
original <code>?k1=va&amp;k2=v2</code> also works</li>
<li><code>headerName</code> must contain this header,
<code>!headerName</code> cannot contain this header,
<code>header=value</code> must contain this header and this value,
<code>header!=value</code> must contain this header and its value cannot
be the above value</li>
</ul></li>
<li>Get request parameters
<ul>
<li>Get parameters using Servlet api(The DispatcherServlet will inject
the request parameter for you) <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="comment">// The request object is injected by the DispatcherServlet</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">loginGet</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">   String username = request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">   String password = request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Get parameters using SpringMVC <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/login2&quot;)</span></span><br><span class="line"><span class="comment">// As long as the parameter names are the same as the parameter names used </span></span><br><span class="line"><span class="comment">// in the url, SpringMVC will inject the parameters for you</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">loginGet</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">   System.out.println(username + <span class="string">&quot;------&quot;</span> + password);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>For parameters with the same name(like a checkbox), use array to
match them in request mapping methods</li>
<li>If the request mapping method parameter names are not the same as
the url parameter names, you need to use the <code>@RequestParam</code>
parameter to specify the url parameter name <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="comment">// As long as the parameter names are the same as the parameter names used </span></span><br><span class="line"><span class="comment">// in the url, SpringMVC will inject the parameters for you</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">loginGet</span><span class="params">(<span class="meta">@RequestParam(&quot;user&quot;)</span> String username, <span class="meta">@RequestParam(&quot;pwd&quot;)</span> String password)</span> </span>&#123;</span><br><span class="line">   System.out.println(username + <span class="string">&quot;------&quot;</span> + password);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Parameter settings:
<code>@RequestParam(value="", required=true/false, defaultValue="")</code>,
if the value is not provided or value is an empty string, defaultValue
will be used</li>
<li>Other annotations
<ul>
<li><code>@RequestHeader(value, required, defaultValue)</code></li>
<li><code>@CookieValue(value, required, defaultValue)</code></li>
</ul></li>
<li>Use POJO(plain old java object) to get form data, if the form input
names are the same as the POJO fields. The POJO class should contain the
default constructor for Spring to use reflection to create the POJO
instance <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">   System.out.println(user);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>In order to correctly display Chinese, add filter in the xml(Tomcat
execution order: listener, filter, servlet) <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Let request encoding be UTF-8, the name is from the CharacterEncodingFilter class --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Let response encoding be UTF-8, the name is from the CharacterEncodingFilter class --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceResponseEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Use domain objects(域对象) to share data
<ul>
<li>Common domain objects: request, session, servlet context</li>
<li>You should use the domain object this has the smallest scope but is
able to accomplish your task</li>
<li>The request domain object
<ul>
<li>Use Servlet api to share data <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/success&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">success</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">   request.setAttribute(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;This is the success page&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- This is the success html, use th:text=&quot;$&#123;key&#125;&quot; to get </span></span><br><span class="line"><span class="comment">the attribute value --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;data&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Use SpringMVC <code>ModelAndView</code> to share data, other
SpringMVC methods, like <code>Model</code>, <code>Map</code>,
<code>ModelMap</code>, all use ModelAndView internally to share data and
return view <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use model to shared data in the domain object</span></span><br><span class="line"><span class="comment">// Use view to render view</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/success2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testModelAndView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">   <span class="comment">// set shared data</span></span><br><span class="line">   mav.addObject(<span class="string">&quot;dataKey&quot;</span>, <span class="string">&quot;dataValue&quot;</span>);</span><br><span class="line">   <span class="comment">// set view nam</span></span><br><span class="line">   mav.setViewName(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;dataKey&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Use SpringMVC <code>Model</code> to shared data <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/success3&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testModel</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">   model.addAttribute(<span class="string">&quot;dataKey&quot;</span>, <span class="string">&quot;dataValue&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Use Map to share data <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/success4&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testMap</span><span class="params">(Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">   map.put(<span class="string">&quot;dataKey&quot;</span>, <span class="string">&quot;dataValue&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Use SpringMVC <code>ModelMap</code> to share data
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/success4&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testMap</span><span class="params">(ModelMap modelMap)</span> </span>&#123;</span><br><span class="line">   modelMap.addAttribute(<span class="string">&quot;dataKey&quot;</span>, <span class="string">&quot;dataValue&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>The session domain object
<ul>
<li>Use Servlet API to share data <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/session&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">sessionGet</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">   session.setAttribute(<span class="string">&quot;sessionData&quot;</span>, <span class="string">&quot;The Page&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Use session.key to get its corresponding value  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.sessionData&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>You can also use the <code>@SessionAttributes</code> annotation</li>
</ul></li>
<li>The application(servlet context) domain object
<ul>
<li>Use Servlet API to share data <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/application&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getServletContext</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">   ServletContext servletContext = session.getServletContext();</span><br><span class="line">   servletContext.setAttribute(<span class="string">&quot;applicationKey&quot;</span>, <span class="string">&quot;The page&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Use application.key to get its corresponding value  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;application.applicationKey&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li>SpringMVC View
<ul>
<li>SpringMVC has different views, <code>InternalResourceView</code> is
used for forwarding, <code>RedirectView</code> is used for
redirecting</li>
<li>If a view name is resolved by Thymeleaf view resolver, the view is
<code>ThymeleafView</code>. This happens when the view name has no
prefix</li>
<li>If a view name has prefix <code>forward:/URL</code>, then it's an
InternalResourceView and will be forwarded and then resolved by the
mapping that handles <code>/URL</code> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The URL is localhost:8080/applicationContext/forwardTest</span></span><br><span class="line"><span class="comment">// The content is the view resolved by the /getThymeleafView mapping</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/forwardTest&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testForwardView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;forward:/getThymeleafView&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>If a view name has prefix <code>redirect:/URL</code>, then it's an
RedirectView and will be redirected and the resolved by the mapping that
handles <code>/URL</code> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The URL is localhost:8080/applicationContext/getThymeleafView</span></span><br><span class="line"><span class="comment">// The content is the view resolved by the /getThymeleafView mapping</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/redirectTest&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testRedirectView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;redirect:/getThymeleafView&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>If you only need a render a view without including any other program
logic, you can use the <code>&lt;mvc:view-controller&gt;</code> in the
xml file. Meantime, this view-controller configuration will disable all
annotation based request mappings. You need to include
<code>&lt;mvc: annotation-driven&gt;</code> to re-enable those mappings.
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;index&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:view-controller</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- This tag has lots features, for example, render static resources, convert pojo to jsons, etc. --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Use SpringMVC to render JSP views <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- In the springMVC.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/templates&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>RESTFul
<ul>
<li>REST: representation state transfer</li>
<li>Post for new, put for update</li>
<li>An example
<ul>
<li><code>/user</code> get all users</li>
<li><code>/user/id</code> get a user by id</li>
<li><code>/user</code> post a new user</li>
<li><code>/user/id</code> delete a user by id</li>
<li><code>/user</code> update a user by id</li>
</ul></li>
<li>For get and post request, no additional effort is needed. For put
and delete request, a filter needs to be added to the spring
configuration xml(from the source code, this filter basically converts
POST method to other method types and create a new request based on the
new method). Meantime, the form method type should be <code>POST</code>,
an input with name <code>_method</code> and a specific method type as
value for the requst should be provided. This filter should be placed
after the CharacterEncodingFilter: <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Iteration in thymeleaf <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- th:each=&quot;item: $&#123;dataFromRequest&#125;&quot; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;employee : $&#123;employees&#125;&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Remember this twp path concatenation formats --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/&#x27;+ $&#123;employee.id&#125;&#125;&quot;</span>&gt;</span>Delete<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/employee/&#125; + $&#123;employee.id&#125;&quot;</span>&gt;</span>Delete<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>PUT request <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/&#x27;+$&#123;employee.id&#125;&#125;&quot;</span>&gt;</span>update<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/employee&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;employee.id&#125;&quot;</span>&gt;</span></span><br><span class="line">   lastName: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;employee.lastName&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">   email: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;employee.email&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">   gender: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;$&#123;employee.gender&#125;&quot;</span>&gt;</span>male</span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;$&#123;employee.gender&#125;&quot;</span>&gt;</span>female<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Update<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>DELETE request via anchor link：prevent anchor linkd default
behavior, let it instead submit a form with hidden input to change
request method. If you want to enable access to static resources like
css, js, etc. Add <code>&lt;mvc:default-servlet-handler&gt;</code> to
the configufation xml. <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get all anchors, add click event, change the action of form</span></span><br><span class="line"><span class="built_in">document</span>.querySelectorAll(<span class="string">&quot;.deleteEmployee&quot;</span>).forEach(<span class="function"><span class="params">anchor</span> =&gt;</span> &#123;</span><br><span class="line">   anchor.addEventListener(<span class="string">&#x27;click&#x27;</span> ,<span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">         event.preventDefault();</span><br><span class="line">         <span class="keyword">let</span> form = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#delete_form&quot;</span>);</span><br><span class="line">         form.setAttribute(<span class="string">&#x27;action&#x27;</span>, anchor.getAttribute(<span class="string">&quot;href&quot;</span>));</span><br><span class="line">         form.submit();</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>HttpMessageConverter
<ul>
<li>HttpMessageConverter is a strategy interface that converts request
to object representation and from object representation to response</li>
<li>Two annotations: <code>@RequestBody</code>,
<code>@ResponseBody</code>, two types: <code>RequestEntity</code>,
<code>ResponseEntity</code></li>
<li>Use <code>@RequestBody</code> to get request body
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/requestBody&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testRequestBody</span><span class="params">(<span class="meta">@RequestBody</span> String requestBody)</span> </span>&#123;</span><br><span class="line">   System.out.println(requestBody);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;redirect:/success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Use <code>RequestEntity</code> to get the whole request entity
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/requestEntity&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testRequestEntity</span><span class="params">(RequestEntity&lt;String&gt; requestEntity)</span> </span>&#123;</span><br><span class="line">   System.out.println(requestEntity.getHeaders());</span><br><span class="line">   System.out.println(requestEntity.getBody());</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;redirect:/success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Use vanilla HttpServletResponse to respond data <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/servletResponse&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">servletResponse</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">   response.getWriter().write(<span class="string">&quot;Http Servlet Response!!!!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Use <code>@ResponseBody</code> to set response body, the return
value of a method will be set as the response body <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/responseBody&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testResponseBody</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Use <code>@ResponseBody</code> to respond Java object. This
annotation by default can only set String into respond body. You need to
following dependency to automatically convert Java object to JSON in
response. And also enable <code>&lt;mvc:annotation-driven /&gt;</code>
in the configuration xml. Then the package will generate
<code>MappingJackson2HttpMessageConverter</code> to convert Java Object
to JSON String in response. <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.15.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/objectResponse&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">testObjectResponse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   User user = <span class="keyword">new</span> User();</span><br><span class="line">   user.setName(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">   user.setEmail(<span class="string">&quot;user@gmail.com&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>@RestController</code> = <code>@Controller</code> on the class
+ <code>@ResponseBody</code> on each method inside the class</li>
<li>Use <code>ResponseEntity</code> to download a specific file. This
requires <code>&lt;mvc:default-servlet-handler&gt;</code> in the
configuration xml to access the static file <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/downloadFile&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;<span class="keyword">byte</span>[]&gt; testResponseEntity(HttpSession session) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">   <span class="comment">// Get servlet context</span></span><br><span class="line">   ServletContext servletContext = session.getServletContext();</span><br><span class="line">   <span class="comment">// Get file real path on the server</span></span><br><span class="line">   <span class="comment">// The files is /webapp/static/img/gallery.png</span></span><br><span class="line">   String realPath = servletContext.getRealPath(<span class="string">&quot;/static/img/gallery.png&quot;</span>);</span><br><span class="line">   <span class="comment">// Create input stream</span></span><br><span class="line">   InputStream is = <span class="keyword">new</span> FileInputStream(realPath);</span><br><span class="line">   <span class="comment">// Create byte array to contain the file</span></span><br><span class="line">   <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[is.available()];</span><br><span class="line">   <span class="comment">// Read file into the byte array</span></span><br><span class="line">   is.read(bytes);</span><br><span class="line">   <span class="comment">// Create response header</span></span><br><span class="line">   MultiValueMap&lt;String, String&gt; headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">   <span class="comment">// Create download method and file path </span></span><br><span class="line">   headers.add(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=gallery.png&quot;</span>);</span><br><span class="line">   <span class="comment">// Create response status code</span></span><br><span class="line">   HttpStatus statusCode = HttpStatus.OK;</span><br><span class="line">   <span class="comment">// Create response enetity</span></span><br><span class="line">   ResponseEntity&lt;<span class="keyword">byte</span>[]&gt; responseEntity = <span class="keyword">new</span> ResponseEntity&lt;&gt;(bytes, headers, statusCode);</span><br><span class="line">   <span class="comment">// Close the stream</span></span><br><span class="line">   is.close();</span><br><span class="line">   <span class="keyword">return</span> responseEntity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>File upload, include the <code>commons-fileupload</code> dependency,
include resolved for <code>MultipartFile</code>:
<code>CommonsMultipartResolver</code>. For Spring &gt;= 6.0,
commons-fileupload is not supported and you can user another internal
resolver. <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- For file upload, method should be POST and enctype should be  multipart/form-data. </span></span><br><span class="line"><span class="comment">This will convert form data to binary data so that a file could be uploaded--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/uploadFile&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;photo&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Incepter
<ul>
<li>Request handling process: filter -&gt; DispatcherServlet -&gt;
intercepter:preHandle -&gt; controller(requestMappingHandler) -&gt;
intercepter:postHandle -&gt; render view -&gt;
intercepter:afterCompletion</li>
<li>Interceptor Steps
<ol type="1">
<li>Create a class that implements <code>HandlerInterceptor</code> and
overrides 3 methods <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">   <span class="comment">// If return false, block controller execution, else continue to execute</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;preHandle&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;postHandle&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;afterCompletion&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Add the conceptor in the configuration file <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">&lt;!-- This has effect on all request mappings  --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.ic.MyInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- This has effect on all request mappings  --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Need to annotate the interceptor class with @Component to make it a bean,</span></span><br><span class="line"><span class="comment">   make sure this interceptor bean is scanned --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;myInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Customize interceptor url --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- /** maps all request mappings, /* does not map all --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;/test&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.yanxuanshaozhu.ic.MyInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol></li>
<li>Execution order of multiple interceptors
<ul>
<li>preHandle executes in the order of definition order in the
configuration xml</li>
<li>postHandl and afterCompletion executes in the reverse order of
definition order in the configuration xml</li>
</ul></li>
</ul></li>
<li>Exception handler
<ul>
<li>XML-based exception mapping: if exception occurs, jump to a specific
page <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionMappings&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- key is exception qualified name, value is html page name --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;java.lang.ArithmeticException&quot;</span>&gt;</span>error<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- save the exception to request domain, key is the value here, value </span></span><br><span class="line"><span class="comment">   is the exception --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionAttribute&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ex&#125;&lt;/span&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li>Annotation based configuration: if exception occurs, jump to a
specific page <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Enhanced controller annotation</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionController</span> </span>&#123;</span><br><span class="line">   <span class="comment">// If exception occurs, add exception to request domain, jump to error page</span></span><br><span class="line">   <span class="meta">@ExceptionHandler(value = &#123;ArithmeticException.class, NullPointerException.class&#125;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">handler</span><span class="params">(Exception ex, Model model)</span> </span>&#123;</span><br><span class="line">      model.addAttribute(<span class="string">&quot;ex&quot;</span>, ex);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Annotation based SpringMVC configuration
<ul>
<li>Create a class to replace <code>web.xml</code> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yanxuanshaozhu.anno;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.CharacterEncodingFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.HiddenHttpMethodFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use this to replace web.xml</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInitializer</span> <span class="keyword">extends</span> <span class="title">AbstractAnnotationConfigDispatcherServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Spring configuration class</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Class[]&#123;SpringConfig.class&#125;;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// SpringMVC configuration class</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Class[]&#123;SpringMVCConfig.class&#125;;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Configure DispatcherServlet servlet-mapping</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">&quot;/&quot;</span>&#125;;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Configure filters</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> Filter[] getServletFilters() &#123;</span><br><span class="line">      CharacterEncodingFilter characterEncodingFilter = <span class="keyword">new</span> CharacterEncodingFilter();</span><br><span class="line">      characterEncodingFilter.setEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">      characterEncodingFilter.setForceResponseEncoding(<span class="keyword">true</span>);</span><br><span class="line">      HiddenHttpMethodFilter hiddenHttpMethodFilter = <span class="keyword">new</span> HiddenHttpMethodFilter();</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Filter[]&#123;characterEncodingFilter, hiddenHttpMethodFilter&#125;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Create a class called <code>SpringMVCConfig</code> to replace its
xml configuration file. This is a working one based on Spring 6 and
Thymeleaf &gt;= 3.1 based on the official documentation of Thymeleaf
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yanxuanshaozhu.anno;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.ContextLoader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ViewResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.spring6.SpringTemplateEngine;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.spring6.templateresolver.SpringResourceTemplateResolver;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.spring6.view.ThymeleafViewResolver;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templatemode.TemplateMode;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This is a configuration class</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// Enable component-scan</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.yanxuanshaozhu.anno&quot;)</span></span><br><span class="line"><span class="comment">// Enable mvc annotation driven</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMVCConfig</span> </span>&#123;</span><br><span class="line">   <span class="comment">// Config thymeleaf</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="comment">// For Thymeleaf version &lt;= 3.0, this method has several changes</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> SpringResourceTemplateResolver <span class="title">templateResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">      WebApplicationContext webApplicationContext = ContextLoader.getCurrentWebApplicationContext();</span><br><span class="line">      SpringResourceTemplateResolver templateResolver = <span class="keyword">new</span> SpringResourceTemplateResolver();</span><br><span class="line">      templateResolver.setApplicationContext(webApplicationContext);</span><br><span class="line">      templateResolver.setPrefix(<span class="string">&quot;/WEB-INF/templates/&quot;</span>);</span><br><span class="line">      templateResolver.setSuffix(<span class="string">&quot;.html&quot;</span>);</span><br><span class="line">      templateResolver.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">      templateResolver.setTemplateMode(TemplateMode.HTML);</span><br><span class="line">      <span class="keyword">return</span> templateResolver;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> SpringTemplateEngine <span class="title">templateEngine</span><span class="params">(SpringResourceTemplateResolver templateResolver)</span> </span>&#123;</span><br><span class="line">      SpringTemplateEngine templateEngine = <span class="keyword">new</span> SpringTemplateEngine();</span><br><span class="line">      templateEngine.setTemplateResolver(templateResolver);</span><br><span class="line">      <span class="keyword">return</span> templateEngine;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ViewResolver <span class="title">viewResolver</span><span class="params">(SpringTemplateEngine templateEngine)</span> </span>&#123;</span><br><span class="line">      ThymeleafViewResolver viewResolver = <span class="keyword">new</span> ThymeleafViewResolver();</span><br><span class="line">      viewResolver.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">      viewResolver.setTemplateEngine(templateEngine);</span><br><span class="line">      <span class="keyword">return</span> viewResolver;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Configure default servlet handler for static resources</span></span><br><span class="line">   <span class="comment">// This method needs to implement WebMvcConfigurer</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// enable default servlet handler</span></span><br><span class="line">      configurer.enable();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Configure interceptors</span></span><br><span class="line">   <span class="comment">// This method needs to implement WebMvcConfigurer</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">      MyInterceptor myInterceptor = <span class="keyword">new</span> MyInterceptor();</span><br><span class="line">      <span class="comment">// Add interceptor and apply on all urls</span></span><br><span class="line">      registry.addInterceptor(myInterceptor).addPathPatterns(<span class="string">&quot;/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/hello&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Configure view-controllers</span></span><br><span class="line">   <span class="comment">// This method needs to implement WebMvcConfigurer</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">      registry.addViewController(<span class="string">&quot;/hello&quot;</span>).setViewName(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// ExceptionHandler</span></span><br><span class="line">   <span class="comment">// This method needs to implement WebMvcConfigurer</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">extendHandlerExceptionResolvers</span><span class="params">(List&lt;HandlerExceptionResolver&gt; resolvers)</span> </span>&#123;</span><br><span class="line">      SimpleMappingExceptionResolver resolver = <span class="keyword">new</span> SimpleMappingExceptionResolver();</span><br><span class="line">      Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">      properties.setProperty(<span class="string">&quot;java.lang.ArithmeticException&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">      resolver.setExceptionMappings(properties);</span><br><span class="line">      resolver.setExceptionAttribute(<span class="string">&quot;ex&quot;</span>);</span><br><span class="line">      resolvers.add(resolver);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ol>
<h1 id="尚硅谷mybatis">尚硅谷MyBatis</h1>
<ol type="1">
<li>Introduction
<ul>
<li>Based on iBatis, a persistence framework with support for custom
SQL, stored proceures and advanced mappings</li>
<li>Persistence layer technologies
<ul>
<li>JDBC</li>
<li>Hibernate and JPA: no need to write SQL at all，auto framework</li>
<li>MyBatis: semi-auto</li>
</ul></li>
<li>MyBatis configuration file
<ul>
<li>Dependencies: <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Configuration XML file and the Mapper XML files</li>
<li>Configuration XML: the transactionManager can be set to JDBC or
MANAGED. For JDBC, transaction needs to be managed manually, for
MANAGED, transaction can be managed by Spring. The child tags inside the
configuration should be placed in order: properties -&gt; settings -&gt;
typeAliases -&gt; ... -&gt; environments -&gt; ... -&gt; mapers
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">      <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">      <span class="meta-string">&quot;https://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Include the properties file, the file is located inside the resources folder --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Create type aliases, so resultType/resultMap etc can be easier --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- alias can be omitted, the default alias will be user in all cases --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.yanxuanshaozhu.pojo.User&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;User&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">typeAlias</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Configure database settings --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Include the mapper file   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>An example mapper configuration xml file and its corresponding
mapper interface <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">      <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">      <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- namespace is the fully-qualified name of the UserMapper--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.yanxuanshaozhu.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- id is the method name in UserMapper    --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span>&gt;</span></span><br><span class="line">      insert into t_user(null, &quot;admin&quot;, &quot;123456&quot;, 23, &quot;M&quot;, &quot;admin@gmail.com&quot;);</span><br><span class="line">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yanxuanshaozhu.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">int</span> <span class="title">insertUser</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>A test <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMyBatis</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">   <span class="comment">// The configuration file is located inside the resources folder</span></span><br><span class="line">   InputStream is = getClass().getResourceAsStream(<span class="string">&quot;/mybatis-config.xml&quot;</span>);</span><br><span class="line">   SqlSessionFactoryBuilder sqlSessionFactoryBuilder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">   SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(is);</span><br><span class="line">   <span class="comment">// create session and set auto commit to true</span></span><br><span class="line">   SqlSession sqlSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">   UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">   <span class="keyword">int</span> result = userMapper.insertUser();</span><br><span class="line">   System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>For query statements, you need to provide either
<code>resultType</code> or <code>resultMap</code> so that MyBatis can
convert a row in the ResultSet into a Java Obejct. If the database
column names are the same as the names of fields, using
<code>resultType</code> is much simpler. <code>resultType</code> or
<code>resultMap</code> is either fully-qualified class name or type
alias <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.yanxuanshaozhu.pojo.User&quot;</span>&gt;</span></span><br><span class="line">   select * from t_user where id = 1;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.yanxuanshaozhu.pojo.User&quot;</span> &gt;</span></span><br><span class="line">   select * from t_user;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li>Use MyBatis to access parameters
<ul>
<li>Two approaches:
<ul>
<li><code>$&#123;&#125;</code> is string concatenation in essense. For java types
that are mapped to characters in SQL, use quotation marks on the
variables: <code>'$&#123;&#125;'</code>. For <code>#&#123;&#125;</code>. not quotation marks
are needed</li>
<li><code>#&#123;&#125;</code> is string interpolation in essense, this will add
quotation marks and cannot be used in some situations</li>
</ul></li>
<li>Single literal parameter <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;User&gt; <span class="title">getUserBySex</span><span class="params">(String sex)</span></span>;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserBySex&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">   select * from t_user where sex = &#x27;$&#123;sex&#125;&#x27;;</span><br><span class="line">   <span class="comment">&lt;!-- select * from t_user where sex = #&#123;sex&#125; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span>`</span><br></pre></td></tr></table></figure></li>
<li>Multiple literal parameters, use
<code>arg0</code>,<code>arg1</code>,..., or <code>param1</code>,
<code>param2</code>, .... This is because MyBatis creates a map to store
the paremeters <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">User <span class="title">checkLogin</span><span class="params">(String username, String password, String sex)</span></span>;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;checkLogin&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- select * from t_user where username=&#x27;$&#123;arg0&#125;&#x27; and password = &#x27;$&#123;arg1&#125;&#x27; and sex = &#x27;$&#123;arg2&#125;&#x27;; --&gt;</span></span><br><span class="line">   select * from t_user where username=#&#123;arg0&#125; and password = #&#123;arg1&#125; and sex = #&#123;arg2&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;checkLogin&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- select * from t_user where username=&#x27;$&#123;param1&#125;&#x27; and password = &#x27;$&#123;param2&#125;&#x27; and sex = &#x27;$&#123;param3&#125;&#x27;; --&gt;</span></span><br><span class="line">   select * from t_user where username=#&#123;param1&#125; and password = #&#123;param2&#125; and sex = #&#123;param3&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Multiple literal parameters with map <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">User <span class="title">checkLogin</span><span class="params">(Map&lt;String, Object&gt;)</span></span>;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;checkLogin&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- The values depend on the actual map keys in your code--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- select * from t_user where username=&#x27;$&#123;username&#125;&#x27; and password = &#x27;$&#123;password&#125;&#x27;; --&gt;</span></span><br><span class="line">   select * from t_user where username=#&#123;username&#125; and password = #&#123;password&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;admin&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line">mapper.checkLogin(map);</span><br></pre></td></tr></table></figure></li>
<li>A POJO parameter <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> &gt;</span></span><br><span class="line">   insert into t_user(id, username, password, age, sex, email)</span><br><span class="line">   values (null, #&#123;username&#125;, #&#123;password&#125;, #&#123;age&#125;, #&#123;sex&#125;, #&#123;email&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Use <code>@Param(value)</code> to customize map key names of the
MyBatis auto generated map <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">User <span class="title">checkLogin</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username, <span class="meta">@Param(&quot;password&quot;)</span> String password)</span></span>;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;checkLogin&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">   select * from t_user where username=#&#123;username&#125; and password = #&#123;password&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>MyBatis Query
<ul>
<li>Query for POJO <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">User <span class="title">getUserById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span></span>;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from t_user</span><br><span class="line">   where id = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Query for list of POJO <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;User&gt; <span class="title">getAllUsers</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from t_user;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Query for one value: <code>java.lang.Integer</code>,
<code>int</code>, <code>Int</code>, <code>Integer</code> all works,
these are built-in type aliases for Integer. For int , use
<code>_int</code>, or <code>_integer</code>. Other aliases include
<code>string</code>, <code>map</code>, <code>list</code>,
<code>arraylist</code>, <code>collection</code>, ... <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getUserCount</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">   select count(1)</span><br><span class="line">   from t_user;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Convert query result to map: key is field/column name, value is
value/column value
<ul>
<li>One result <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Map&lt;String, Object&gt; <span class="title">getUserByIdToMap</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span></span>; </span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByIdToMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from t_user</span><br><span class="line">   where id = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Multiple results <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Map&lt;String, Object&gt;&gt; getAllUsersToMap();</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUsersToMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">   select * </span><br><span class="line">   from t_user;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>String fuzzy match <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;User&gt; <span class="title">getUsersByFuzzyNameMatch</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username)</span></span>;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUsersByFuzzyNameMatch&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from t_user</span><br><span class="line">   where username like &#x27;%$&#123;username&#125;%&#x27;;</span><br><span class="line">   <span class="comment">&lt;!-- where username like concat(&#x27;%&#x27;, #&#123;username&#125;, &#x27;%&#x27;); --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- where username like &quot;%&quot;#&#123;username&#125;&quot;%&quot;; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Multiple deletion using <code>$&#123;&#125;</code> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">multipleDeletion</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> String ids)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;multipleDeletion&quot;</span>&gt;</span></span><br><span class="line">   delete</span><br><span class="line">   from t_user</span><br><span class="line">   where id in ($&#123;ids&#125;);</span><br><span class="line">   <span class="comment">&lt;!-- cannot use #&#123;ids&#125;, because it adds quotation marks and results</span></span><br><span class="line"><span class="comment">   in syntax error in the SQL statement --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> result = mapper.multipleDeletion(<span class="string">&quot;7,8,9&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>Dynamic access table name using <code>$&#123;&#125;</code>, cannot use
<code>#&#123;&#125;</code> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;User&gt; <span class="title">getData</span><span class="params">(<span class="meta">@Param(&quot;tblName&quot;)</span> String tblName)</span></span>;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getData&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from $&#123;tblName&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Get auto_increment keys after insertion <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getKeyAfterInsertion</span><span class="params">(User user)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- key id is used so useGeneratedKeys is true --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- the generated will be added to the id property so keyProperty is id --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;getKeyAfterInsertion&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">   insert into t_user(id, username, password, age, sex, email)</span><br><span class="line">   values (null, #&#123;username&#125;, #&#123;password&#125;, #&#123;age&#125;, #&#123;sex&#125;, #&#123;email&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User user = <span class="keyword">new</span> User(<span class="keyword">null</span>, <span class="string">&quot;user1&quot;</span>, <span class="string">&quot;123&quot;</span>, <span class="number">20</span>,<span class="string">&quot;M&quot;</span>,<span class="string">&quot;user1@gmail.com&quot;</span>);</span><br><span class="line">System.out.println(user.getId());    <span class="comment">// null</span></span><br><span class="line"><span class="keyword">int</span> result = mapper.getKeyAfterInsertion(user);       </span><br><span class="line">System.out.println(user.getId());    <span class="comment">// an Integer id</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Customzie mapping between fields and column names
<ul>
<li>There will be problems when the POJO filed names and the database
column names do not match: the corresponding filed values will be their
zero-equivalent values.</li>
<li>Solution 1: create name alias in sql statements <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- database column name: emp_name --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- POJO field name: empName --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllEmps&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">   select eid, emp_name empName, age, sex, did, email</span><br><span class="line">   from t_emp;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Solution 2: use global settings in the
<code>mybatis-config.xml</code> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- This setting requires column names and fields meet their respective naming requirements and only differ in styling--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Solution 3: use <code>resultMap</code> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Use id for primary key mapping --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Use result for other mappings --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Use the result map id   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllEmps&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from t_emp;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>N-to-1 mapping: suppose <code>t_emp</code> table has a
<code>did</code> that is a foreign key and maps to the <code>did</code>
of <code>t_dept</code>. Then we need to add a <code>Dept</code> field in
the <code>Emp</code> class. Here are some examples for handling queries
with join operation in this situation <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Approach 1: pure resultMap --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empWithDept&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Handle mappings for did and dept_name int the t_dept table --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dept.did&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dept.deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDept&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empWithDept&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from t_emp emp,</span><br><span class="line">         t_dept dept</span><br><span class="line">   where emp.did = dept.did</span><br><span class="line">      and emp.eid = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Approach 2: resultMap with association --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empWithDept2&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Use association for reference --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;did&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- SQL query for this is the same as the above one --&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Approach 3: query by step --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- The following code is inside EmpMapper.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empWithDeptByStep&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- select is the fully-qualified name of the step 2 method, the method will call the select statements in step 2 --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- column is the column name in step 1, also the one used in step 2 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.yanxuanshaozhu.mapper.DeptMapper.getEmpAndDeptStepTwo&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;did&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDeptStepOne&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empWithDeptByStep&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from t_emp</span><br><span class="line">   where eid = $&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- The following code is inside DeptMapper.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empWithDeptResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;did&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDeptStepTwo&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empWithDeptResult&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from t_dept</span><br><span class="line">   where did = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>1-to-N mapping: suppose <code>t_emp</code> table has a
<code>did</code> that is a foreign key and maps to the <code>did</code>
of <code>t_dept</code>. Then we need to add a <code>Emps</code> field in
the <code>Dept</code> table, which is a list of employees in that
department. Here are some examples for handling queries with join
operation in this situation <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Approach 1: resultMap with collection  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndEmp1&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;did&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 1 dept maps to many emps so use collection here --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndEmp&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;getDeptAndEmp1&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from t_dept,</span><br><span class="line">         t_emp</span><br><span class="line">   where t_dept.did = t_emp.did</span><br><span class="line">      and t_dept.did = #&#123;did&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Approach 2: query by step  --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- The following code is inside DeptMapper.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndEmpStepOneMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;did&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- select is the fully-qualified name of the select id/method name --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- column is the column name in step 1, also the one used in step 2 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.yanxuanshaozhu.mapper.EmpMapper.getDeptAndEmpStepTwo&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndEmpStepOne&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;getDeptAndEmpStepOneMap&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from t_dept</span><br><span class="line">   where did = #&#123;did&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- The following code is inside EmpMapper.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndEmpStepTwo&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from t_emp</span><br><span class="line">   where did = #&#123;did&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Dynamic SQL
<ul>
<li>A series of xml tags used for conditionally concatenating strings of
SQL together</li>
<li><code>&lt;if test=""&gt;&lt;/if&gt;</code> expression
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">      <span class="comment">&lt;!-- The resultMap is only used to map emp_name and empName here--&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Approach 1: addition a true condition--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByCondition&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 1 = 1 is added to make sure when empName is null </span></span><br><span class="line"><span class="comment">         but other fields are not null, the and keyword does not </span></span><br><span class="line"><span class="comment">         cause an error --&gt;</span></span><br><span class="line">         select * from t_emp where 1 = 1</span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">               emp_name = #&#123;empName&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">               and age = #&#123;age&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null and email != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">               and email = #&#123;email&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null and sex != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">               and sex = #&#123;sex&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         ;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">* `<span class="tag">&lt;<span class="name">where</span>&gt;</span><span class="tag">&lt;/<span class="name">where</span>&gt;</span>` expression</span><br><span class="line">   ```xml</span><br><span class="line">      <span class="comment">&lt;!-- Approach 2: using where statement--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByCondition&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">         select * from t_emp</span><br><span class="line">         <span class="comment">&lt;!-- where can automatically generate the where keyword, and remove the preceding or/and </span></span><br><span class="line"><span class="comment">         keyword when its if statment evaluates to false --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">               emp_name = #&#123;empName&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">               and age = #&#123;age&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null and email != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">               and email = #&#123;email&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null and sex != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">               and sex = #&#123;sex&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">         ;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><code>&lt;trim prfix="" suffix="" prefixOverrides="" suffixOverrides=""&gt;</code>
expression <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Approach 3: using trim to customize where--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByCondition&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">   select * from t_emp</span><br><span class="line">   <span class="comment">&lt;!-- prefix: prefix of trim --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- prefixOverrides: if condition evaluates to false, remove words specified here --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;and | or &quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">         emp_name = #&#123;empName&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">         and age = #&#123;age&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null and email != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">         and email = #&#123;email&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null and sex != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">         and sex = #&#123;sex&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">   ;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><code>&lt;choose&gt;&lt;when&gt;&lt;/when&gt;&lt;otherwise&gt;&lt;/otherwise&gt;&lt;/choose&gt;</code>
expression <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByCondition&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">   select * from t_tmp</span><br><span class="line">   <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Only one when condition could be met --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- If all when conditions are false, go to the otherwise statement --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            emp_name = #&#123;empName&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            age = #&#123;age&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;email != null and email != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            email = #&#123;email&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;sex != null and sex != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and sex = #&#123;sex&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            did = 1;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">   ;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><code>&lt;foreach collection="" item="" separator=""&gt;&lt;/foreach&gt;</code>
expression <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">deleteEmpByIds</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> Integer[] ids)</span></span>;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  Delete multiple records --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Approach 1: id in (ids) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteEmpByIds&quot;</span>&gt;</span></span><br><span class="line">   delete from t_emp where eid in</span><br><span class="line">   (<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">      #&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>)</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Approach 2: id = ? or id = ? --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteEmpByIds&quot;</span>&gt;</span></span><br><span class="line">   delete from t_emp where </span><br><span class="line">   (<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;or&quot;</span>&gt;</span></span><br><span class="line">      eid = #&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>)</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertMultipleEmp</span><span class="params">(<span class="meta">@Param(&quot;emps&quot;)</span> List&lt;Emp&gt; emps)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Insert multiple records --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertMultipleEmp&quot;</span>&gt;</span></span><br><span class="line">   insert into t_emp values</span><br><span class="line">   <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">      (null, #&#123;emp.empName&#125;, #&#123;emp.age&#125;, #&#123;emp.sex&#125;, #&#123;emp.email&#125;, null)</span><br><span class="line">   <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><code>&lt;sql&gt;&lt;/sql&gt;</code> expression <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Defined sql segment for reuse  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;empColumns&quot;</span>&gt;</span></span><br><span class="line">   eid, emp_name, age, sex, email</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByCondition&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Include sql segments --&gt;</span></span><br><span class="line">   select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;empColumns&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span> from t_emp</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Cache in Mybatis
<ul>
<li>Mybatis has two levels of cache: 1st level session cache, 2nd level
global cache. With cache, the data is retrieved from the cache and the
same sql statement will not be executed again</li>
<li>First level cache
<ul>
<li>By default enabled, the data is cached in the
<code>sqlSession</code></li>
<li>Situations when 1st level cache fails
<ul>
<li>Different sqlsession</li>
<li>Same sqlsession but different query conditions</li>
<li>Same sqlsession but execute update/delete inbetween two queries</li>
<li>Same sqlsession but manually delete cache (call
<code>sqlSession.clearCache()</code>) between two queries</li>
</ul></li>
</ul></li>
<li>Second level cache
<ul>
<li>Steps to enable second level cache
<ol type="1">
<li>Add the following configurations to the Mybatis core configuration
xml. This step can be omited because the default value is already true
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Add <code>&lt;cache /&gt;</code> to the maper file where you want to
enable 2nd level cache</li>
<li>2nd level cache is only in effect when the sqlsession is closed or
committed, before that data is cached into 1st level cache</li>
<li>The POJO class must <code>implements Serializable</code></li>
</ol></li>
<li>Some configurations <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- If flushInterval is not set, 2nd level cache only fails when there are update or deletion --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">eviction</span>=<span class="string">&quot;LRU/FIFO/SOFT/WEAK&quot;</span> <span class="attr">flushInterval</span>=<span class="string">&quot;milliseconds&quot;</span> <span class="attr">size</span>=<span class="string">&quot;n&quot;</span> <span class="attr">readOnly</span>=<span class="string">&quot;true/false&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Cache query order: 2nd lvl cache -&gt; 1st lvl cache -&gt; query
database -&gt; save data into 1st lvl cache -&gt; save data into 2nd lvl
cache when sqlSession is closed/comitted</li>
</ul></li>
<li>You can use a 3rd-party Java-based cache framework
<code>EHCACHE</code> to replace Mybatis 2nd lvl cache <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Dependencies --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis.caches/mybatis-ehcache --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- In the mapper.xml you want to enable 2nd lvl cache --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;timeToIdleSeconds&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3600&quot;</span>/&gt;</span><span class="comment">&lt;!--1 hour--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;timeToLiveSeconds&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3600&quot;</span>/&gt;</span><span class="comment">&lt;!--1 hour--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxEntriesLocalHeap&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1000&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxEntriesLocalDisk&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10000000&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;memoryStoreEvictionPolicy&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LRU&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>MyBatis reverse engineering
<ul>
<li>MyBatis revers enginering: Mybatis automatically generate POJO, Java
interface, mapper.xml for you based on pre configurations</li>
<li>Steps
<ol type="1">
<li>Add the following dependicies and plugins <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Create a <code>generatorConfig.xml</code> with code like this. Be
aware that this setting will overrite contents of files whose names are
the same as those specified in this xml, so you should better use this
generator in a separate project <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">      <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">      <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">   targetRuntime: used to specify whtich version should use for reverse engineering, could be </span></span><br><span class="line"><span class="comment">   MyBatis3Simple: generate basic CRUD, or</span></span><br><span class="line"><span class="comment">   MyBatis3: generate CRUD with conditions</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;DB2Tables&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3Simple&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Database configuration --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">&quot;123456&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- javaBean generator strategy--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.yanxuanshaozhu.mybatis.bean&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\java&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Specify targetPackage is a multi-layer package --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Trim whitespace in database column names --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- mapper.xml generator strategy --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.yanxuanshaozhu.mybatis.mapper&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\resources&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- mapper.java interface generator strategy --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">targetPackage</span>=<span class="string">&quot;com.yanxuanshaozhu.mybatis.mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Database tables and Java class mappings --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- tableName is database table name, if tableName is *, domainObjectName is not needed --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- domainObjectName is JavaBean name --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;t_emp&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Emp&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;t_dept&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Dept&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Use <code>mybatis-generator:generate</code> under
<code>mybatis-generator</code> in maven settings to generate JavaBeans,
mapper interfaces, mapper xml files</li>
</ol></li>
</ul></li>
<li>Mybatis pagehelper
<ul>
<li>Add a dependency <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.pagehelper/pagehelper --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Add the following page interceptor in
<code>mybatis-config.xml</code> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--Configure page interceptor--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>How to use <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Query for the first page with 2 records</span></span><br><span class="line">PageHelper.startPage(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// 1 is pageNum, 2 is pageSize</span></span><br><span class="line"><span class="comment">// Then the emps only contains the first two records</span></span><br><span class="line">List&lt;Emp&gt; emps = mapper.selectAll();</span><br><span class="line">emps.forEach(emp -&gt; System.out.println(emp));</span><br></pre></td></tr></table></figure></li>
<li>The logics behind: the pagehelper internally modifies the sql
statement based on pageNum and pageSize, adding limit and offset
keywords</li>
</ul></li>
</ol>
<h1 id="尚硅谷ssm整合">尚硅谷SSM整合</h1>
<ol type="1">
<li>Preparation
<ul>
<li>Dependencies and plugins <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Spring --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- SpringMVC --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- For transaction manager --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- For JSON data --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.15.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- https://mvnrepository.com/artifact/ch.qos.logback/logback-classic --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- https://mvnrepository.com/artifact/jakarta.servlet/jakarta.servlet-api --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mchange<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Mybatis--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Mybatis-spring: Mybatis &gt;= 3.5, Spring &gt;= 6.0, Java &gt;= Java 17        --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis-spring --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- MyBatis PageHelper --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.pagehelper/pagehelper --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-api --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.thymeleaf/thymeleaf-spring6 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-spring6<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mchange<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><code>web.xml</code> configuration(Tomcat execution order: listener
-&gt; filter -&gt; servlet)
<ul>
<li>SPringMVC IOC container is created when DispatcherServlet is
initialized, it manages controller layer and depends on service
layer</li>
<li>Spring IOC container manages service layer. The Autowired service is
injected into controller when SpringMVC IOC container is created, which
means the service should have already been created by the Spring IOC
container. Thus the Spring IOC container should be created before the
SpringMVC IOC container, creataion of Spring IOC container can be done
using the <code>ServletContextListener</code></li>
<li>SpringMVC IOC container is the sub-container of the Spring IOC
container, it can access all beans defined in the Spring IOC container,
but Spring IOC container cannot access beans only defined in the
SpringMVC IOC container <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- Spring listener, load Spring configuration on startup--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- Spring configuration file name and location--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- Spring CharacterEncoding   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- Filter for handling put/delete request   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- SpringMVC DispatcherServlet   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ssmDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ssmDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Configure <code>springmvc.xml</code>: component-scan,
annotation-driven, view-controller, Thymeleaf settings,
default-servlet-handler(for static resources)</li>
<li>Congigure <code>spring.xml</code>: component-scan (exclude-filter
for controller), dataSource bean with properties file included
(<code>context:property-placeholder</code>), transactionManager,...
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.user&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Configure Mybatis <code>mybatis-config.xml</code>,
<code>XXXMapper.xml</code>, and configure related beans inside
<code>spring.xml</code> (with the help of <code>mybatis-spring</code>
dependency)
<ol type="1">
<li>Configure <code>SqlSessionFactoryBean</code>, this bean adds
<code>SqlSessionFactory</code> to Spring IOC container <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Approach 1: only include the mybatis-config.xml file --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Approach 2: configure all settings here, then there&#x27;s no need to have mybatis-config.xml at all --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Configure datasource, refer the datSource bean in spring.xml --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Configure typeAliasesPackage --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.yanxuanshaozhu.ssm.pojo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Configure mapper locations: if the location is exactly the same as the locations of maper </span></span><br><span class="line"><span class="comment">   interfaces, this can be omitted --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:com/yanxuanshaozhu/ssm/mapper/*.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Configure pageHelper --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;plugins&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpServiceImpl</span> <span class="keyword">implements</span> <span class="title">EmpService</span></span>&#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> SqlSessionFactory factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Configure <code>MapperScannerConfigurer</code>( this should work
together with <code>SqlSessionFactoryBean</code> bean), this creates
delegate objects of all mappers inside basePackage, and adds all these
delegate objects to Spring IOC container, thus further simplifying the
process of creating SqlSession and getting mappers from the
SqlSessionFactory <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.yanxuanshaozhu.ssm.mapper&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpServiceImpl</span> <span class="keyword">implements</span> <span class="title">EmpService</span></span>&#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> EmpMapper mapper;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol></li>
<li>A Thymeleaf paging example <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- page is the PageInfo object passed to the current page  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;page.isHasPreviousPage()&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/employee/page/1&#125;&quot;</span>&gt;</span>First Page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;page.isHasPreviousPage()&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/page/&#x27; + $&#123;page.getPrePage()&#125;&#125;&quot;</span>&gt;</span>Previous Page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:each</span>=<span class="string">&quot;num : $&#123;page.getNavigatepageNums()&#125;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/page/&#x27; + $&#123;num&#125;&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;num&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;page.isHasNextPage()&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/page/&#x27; + $&#123;page.getNextPage()&#125;&#125;&quot;</span>&gt;</span>Next Page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;page.isHasNextPage()&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/page/&#x27; + $&#123;page.getPages()&#125;&#125;&quot;</span>&gt;</span>Last Page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
</ol>
<h1 id="尚硅谷springboot">尚硅谷SpringBoot</h1>
<ol type="1">
<li>Introduction
<ul>
<li>Spring Boot makes it easy to create stand-alone, production-grade
Spring based applications that you can just run.</li>
<li>Features
<ul>
<li>Create Spring applications with ease</li>
<li>Embed tomcat</li>
<li>Provide starter dependencies</li>
<li>Automatically configure Spring and 3rd party libraries</li>
<li>No need to use XML</li>
<li>Spring Boot 3.0 has migrated from Java EE to Jakarta EE APIs for all
dependencies</li>
</ul></li>
<li>Intro-project notice
<ul>
<li><code>pom.xml</code> settings. The
<code>spring-boot-starter-parent</code> has common dependencies
included, if you need to modify a specific dependency, find the key and
add a property in <code>pom.xml</code> like this <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Modify dependency example --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.10<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml important settings --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>By default the main class is in a root package above other classes,
otherwise there will an error like this: "Whitelabel Error Page This
application has no explicit mapping for /error, so you are seeing this
as a fallback". Another solution is to add scanned package locations:
<code>@SpringBootApplication(scanBasePackages="xxx")</code></li>
<li>To modify application settings, create and modify
<code>classpath:application.properties</code>, you can also use
<code>classpath:application.yml</code></li>
<li>Spring boot dependency control
<ul>
<li><code>spring-boot-starter-*</code> are official collections of
dependencies used in proper situations</li>
<li><code>*-spring-boot-starter</code> are 3rd party starters</li>
</ul></li>
<li>Add configuration file to define beans and get beans in the
application. Beans defined in SpringBoot are singletons. The
Configuration class itself is also a bean. <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyConfiguration.java</span></span><br><span class="line"><span class="meta">@org</span>.springframework.context.annotation.Configuration</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Configuration</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Bean(name=&quot;userCangweiXiao&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> User <span class="title">user01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="number">9</span>, <span class="string">&quot;Cangwei Xiao&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean(name = &quot;pet01&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Pet <span class="title">pet01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Pet(<span class="string">&quot;pet01&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MainApplication.java</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">   ConfigurableApplicationContext run = SpringApplication.run(MainApplication.class, args);</span><br><span class="line">   <span class="comment">// Get all bean definitions, with a lot built-int bean definitions</span></span><br><span class="line">   String[] names = run.getBeanDefinitionNames();</span><br><span class="line">   Pet pet01 = run.getBean(<span class="string">&quot;pet01&quot;</span>, Pet.class);</span><br><span class="line">   User user01 = run.getBean(<span class="string">&quot;userCangweiXiao&quot;</span>, User.class);</span><br><span class="line">   System.out.println(user01);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Use Spring-initializer to initialize a SpringBoo project</li>
</ul></li>
<li>Annotations
<ul>
<li>Add components: <code>@Configuration</code>, <code>@Bean</code>,
<code>@Component</code>, <code>@Controller</code>,
<code>@Service</code>, <code>@rEPOSITORY</code>,
<code>@ComponentScan</code>, <code>@Import(&#123;XXX.class&#125;)</code> (add
components into the container), <code>@Conditional</code> (and
subclasses like <code>@ConditionalOnBean</code>,
<code>@ConditionalOnMissingBean</code>) <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user bena is only added to the container when there is already pet bean inside the container</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(name=&quot;pet&quot;)</span></span><br><span class="line"><span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">user01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Add XML-based configurations to SpringBoot configuration
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ImportResource(&quot;classpath:beans.xml&quot;)</span></span><br><span class="line"><span class="meta">@Configuration()</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Bind java bean and values inside properties files
<ul>
<li>Approach 1: add the java class to container and set configuration
properties <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;car&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> String brand;</span><br><span class="line">   <span class="keyword">private</span> Integer price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">car.brand</span>=<span class="string">&quot;Porsche&quot;</span></span><br><span class="line"><span class="meta">car.price</span>=<span class="string">10222</span></span><br></pre></td></tr></table></figure></li>
<li>Approach 2: let the configuration class know that a specific java
class should be added to container <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(Car.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;car&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> String brand;</span><br><span class="line">   <span class="keyword">private</span> Integer price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Analysis of <code>@SpringBootApplication</code> =
<code>@SpringBootConfiguration</code>(=<code>@Configuration</code>) +
<code>@ComponentScan</code> +
<code>@EnableAutoConfiguration</code>(register packages to conatiner in
batch)</li>
<li>Use <code>debug=true</code> in <code>application.properties</code>
to view auto configuration report</li>
<li>Lombok annotations to facilitate development: <code>@Data</code> for
getter and setter, <code>@AllArgsConstructor</code>,
<code>@NoArgsConstructor</code>， <code>@ToString</code>. Notice Lombok
suports JDK 17 (reqired for SpringBoot 3) since version 1.8.22</li>
</ul></li>
<li>SpringBoot Web Development
<ul>
<li>For most cases, SpringBoot provides auto-configuration of
SpringMVC</li>
<li>Access Static resources:
<ul>
<li>By default, <code>/static</code>, <code>/public</code>,
<code>/resources</code>, <code>/META-INF/resources</code> directories
inside <code>classpath</code> can hold static resources. These resourecs
can be accessed from <code>url:port/project/</code> + resource name.
Processing order: controller -&gt; default controller for static
resources. Here's setting to change the default static resource location
to <code>classpath:/sr/</code> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">static-locations: classpath:</span> <span class="string">/sr/</span></span><br></pre></td></tr></table></figure></li>
<li>Default request url for static resource is:
<code>url:port/project/</code> + resource name, here's the configuration
for changing the url to: <code>url:port/project/resources/</code> +
resource name <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">mvc:</span></span><br><span class="line">      <span class="attr">static-path-pattern:</span> <span class="string">/resources/**</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Welcome page: <code>index.html</code> under static resource folder,
or a index templage can be detacted by SpringBoot as the welcome
page</li>
<li>Favicon: <code>favicon.ico</code> under static resource folder can
be detacted by SpringBoot as the favicon</li>
<li>Restful request: SpringBoot provides auto-configuration for
<code>HiddenHttpMethodFilter</code> if
<code>spring.mvc.hiddenmethod.filter.enabled</code> is provided and its
value is true <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// related source code</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(&#123;HiddenHttpMethodFilter.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(</span></span><br><span class="line"><span class="meta">   prefix = &quot;spring.mvc.hiddenmethod.filter&quot;,</span></span><br><span class="line"><span class="meta">   name = &#123;&quot;enabled&quot;&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">mvc:</span></span><br><span class="line">      <span class="attr">hiddenmethod:</span></span><br><span class="line">         <span class="attr">filter:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- How to change the method from post to delete in form --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;DELETE&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Customize the _method: change from _method to realMethod here</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HiddenHttpMethodFilter <span class="title">hiddenHttpMethodFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   HiddenHttpMethodFilter filter = <span class="keyword">new</span> HiddenHttpMethodFilter();</span><br><span class="line">   filter.setMethodParam(<span class="string">&quot;realMethod&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> filter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Customize the _method: change from _method to realMethod here --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;realMethod&quot;</span> <span class="attr">value</span>=<span class="string">&quot;DELETE&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Common request annotations and parameter types:
<code>@RequestParam</code>, <code>@PathVariable</code>,
<code>@RequestHeader</code>, <code>@ModelAttribute</code>,
<code>@RequestBody</code>, ..., <code>HttpServletRequest</code>,
<code>MultipartRequest</code>, <code>HttpSession</code>,
<code>Model</code>, <code>ModelAndView</code>, ...</li>
<li>Respond JSON data
<ul>
<li><code>spring-boot-starter-web</code> includes JSON related
dependencies like <code>jackson</code></li>
<li>Use <code>@ResponseBody</code> to respond JSON String</li>
<li>Spring MVC supported return type: <code>View</code>,
<code>ModelAndView</code>, <code>Model</code>,
<code>ResponseEntity</code>, <code>HttpEntity</code>,
<code>HttpHeaders</code>, <code>Callable</code>,
<code>RequestResponseBodyMethodProcessor</code> (when annotated by
<code>@ResponseBody</code>), ...</li>
<li>Logics behind： content negotiation
<ul>
<li>Client accepts certain MIME types(sent to server in request
headers), server can produce certain MIME types</li>
<li>Servet choose a certain MIME type and find the proper message
converter to convert data into that type, then respond to client</li>
<li>For Java objects, SpringMVC uses
the<code>MappingJackson2HttpMessageConverter</code> to convert any type
of data to JSON via <code>ObjectMapper</code> inside
<code>jackson</code> package</li>
</ul></li>
</ul></li>
<li>ViewResolver and Page Template
<ul>
<li>Use Thymeleaf in SpringBoot
<ul>
<li>Add the following dependency <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>SpringBoot has already configured <code>TemplateEngine</code> and
<code>ViewResolver</code> for Thymeleaf, no further configuration is
needed</li>
</ul></li>
</ul></li>
<li>Use interceptor for login purpose
<ol type="1">
<li>Create a class that implements <code>HandlerInterceptor</code> and
overrides 3 methods</li>
<li>Create a class that implements <code>WebMvcConfigurer</code> and
overrides <code>addInterceptors</code> method, notice access for static
resources should not be blocked <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Overrider</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// new your interceptor class</span></span><br><span class="line">   registry.addInterceptor(<span class="keyword">new</span> LoginInterceptor())</span><br><span class="line">      .addPathPatterns(<span class="string">&quot;/**&quot;</span>) <span class="comment">// block all</span></span><br><span class="line">      .excludePathPatterns(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/login&quot;</span>, <span class="string">&quot;/static/**&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol></li>
<li>File upload <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/upload&#125;&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;singleFile&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;multipleFile&quot;</span> <span class="attr">multiple</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(<span class="meta">@RequestPart(&quot;singleFile&quot;)</span> MultipartFile singleFile,</span></span></span><br><span class="line"><span class="function"><span class="params">                     <span class="meta">@RequestPart(&quot;multipleFile&quot;)</span> MultipartFile[] multipartFiles)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (!singleFile.isEmpty()) &#123;</span><br><span class="line">         String singleFileName = singleFile.getOriginalFilename();</span><br><span class="line">         <span class="comment">// The directory must exist otherwise error will be caused</span></span><br><span class="line">         <span class="comment">// You could use file.getParentFile().mkdirs() to create folders</span></span><br><span class="line">         singleFile.transferTo(<span class="keyword">new</span> File(<span class="string">&quot;C:\\cache\\&quot;</span> + singleFileName));</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (MultipartFile file : multipartFiles) &#123;</span><br><span class="line">         <span class="keyword">if</span> (!file.isEmpty()) &#123;</span><br><span class="line">            String fileName = file.getOriginalFilename();</span><br><span class="line">            file.transferTo(<span class="keyword">new</span> File(<span class="string">&quot;C:\\cache\\multiple\\&quot;</span> + fileName));</span><br><span class="line">         &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">servlet:</span></span><br><span class="line">      <span class="attr">multipart:</span></span><br><span class="line">         <span class="attr">max-file-size:</span> <span class="string">10MB</span>  <span class="comment"># Single file size restriction, by default 1MB</span></span><br><span class="line">         <span class="attr">max-request-size:</span> <span class="string">100MB</span> <span class="comment"># Total size restriction, by default 10MB</span></span><br></pre></td></tr></table></figure></li>
<li>Error handling
<ul>
<li>Spring Boot provides an <code>/error</code> mapping that handles all
errors: for machine clients it produces a JSON response of error, for
browser clients, it provides a <code>whitelabel</code> error view</li>
<li>To replace the default behavior, you can implement
<code>ErrorController</code> and register a bean definition of that type
or add a bean of type <code>ErrorAttributes</code> to use the existing
mechanism but replace the contents</li>
<li>Custom error pages: create an <code>error</code> folder under the
static resources folders or under the <code>templates</code> folder, and
you can use either static HTML error pages or ones built by using
templates, the name of the file should be the exact status code or a
series mask(eg <code>404.html</code> or <code>4xx.html</code>)</li>
<li>Customized exception <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseStatus(code = HttpStatus.FORBIDDEN, reason = &quot;Customized Error&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyError</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MyError</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MyError</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>(msg);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Embedded servlet container support
<ul>
<li>Spring boot includes support for embedded Tomcat, Jetty, and
Undertow servers.</li>
<li>Servlets, filters, and all the listeners can be registered either by
using Spring beans of by scanning for servlet components</li>
<li>Scan servlet, filter, listener, <code>@WebServlet</code>,
<code>@ServletComponentScan</code>, <code>@WebFilter</code>,
<code>@ServletComponentScan</code>, <code>@WebServlet</code>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/servlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">      resp.getWriter().write(<span class="string">&quot;/servlet&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Annotation on the main class, identify the servlet packages</span></span><br><span class="line"><span class="meta">@ServletComponentScan(basePackages = &quot;com.yanxuanshaozhu.demo1.servlet&quot;)</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(urlPatterns = &#123;&quot;/**&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">      Filter.<span class="keyword">super</span>.init(filterConfig);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">      filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      Filter.<span class="keyword">super</span>.destroy();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;MyListener initialized!!!!!!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;MyListener destroyed!!!!!!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Use <code>ServletRegistrationBean</code>,
<code>FilterRegistrationBean</code>,
<code>ServletListenerRegistrationBean</code> classes
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRegistrationBean</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">servletBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      MyServlet servlet = <span class="keyword">new</span> MyServlet();</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ServletRegistrationBean(servlet, <span class="string">&quot;/*&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">filterBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      MyFilter filter = <span class="keyword">new</span> MyFilter();</span><br><span class="line">      FilterRegistrationBean filterBean  = <span class="keyword">new</span> FilterRegistrationBean(filter);</span><br><span class="line">      String[] patterns = <span class="keyword">new</span> String[] &#123;<span class="string">&quot;/*&quot;</span>&#125;;</span><br><span class="line">      filterBean.setUrlPatterns(Arrays.asList(patterns));</span><br><span class="line">      <span class="keyword">return</span> filterBean;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ServletListenerRegistrationBean <span class="title">listenerBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      MyListener listener = <span class="keyword">new</span> MyListener();</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ServletListenerRegistrationBean(listener);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li>SpringBoot Data Access
<ul>
<li>Basic Configuration
<ul>
<li>Include the following dependencies <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Driver is not included, so you should also include the driver
dependencies, make sure this version-decided driver is compatible with
your database <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Some auto configurations: <code>DataSourceAutoConfiguration</code>,
<code>DataSourceTransactionManagerAutoConfiguration</code>,
<code>JdbcTemplateAutoConfiguration</code>, and more, the connection
pool is HikariCP</li>
<li>DataSource configurations <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">   <span class="attr">jdbc:</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">         <span class="attr">query-timeout:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure></li>
<li>Some notice
<ul>
<li>In order to use <code>@Autowired</code> <code>JdbcTemplate</code>,
you need to add <code>@SpringBootTest</code></li>
<li>To replace the HikariCP connection pool, you need to provide a
customized datasource(The HikariCP DataSource is only auto configured
when no customized DataSource is provided) <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The yml key is different from the HikariCP, so you need to write it yourself</span></span><br><span class="line"><span class="attr">c3p0:</span></span><br><span class="line">   <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">   <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">   <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line">   <span class="attr">driverClass:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDataSourceConfig</span> </span>&#123;</span><br><span class="line">   <span class="comment">// Bind the c3p0 in the properties/yml file, so no need to configure</span></span><br><span class="line">   <span class="comment">// datasource here</span></span><br><span class="line">   <span class="meta">@ConfigurationProperties(&quot;c3p0&quot;)</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> DataSource  <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      ComboPooledDataSource dataSource = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">      <span class="keyword">return</span> dataSource;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
<li>MyBatis Configuration
<ul>
<li>Include the following dependency <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- For SpringBoot 3.0-3.1, use mybatis-spring-boot-starter 3.0 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>To use MyBatis with Spring, at least an
<code>SqlSessionFactory</code> and at least one mapper interface are
needed. MyBatis-Spring-Boot-Starter will:
<ul>
<li>Autodetect an existing <code>DataSource</code></li>
<li>Create and register a <code>SqlSessionFactory</code> passing that
<code>DataSource</code> as an input using the
<code>SqlSessionFactoryBean</code></li>
<li>Create and register a <code>SqlSessionTemplate</code> from the
<code>SqlSessionFactory</code></li>
<li>Auto-scan the mappers, link them to the
<code>SqlSessionTemplate</code> and register them to Spring context so
they can be injected into beans</li>
</ul></li>
<li>Usage <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This @Mapper can be replaced with one annotation on the configuration class</span></span><br><span class="line"><span class="comment">// @MapperScan(&quot;package&quot;);</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmpMapper</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Select(&quot;select count(1) from t_emp&quot;)</span></span><br><span class="line">   <span class="function">Integer <span class="title">amount</span><span class="params">()</span></span>;</span><br><span class="line">   <span class="comment">// For complicated mappings, you can use xml together with annotation</span></span><br><span class="line">   <span class="function">List&lt;Emp&gt; <span class="title">getEmpLargerId</span><span class="params">(<span class="meta">@Param(&quot;eid&quot;)</span> Integer eid)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.yanxuanshaozhu.demo1.bean.Emp&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dept.did&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpLargerId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empMap&quot;</span>&gt;</span></span><br><span class="line">   select *</span><br><span class="line">   from t_emp</span><br><span class="line">   where eid &gt; #&#123;eid&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBTest</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   EmpMapper mapper;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> res = mapper.amount();</span><br><span class="line">      System.out.println(res);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      List&lt;Emp&gt; res = mapper.getEmpLargerId(<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">for</span> (Emp emp : res) &#123;</span><br><span class="line">         System.out.println(emp);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">   <span class="comment"># If this property is not specified, then the xml location should have</span></span><br><span class="line">   <span class="comment"># the same pattern as the mapper interface</span></span><br><span class="line">   <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">   <span class="attr">configuration:</span></span><br><span class="line">      <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
<li>Use PageHelper <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
</ol>
<h1 id="尚硅谷redis">尚硅谷Redis</h1>
<ol type="1">
<li>Introduction
<ul>
<li>Remote Dictionary Server(Redis) is an in-memory key-value
database</li>
<li>High in-memory performance, support persistence, support
scalability, and more</li>
<li>Installation on Linux
<ul>
<li>Install C++ environment installation
<code>yum -y install gcc-c++</code>, use <code>gcc -v</code> to check
gcc version</li>
<li>Install redis: use <code>redis-server -v</code> to check redis
version, installation <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://packages.redis.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb <span class="subst">$(lsb_release -cs)</span> main&quot;</span> | sudo tee /etc/apt/sources.list.d/redis.list</span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install redis</span><br></pre></td></tr></table></figure></li>
<li>Find Redis config file:
<code>sudo find / -name redis.conf</code></li>
<li>Edit <code>redis.conf</code>
<ul>
<li>Change <code>protected-mode yes</code> to
<code>protected-mode no</code></li>
<li>Comment <code>bind 127.0.0.1</code> to allow remote access</li>
<li>Add password: <code>requirepass &lt;pwd&gt;</code></li>
</ul></li>
<li>Start redis server with customized redis.conf:
<code>redis-server &lt;redis.conf-location&gt;</code></li>
<li>Use redis-cli to connect to redis-server:
<code>redis-cli -a &lt;pwd&gt; -p &lt;6379-or-other-port&gt;</code></li>
</ul></li>
<li>Redis data types
<ul>
<li>Key is string, data types are value types</li>
<li>String: <code>SET</code>, <code>SETNX</code>(store if not exist),
<code>GET</code>, <code>MGET</code>(multiple retrieve)</li>
<li>List: linked lists of string values, <code>LPUSH</code>,
<code>RPUSH</code>, <code>LPOP</code>, <code>RPOP</code>,
<code>LLEN</code>(length), <code>LMOVE</code>(move values from one list
to another), <code>LTRIM</code>(reduce a list to specified range of
elements)</li>
<li>Set: unordered collection of unique strings, <code>SADD</code>,
<code>SREM</code>, <code>SISMEMBER</code>,
<code>SINTER</code>(intersection), <code>SCARD</code>(size)</li>
<li>Sorted Set: collection of unique strings ordered by an associated
score, <code>ZADD</code>, <code>ZRANGE</code>(return values in a range),
<code>ZRANK</code>(ascending order rank), <code>ZREVRANK</code></li>
<li>Hash: <code>HSET</code>, <code>HGET</code>, <code>HMGET</code>,
<code>HINCRBY</code>(increment the value of a field by integer)</li>
<li>Stream: <code>XADD</code>, <code>XREAD</code> (read entries),
<code>XRANGE</code> (return range of entries),
<code>XLEN</code>(length), often used for message queue</li>
<li>Geospatial: geospatial indexes, <code>GEOADD</code>(add location to
geospatial index), <code>GEOSEARCH</code>(return location with
radius/box)</li>
<li>HyperLogLog: a data structure that estimates the cardinality of a
set, <code>PFADD</code>(add item), <code>PFCOUNT</code>(return an
estimate of number of items in the set), <code>PFMERGE</code>(combine
hyperloglogs into one)</li>
<li>Bitmap: extension of string to treat it like a vector,
<code>SETBIT</code>, <code>GETBIT</code>, <code>BITOP</code></li>
<li>Bitfield: set, increment, and get integer values of arbitrary bit
length, <code>BITFIELD</code>, <code>BITFIELD_RO</code></li>
</ul></li>
<li>Common operations
<ul>
<li>Keys: <code>keys &lt;pattern&gt;</code>(<code>keys *</code> for all
keys), <code>exists &lt;key&gt;</code>, <code>type &lt;key&gt;</code>,
<code>del &lt;key&gt;</code>(blocking deletion),
<code>unlink &lt;key&gt;</code>(unblocking deletion),
<code>ttl &lt;key&gt;</code>(time to live key, -1 is infinite, -2 is
expired), <code>move &lt;key&gt; &lt;dbindex&gt;</code> (redis has 16
dbs, 0~15), <code>select &lt;dbindex&gt;</code>(switch db),
<code>dbsize</code>(amount of keys in current db),
<code>flushdb</code>(clear keys in current db),
<code>flushall</code>(clear keys in all dbs)</li>
<li><code>help @type</code> check available commands</li>
<li>String: <code>getrange key start end</code>(both inclusive),
<code>setrange key offset replace</code>(replace starts from offset),
<code>INCR/DECR key</code>, <code>INCRBy/DECRBY key val</code>,
<code>append key substr</code></li>
<li>List:
<code>lrange list start end</code>(<code>lrange list 0 -1</code> for all
items in the list)</li>
<li>Hash: <code>hset key field value [field value...]</code>,
<code>hget key field</code>, <code>hkeys key</code> (show all fields),
<code>hvals key</code> (show all values), <code>hgetall key</code> (get
all keys and all values), <code>hincrby key field value</code></li>
<li>Set: <code>sadd key value [value...]</code>,
<code>srem key value</code>(remove value from set),
<code>srandmember key amount</code>, <code>smove s1 s2 value</code>
(remove value from s1, add value into s2), <code>sdiff s1 s2</code>,
<code>sunion s1 s2</code>, <code>sinter s1 s2</code>,
<code>sintercard s1 s2</code>(return cardinality of intersection set of
s1 and s2)</li>
<li>Sorted Set: <code>zadd key score1 value1 [score value...]</code>,
<code>zrange key 0 -1</code>(display all values in ascending order of
score), <code>zrange key 0 -1 withscores</code>(display all values and
corresponding scoreds in ascending order of score),
<code>zrangebyscore key minscore maxscore withscores</code>,
<code>zcard key</code>, <code>zrem key value</code></li>
<li>Bitmap: <code>setbit key offset 0/1</code>, <code>strlen key</code>
(byte count), <code>bitcount key</code>(1 amount)</li>
<li>HyperLogLog: used for deduplication:
<code>pfadd key val1 [val2...]</code>, <code>pfcount key</code>(return
cardinality estimation, relatively equal to unique amount, can contain
around 0.81% error)</li>
<li>Geospatial:
<code>geoadd key longitude latitude member1 [longitude latitude m2...]</code>,
<code>geopos key member1 [m2...]</code>(return longitude and latitude),
<code>geohash key member1 [me...]</code>(return hashvalues of longitude
and latitude), <code>geodist key m1 m2</code>(return distance),
<code>georadius key longitude latitude radius km/m/ft/mi withdist</code>(return
members with the radius of the center position)</li>
<li>Stream: message queue,
<code>xadd key *|id field value [f v...]</code> (use * to auto generate
id, id should be larger than previous id),
<code>xrange key - +</code>(display all items in the stream),
<code>xdel key id</code>, <code>xlen key</code>(amount of ids),
<code>xtrim key minid/maxid id</code>(trim the stream and only key ids
that meet the requirement),
<code>xread count &lt;amount&gt; streams &lt;stream&gt; $/0</code>( read
amount entries in the stream after the one with the largest id $, or
after the one with the smallest id 0),
<code>xgroup create &lt;stream&gt; &lt;group&gt; $/0</code> (create
consumer group to consume the stream),
<code>xreadgroup group &lt;group&gt; &lt;consumer&gt; streams &lt;stream&gt; &gt;</code>
(let the consumer in a group read all unread messaages, &gt; represent
start from the first unread message. Notice if a consumer in a group
read a specific message, other consumers in the same group cannot read
that message again), <code>xpending &lt;stream&gt; &lt;group&gt;</code>
(return minId read, maxId read, amount read, which consumer read),
<code>xpending &lt;stream&gt; &lt;group&gt; &lt;minId&gt; &lt;maxId&gt; &lt;amount&gt; &lt;consumer&gt;</code>
(show messages read by a consumer, messages read but ack is not provided
are in the pending state),
<code>xack &lt;stream&gt; &lt;group&gt; &lt;id&gt;</code> (confirm that
a message has been completely consumed, will reduce amount of pending
messages)</li>
<li>Bitfield: occasionally used</li>
</ul></li>
</ul></li>
<li>Redis persistence
<ul>
<li>Redis writes data to disk for persistence</li>
<li>Options: RDB(Redis database, PIT snapshot), AOF(append only file,
log operation and play at server startup), No persistence, RDB +
AOF</li>
<li>RDB
<ul>
<li>Automatic snapshot for certain time period</li>
<li>Generate <code>dump.rdb</code>, default location is inside folder
<code>/var/lib/redis</code></li>
<li>Manually generate rdb file: <code>save</code> for blocking save,
<code>bgsave</code> for unblocking save</li>
</ul></li>
<li>AOF
<ul>
<li>RDB may lose data, AOF is the option to ensure 100% recovery</li>
<li>By default AOF is not enables, you need to edit the
<code>redis.conf</code> to enable AOF: <code>appendonly yes</code>,
restart redis on the <code>redis.conf</code></li>
<li>Strategies to write cache to disk: <code>always</code>,
<code>everysec</code>, <code>no</code></li>
<li>Generate <code>appendonly.aof</code>, default location is inside
folder <code>/var/lib/redis/appendonlydir</code></li>
<li>Manually generate AOF file: <code>bgwriteaof</code></li>
</ul></li>
<li>No persistence: <code>save ""</code> to remove RDB,
<code>appendonly no</code> to remove AOF</li>
</ul></li>
<li>Redis transaction
<ul>
<li>Use <code>multi</code> to start transaction, use
<code>discard</code> to give up all commands in transaction and exit
transaction, use <code>exec</code> to execuate all commands in
transaction and exit transaction, use <code>watch</code> to monitor
transaction</li>
<li>If error occurs before exec(like compile time error in Java), then
executing the <code>exec</code> command will abort all commands in the
transaction</li>
<li>If error occurs after exec(like runtime error in Java), because
Redis does not support rollback, after executing the <code>exec</code>
command, commands without error in the transaction will be executed,
commands with error in the transaction will be aborted</li>
</ul></li>
<li>Redis pipelining
<ul>
<li>Pipelining is used to optimize round-trip times by batching redis
commands(no waiting times in between commands)</li>
<li>Use redis pipeline
<ul>
<li>Write all commands in a script file, for exampl
<code>a.txt</code></li>
<li>Use redis-cli pipeline to execute the file:
<code>cat ./a.txt | redis-cli -a pwd --pipe</code></li>
</ul></li>
</ul></li>
<li>Redis pub sub
<ul>
<li>Implement the publish/subscribe messaging paradigm, senders and
subscribers interact with channels</li>
<li><code>subscribe &lt;channel&gt;</code>,
<code>publish &lt;channel&gt; &lt;msg&gt;</code>,
<code>pubsub channels</code> (show active channels),
<code>pubsub numsub &lt;channel&gt;</code> (show subsciber count of a
channel)</li>
</ul></li>
<li>Redis replication
<ul>
<li>A replica machine can have its own replica machine</li>
<li>In replica machine, edit the <code>redis.conf</code>, add
<code>replicaof &lt;masterIp&gt; &lt;masterPort&gt;</code></li>
<li>If master has password, replica configure <code>masterauth</code>
with master password</li>
<li>In redis-cli: use <code>salveof host port</code> to set new master
machine and port, use <code>salaveof no one</code> to set the current
machine as master with no replications</li>
</ul></li>
<li>Redis sentinel
<ul>
<li>Provides HA for redis when no using redis cluster. So in realtime
development, you can use either redis replication + redis sentinel, or
redis cluster</li>
<li>Automatic failover: if a master is not working as expected, sentinel
can start a failover process where a replica is promoted to master, the
other replicas are reconfigured to use the new master, and the
applications using the Redis server are informed about the new address
to use when connecting</li>
<li>At least three sentinel instances should be used for roubust
deployment, by defaulf a sentinel listens to port 26379</li>
<li>Example of <code>sentinel.conf</code>, an example sentinel.conf can
be found on <code>redis.io</code> <figure class="highlight apacheconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sentinel</span> monitor mymaster <span class="number">127.0.0.1</span> <span class="number">6379</span> <span class="number">2</span></span><br><span class="line"><span class="attribute">sentinel</span> down-after-milliseconds mymaster <span class="number">60000</span></span><br><span class="line"><span class="attribute">sentinel</span> failover-timeout mymaster <span class="number">180000</span></span><br><span class="line"><span class="attribute">sentinel</span> parallel-syncs mymaster <span class="number">1</span></span><br><span class="line"><span class="comment"># Configure master insance password when needed</span></span><br><span class="line"><span class="attribute">sentinel</span> auth-pass &lt;master-name&gt; &lt;password&gt; </span><br></pre></td></tr></table></figure></li>
<li><code>sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;port&gt; &lt;quorum&gt;</code>,
quorum is the number of sentinels that need to agree about the fact the
master is not reachable, in order to really mark the master as failing,
and eventually start a failover procedure if possible</li>
<li>Failover process for n sentinels and m quorum (n is odd, n &lt; m)
<ol type="1">
<li>Sentinels periodically ping the redis master instance (called heart
beat),
<code>sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</code>(default
is 30 seconds), it a sentinal does not receive response from the master
instance at least that amount of milliseconds, it will consider that the
master instance is in the subjectively down state
(<code>SDOWN</code>)</li>
<li>If m sentinels agree that the master is not
reachable(<code>SDOWN</code>), the master instance is considered to be
objectively down (<code>ODOWN</code>)</li>
<li>If (n + 1) / 2 sentinels are reachable and the master instance is
ODOWN, then one reachable sentinel will be elected as leader using the
Raft algorithm(basic idea: votes are granted in a first-come-first-serve
fashion)</li>
<li>The leader sentinel will start the failover process, the following
information are taken into account for replica promotion: disconnection
time from the master(a replica that is disonnected from the master for
more than ten times the configured master timeout is not suitable for
promotion), replica priority(<code>replica-priority</code> in
<code>redis.conf</code>, default value 100, lower priority value is
preferred, but one with 0 value will not be promoted), replication
offset processed(one with newer data will be promoted), run id (random
id to identify a sentinel, lexicographically smaller id is preferred).
Order: compare replica-priority -&gt; compare replication offset -&gt;
compare run id</li>
<li><code>salveof no one</code> on the new master,
<code>slaveof host port</code> on replicas</li>
</ol></li>
<li>Start redis sentinel:
<code>redis-sentinel &lt;sentinel.conf&gt; --sentinel</code></li>
<li>Sentinel + redis replication does not ensure 0 data loss</li>
</ul></li>
<li>Redis cluster
<ul>
<li>Redis Cluster is a distributed implementation of redis</li>
<li>Provide HA, write safety(no single point of failure), data is
automatically shared among redis nodes</li>
<li>Key distribution model: cluster's key space split into 16384 hash
slots, setting man upper limit of 16384 master nodes, but the suggested
max amount of master nodes is ~ 1000. Each node in a redis cluster is
responsibile for a subnet of the hash slots</li>
<li>Data mapping approach
<ol type="1">
<li>Simple hashing: hash(key) / node amount, difficult for sacling</li>
<li>Consistent hashing: independent of the number of servers or objects
in the hash table, can have data skew</li>
<li>Hash slot: data is inside hash slot, server manages hash slot
instead of managing data directly,
<code>HASH_SLOT = CRC16(key) mod 16384</code></li>
</ol></li>
<li>Why maximum slot is 16384(2^14): CRC-16 hash has 16 bits, which is
up to 65536([0, 65535]): Redis heartbeat packet contains configuration
of a node, if there are 16384(2^14) nodes, the packet size would be 2k,
but for 65536(2^16) nodes, the heartbeat packet would require 8k size.
Generally redis suggests ~ 1000 nodes, and 16384 slots are enough for
1000 nodes</li>
<li>Redis cluster also does not support 100% write safety</li>
<li><code>redis.conf</code> for cluster <figure class="highlight apacheconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">         <span class="attribute">cluster</span>-enabled yes</span><br><span class="line">         <span class="attribute">cluster</span>-config-file &lt;nodes-xxx.conf&gt;</span><br><span class="line">         <span class="attribute">cluster</span>-node-timeout &lt;xxx-milliseconds&gt;</span><br><span class="line">      ````</span><br><span class="line">   * Allow auto switch among nodes in redis cluster: `redis-cli -c`</span><br><span class="line"></span><br><span class="line"><span class="attribute">9</span>. Redis with SpringBoot</span><br><span class="line">   * Java client for redis</span><br><span class="line">      * Jedis, lightweight client, offers fewer features</span><br><span class="line">      * Lettuce, fully non-blocking redis java client that supports sync and async communication</span><br><span class="line">      * RedisTemplate: a class provided by Spring Data Redis which can be used to perform redis operations</span><br><span class="line">   * Jedis</span><br><span class="line">      * Include the dependency</span><br><span class="line">         ```xml</span><br><span class="line">            <span class="section">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;</span></span><br><span class="line">            <span class="section">&lt;dependency&gt;</span></span><br><span class="line">               <span class="section">&lt;groupId&gt;</span><span class="attribute">redis</span>.clients&lt;/groupId&gt;</span><br><span class="line">               <span class="section">&lt;artifactId&gt;</span><span class="attribute">jedis</span>&lt;/artifactId&gt;</span><br><span class="line">               <span class="section">&lt;version&gt;</span><span class="attribute">4</span>.<span class="number">4</span>.<span class="number">1</span>&lt;/version&gt;</span><br><span class="line">            <span class="section">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Sample code <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String host = <span class="string">&quot;1.1.1.1&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> port = <span class="number">6379</span>;</span><br><span class="line">String pwd = <span class="string">&quot;pwd&quot;</span>;</span><br><span class="line">Jedis jedis = <span class="keyword">new</span> Jedis(host, port);</span><br><span class="line">jedis.auth(pwd);</span><br><span class="line">List&lt;String&gt; l1 = jedis.lrange(<span class="string">&quot;l1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">String v1 = jedis.get(<span class="string">&quot;k1&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Lettuce
<ul>
<li>Include the dependency <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.lettuce/lettuce-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Sample code <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        RedisURI uri = RedisURI</span></span><br><span class="line"><span class="comment">//                .builder()</span></span><br><span class="line"><span class="comment">//                .redis(&quot;149.28.62.112&quot;)</span></span><br><span class="line"><span class="comment">//                .withAuthentication(&quot;default&quot;, &quot;123456&quot;)</span></span><br><span class="line"><span class="comment">//                .withPort(6379).build();</span></span><br><span class="line">String uri = <span class="string">&quot;redis://123456@149.28.62.112:6379&quot;</span>;</span><br><span class="line">RedisClient client = RedisClient.create(uri);</span><br><span class="line">StatefulRedisConnection&lt;String, String&gt; conn = client.connect();</span><br><span class="line">RedisCommands&lt;String, String&gt; commands = conn.sync();</span><br><span class="line">String v1 = commands.get(<span class="string">&quot;k1&quot;</span>);</span><br><span class="line">System.out.println(v1);</span><br><span class="line">List&lt;String&gt; list = commands.lrange(<span class="string">&quot;l1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">list.forEach(item -&gt; System.out.println(item));</span><br><span class="line">conn.close();</span><br><span class="line">client.shutdown();</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>RedisTemplate
<ul>
<li>Include the dependency <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Standalone redis connection
<ul>
<li>Configuration file <code>application.yml</code>:
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">data:</span></span><br><span class="line">      <span class="attr">redis:</span></span><br><span class="line">         <span class="attr">host:</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">         <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">         <span class="attr">password:</span> <span class="number">123</span></span><br><span class="line">         <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">         <span class="attr">lettuce:</span></span><br><span class="line">            <span class="attr">pool:</span></span><br><span class="line">               <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">               <span class="attr">max-wait:</span> <span class="string">-1ms</span></span><br><span class="line">               <span class="attr">max-idle:</span> <span class="number">8</span></span><br><span class="line">               <span class="attr">min-idle:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></li>
<li>Sample code <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestService</span> </span>&#123;</span><br><span class="line">   <span class="comment">// Here are multiple classes, so provide </span></span><br><span class="line">   <span class="meta">@Qualifier(&quot;stringRedisTemplate&quot;)</span></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> RedisTemplate template;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> id = ThreadLocalRandom.current().nextInt(<span class="number">1000</span>) + <span class="number">1</span>;</span><br><span class="line">      String key = <span class="string">&quot;k&quot;</span> + id;</span><br><span class="line">      String serialNo = UUID.randomUUID().toString();</span><br><span class="line">      template.opsForValue().set(key, serialNo);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getOrderById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">      String key = <span class="string">&quot;k&quot;</span> + id;</span><br><span class="line">      <span class="keyword">return</span> (String) template.opsForValue().get(key);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>Redis cluster connection
<ul>
<li>Configuration file <code>application.yml</code>:
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">data:</span></span><br><span class="line">      <span class="attr">redis:</span></span><br><span class="line">         <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">         <span class="attr">cluster:</span></span><br><span class="line">         <span class="attr">max-redirects:</span> <span class="number">3</span></span><br><span class="line">         <span class="attr">nodes:</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span><span class="string">:6379,2.2.2.2:6379,3.3.3.3:6379</span></span><br><span class="line">         <span class="attr">lettuce:</span></span><br><span class="line">            <span class="attr">pool:</span></span><br><span class="line">               <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">               <span class="attr">max-wait:</span> <span class="string">-1ms</span></span><br><span class="line">               <span class="attr">max-idle:</span> <span class="number">8</span></span><br><span class="line">               <span class="attr">min-idle:</span> <span class="number">0</span> </span><br></pre></td></tr></table></figure></li>
<li>If you use the same code, there can be error: the client(springboot)
does not know if there's re-election inside the redis cluster and it
cannot automatically switch to the new master instance. You need to
enable the redis cluster topology view refresh to let the client notice
the lastest redis cluster configuration <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">data:</span></span><br><span class="line">      <span class="attr">redis:</span></span><br><span class="line">         <span class="attr">lettuce:</span></span><br><span class="line">            <span class="attr">cluster:</span></span><br><span class="line">               <span class="attr">refresh:</span></span><br><span class="line">                  <span class="attr">adaptive:</span> <span class="literal">true</span></span><br><span class="line">                  <span class="comment"># default refresh period is 60 seconds</span></span><br><span class="line">                  <span class="attr">period:</span> <span class="number">2000</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul></li>
</ul></li>
</ol>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Yanxuanshaozhu
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://yanxuanshaozhu.github.io/2022/07/24/Spring-Review/" title="Spring Review">https://yanxuanshaozhu.github.io/2022/07/24/Spring-Review/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Spring/" rel="tag"># Spring</a>
              <a href="/tags/SpringMVC/" rel="tag"># SpringMVC</a>
              <a href="/tags/SpringBoot/" rel="tag"># SpringBoot</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/06/07/Driver%20License%20Preparation%20in%20MA/" rel="prev" title="Driver License Preparation in MA">
      <i class="fa fa-chevron-left"></i> Driver License Preparation in MA
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/08/14/JavaWeb-Review/" rel="next" title="JavaWeb Review">
      JavaWeb Review <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#spring"><span class="nav-number">1.</span> <span class="nav-text">Spring</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#spring-%E6%A6%82%E8%BF%B0"><span class="nav-number">1.1.</span> <span class="nav-text">Spring 概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ioc%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E6%87%89%E7%94%A8"><span class="nav-number">1.2.</span> <span class="nav-text">IOC的概念和應用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spring%E7%9A%84ioc%E8%A7%A3%E6%B1%BA%E7%A8%8B%E5%BA%8F%E8%80%A6%E5%90%88"><span class="nav-number">1.3.</span> <span class="nav-text">Spring的IOC解決程序耦合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spring%E5%9F%BA%E6%96%BC%E6%B3%A8%E8%A7%A3%E7%9A%84ioc"><span class="nav-number">1.4.</span> <span class="nav-text">Spring基於注解的IOC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8B%99%E5%92%8C%E5%8B%95%E6%85%8B%E4%BB%A3%E7%90%86"><span class="nav-number">1.5.</span> <span class="nav-text">事務和動態代理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spring%E7%9A%84aop"><span class="nav-number">1.6.</span> <span class="nav-text">Spring的AOP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spring%E4%B8%AD%E7%9A%84jdbctemplate"><span class="nav-number">1.7.</span> <span class="nav-text">Spring中的JdbcTemplate</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spring%E4%B8%AD%E7%9A%84%E4%BA%8B%E5%8B%99%E6%8E%A7%E5%88%B6"><span class="nav-number">1.8.</span> <span class="nav-text">Spring中的事務控制</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#springmvc"><span class="nav-number">2.</span> <span class="nav-text">SpringMVC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#spring-mvc%E5%9F%BA%E7%A4%8E"><span class="nav-number">2.1.</span> <span class="nav-text">Spring MVC基礎</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#springmvc%E7%9A%84%E8%AB%8B%E6%B1%82%E5%92%8C%E9%9F%BF%E6%87%89"><span class="nav-number">2.2.</span> <span class="nav-text">SpringMVC的請求和響應</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rest%E9%A2%A8%E6%A0%BC"><span class="nav-number">2.3.</span> <span class="nav-text">REST風格</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mybatis"><span class="nav-number">3.</span> <span class="nav-text">MyBatis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis%E5%9F%BA%E7%A4%8E"><span class="nav-number">3.1.</span> <span class="nav-text">MyBatis基礎</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis%E9%80%B2%E9%9A%8E"><span class="nav-number">3.2.</span> <span class="nav-text">MyBatis進階</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatisplus"><span class="nav-number">3.3.</span> <span class="nav-text">MyBatisPlus</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ssm%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88"><span class="nav-number">4.</span> <span class="nav-text">SSM框架整合</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#springboot"><span class="nav-number">5.</span> <span class="nav-text">SpringBoot</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#springboot%E5%9F%BA%E7%A4%8E"><span class="nav-number">5.1.</span> <span class="nav-text">SpringBoot基礎</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%9A%E7%A1%85%E8%B0%B7spring6"><span class="nav-number">6.</span> <span class="nav-text">尚硅谷Spring6</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%9A%E7%A1%85%E8%B0%B7springmvc"><span class="nav-number">7.</span> <span class="nav-text">尚硅谷SpringMVC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%9A%E7%A1%85%E8%B0%B7mybatis"><span class="nav-number">8.</span> <span class="nav-text">尚硅谷MyBatis</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%9A%E7%A1%85%E8%B0%B7ssm%E6%95%B4%E5%90%88"><span class="nav-number">9.</span> <span class="nav-text">尚硅谷SSM整合</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%9A%E7%A1%85%E8%B0%B7springboot"><span class="nav-number">10.</span> <span class="nav-text">尚硅谷SpringBoot</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%9A%E7%A1%85%E8%B0%B7redis"><span class="nav-number">11.</span> <span class="nav-text">尚硅谷Redis</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Yanxuanshaozhu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Yanxuanshaozhu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">59</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">54</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yanxuanshaozhu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yanxuanshaozhu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:mrlixm.cn@gmail.com" title="E-Mail → mailto:mrlixm.cn@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yanxuanshaozhu</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.8m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">26:42</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
